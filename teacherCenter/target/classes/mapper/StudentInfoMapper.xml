<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.xue.dao.StudentInfoMapper" >
  <resultMap id="BaseResultMap" type="com.xue.model.StudentInfo" >
    <id column="student_id" property="studentId" jdbcType="VARCHAR" />
    <result column="student_name" property="studentName" jdbcType="VARCHAR" />
    <result column="mobile" property="mobile" jdbcType="VARCHAR" />
    <result column="email" property="email" jdbcType="VARCHAR" />
    <result column="state" property="state" jdbcType="VARCHAR" />
    <result column="password" property="password" jdbcType="VARCHAR" />
    <result column="last_pwd" property="lastPwd" jdbcType="VARCHAR" />
    <result column="create_time" property="createTime" jdbcType="VARCHAR" />
    <result column="last_login_time" property="lastLoginTime" jdbcType="VARCHAR" />
    <result column="current_login_time" property="currentLoginTime" jdbcType="VARCHAR" />
    <result column="cookie_value" property="cookieValue" jdbcType="VARCHAR" />
    <result column="is_del" property="isDel" jdbcType="VARCHAR" />
    <result column="balance" property="balance" jdbcType="INTEGER" /> 
  </resultMap>
  
  <resultMap type="com.xue.dto.StudentAndDetailsResult" id="StudentInfoAndDetails" extends="BaseResultMap">
     <result column="course_property" property="courseProperty" jdbcType="INTEGER" />
     <result column="student_source" property="studentSource" jdbcType="INTEGER" />
     <result column="intention" property="intention" jdbcType="INTEGER" />
     <result column="intention_ramark" property="intentionRamark" jdbcType="VARCHAR" />
     <result column="apply_intention" property="applyIntention" jdbcType="VARCHAR" />
     <result column="apply_classes" property="applyClasses" jdbcType="VARCHAR" /> 
  </resultMap>
  
  <resultMap type="com.xue.dto.PageBean" id="pageBean"></resultMap>
  
  <sql id="Base_Column_List" >
    student_id, student_name, mobile, email, state, password, last_pwd, create_time, 
    last_login_time, current_login_time, cookie_value, is_del,balance
  </sql>
  
  
  <select id="selectByPrimaryKey" resultMap="BaseResultMap" parameterType="java.lang.String" >
    select 
    <include refid="Base_Column_List" />
    from student_info
    where student_id = #{studentId,jdbcType=VARCHAR} AND is_del='0'
  </select>
  
  <select id="queryAllStudentsForPage" resultMap="StudentInfoAndDetails" parameterType="com.xue.vo.query.AllStudentQuery" >
  select *from  student_info  si 
left join student_info_detail sid on si.student_id = sid.student_id
 <where>
       is_del='0'
        <if test="mobile !=null and mobile != ''">   
	     	and mobile like concat('%',#{mobile,jdbcType=VARCHAR}, '%')
		</if> 
		<if test="studentId !=null and studentId != ''">   
	     	and student_id like concat('%',#{studentId,jdbcType=VARCHAR}, '%')
		</if> 
		<if test="studentName !=null and studentName != ''">   
	     	and student_name like concat('%',#{studentName,jdbcType=VARCHAR}, '%')
		</if> 
		<if test="intention !=0 and intention != '0'">  
	     	and intention =  #{intention,jdbcType=VARCHAR} 
		</if>  
    </where>
         limit #{startNum,jdbcType=INTEGER},5 
  </select>
  
  <select id="queryCount" resultType="java.lang.Integer" parameterType="com.xue.vo.query.AllStudentQuery" > 
     select count(*) from  student_info  si 
       left join student_info_detail sid on si.student_id = sid.student_id
       <where>
	        is_del='0'
	        <if test="mobile !=null and mobile != ''">   
		     	and mobile like concat('%',#{mobile,jdbcType=VARCHAR}, '%')
			</if> 
			<if test="studentId !=null and studentId != ''">   
		     	and student_id like concat('%',#{studentId,jdbcType=VARCHAR}, '%')
			</if> 
			<if test="studentName !=null and studentName != ''">   
		     	and student_name like concat('%',#{studentName,jdbcType=VARCHAR}, '%')
			</if> 
			<if test="intention !=0 and intention != '0'">  
		     	and intention =  #{intention,jdbcType=VARCHAR} 
			</if>  
        </where>
 </select>
 
 <select id="downExcel" resultMap="StudentInfoAndDetails" parameterType="com.xue.vo.query.AllStudentQuery">
        <!-- select result.* from (select  DISTINCT si.student_id as student_id1, si.* from (select  *  from student_info where is_del='0') si 
inner join student_shop_set sss on si.student_id=sss.STUDENT_ID 
inner join (select *from shop where major_id=#{majorId,jdbcType=VARCHAR}) s on sss.SHOP_ID=s.SHOP_ID  )result; -->
 select *from ((select *from student_info 
 <where>
    student_id in <foreach collection="choiceStudents" item="item" index="index" 
    open="(" separator="," close=")">#{item}</foreach>
</where>) si
left join student_info_detail sid
on si.student_id = sid.student_id )
</select>
  
  <select id="queryByKeyword" resultMap="BaseResultMap" parameterType="java.util.HashMap">
     select 
    <include refid="Base_Column_List" />
    from student_info
    where    is_del='0' and student_id like concat('%',#{keyword,jdbcType=VARCHAR}, '%') limit #{startNum,jdbcType=INTEGER},5
  </select>
  
    <select id="queryCountByKeyword" resultType="java.lang.Integer" parameterType="java.lang.String">
       select count(*) from student_info where  is_del='0'  and student_id like concat('%', #{keyword,jdbcType=VARCHAR}, '%')
  </select>
   
   <select id="queryAllStudents" resultMap="BaseResultMap">
     select 
    <include refid="Base_Column_List" />
    from student_info where is_del='0'
  </select>
  
  <select id="queryStudentByShop" resultMap="BaseResultMap" parameterType="com.xue.vo.query.AllStudentQuery">  
     select result.* from (select  DISTINCT si.student_id as student_id1, si.* from (select  *  from student_info where is_del='0') si 
inner join student_shop_set sss on si.student_id=sss.STUDENT_ID 
inner join (select *from shop where major_id=#{majorId,jdbcType=VARCHAR}) s on sss.SHOP_ID=s.SHOP_ID  )result limit #{startNum,jdbcType=INTEGER},5;
  </select>
  
  <select id="queryStudentByShopCount" resultType="java.lang.Integer" parameterType="com.xue.vo.query.AllStudentQuery">
   select  count(*) from (select  DISTINCT si.student_id as student_id1, si.* from (select  *  from student_info where is_del='0') si 
inner join student_shop_set sss on si.student_id=sss.STUDENT_ID 
inner join (select *from shop where major_id=#{majorId,jdbcType=VARCHAR}) s on sss.SHOP_ID=s.SHOP_ID  )result;
  </select>
  
  <select id="queryStudentByShopKeyword" resultMap="BaseResultMap" parameterType="com.xue.vo.query.AllStudentQuery">
          select result.* from (select  DISTINCT si.student_id as student_id1, si.* from (select  *  from student_info where is_del='0' and student_id like concat('%',#{keyword,jdbcType=VARCHAR}, '%')) si 
inner join student_shop_set sss on si.student_id=sss.STUDENT_ID 
inner join (select *from shop where major_id=#{majorId,jdbcType=VARCHAR}) s on sss.SHOP_ID=s.SHOP_ID  )result limit #{startNum,jdbcType=INTEGER},5;
  </select>
  
  <select id="queryStudentByShopKeywordCount" resultType="java.lang.Integer" parameterType="com.xue.vo.query.AllStudentQuery">
   select  count(*) from (select  DISTINCT si.student_id as student_id1, si.* from (select  *  from student_info where is_del='0' and student_id like concat('%',#{keyword,jdbcType=VARCHAR}, '%')) si 
inner join student_shop_set sss on si.student_id=sss.STUDENT_ID 
inner join (select *from shop where major_id=#{majorId,jdbcType=VARCHAR}) s on sss.SHOP_ID=s.SHOP_ID  )result;
   </select>
    
   <select id="login" resultMap="BaseResultMap" parameterType="com.xue.vo.query.StudentInfoQuery" >
    select 
    <include refid="Base_Column_List" />
    from student_info
    <where>
		<if test="email !=null and email != ''">  
	     	 AND email =  #{email,jdbcType=VARCHAR} 
		</if> 
		<if test="mobile !=null and mobile != ''">  
	     	 AND mobile =  #{mobile,jdbcType=VARCHAR} 
		</if> 
		<if test="studentName !=null and studentName != ''">  
	     	 AND student_name =  #{studentName,jdbcType=VARCHAR} 
		</if> 
		<if test="password !=null and password != ''">  
	     	 AND password =  #{password,jdbcType=VARCHAR} 
		</if>
	 </where>
  </select>
  
   <select id="findByStudentName" resultMap="BaseResultMap" parameterType="com.xue.vo.query.StudentInfoQuery" >
    select 
    <include refid="Base_Column_List" />
    from student_info
    <where>
		<if test="studentName !=null and studentName != ''">  
	     	 OR student_name =  #{studentName,jdbcType=VARCHAR} 
		</if> 
		<if test="mobile !=null and mobile != ''">  
	     	 OR mobile =  #{mobile,jdbcType=VARCHAR} 
		</if> 
	</where>
  </select>
  
  <select id="findByStudentMobile" resultMap="BaseResultMap" parameterType="com.xue.vo.query.StudentInfoQuery">
   select 
    <include refid="Base_Column_List" />   from student_info where mobile =  #{mobile,jdbcType=VARCHAR}   
  </select>
   
  
  <delete id="deleteByPrimaryKey" parameterType="java.lang.String" >
    delete from student_info
    where student_id = #{studentId,jdbcType=VARCHAR}
  </delete>
  <insert id="insert" parameterType="com.xue.model.StudentInfo" >
    insert into student_info (student_id, student_name, mobile, 
      email, state, password, 
      last_pwd, create_time, last_login_time, 
      current_login_time, cookie_value, is_del
      )
    values (#{studentId,jdbcType=VARCHAR}, #{studentName,jdbcType=VARCHAR}, #{mobile,jdbcType=VARCHAR}, 
      #{email,jdbcType=VARCHAR}, #{state,jdbcType=VARCHAR}, #{password,jdbcType=VARCHAR}, 
      #{lastPwd,jdbcType=VARCHAR}, #{createTime,jdbcType=VARCHAR}, #{lastLoginTime,jdbcType=VARCHAR}, 
      #{currentLoginTime,jdbcType=VARCHAR}, #{cookieValue,jdbcType=VARCHAR}, #{isDel,jdbcType=VARCHAR}
      )
  </insert>
  <insert id="insertSelective" parameterType="com.xue.model.StudentInfo" >
    insert into student_info
    <trim prefix="(" suffix=")" suffixOverrides="," >
      <if test="studentId != null" >
        student_id,
      </if>
      <if test="studentName != null" >
        student_name,
      </if>
      <if test="mobile != null" >
        mobile,
      </if>
      <if test="email != null" >
        email,
      </if>
      <if test="state != null" >
        state,
      </if>
      <if test="password != null" >
        password,
      </if>
      <if test="lastPwd != null" >
        last_pwd,
      </if>
      <if test="createTime != null" >
        create_time,
      </if>
      <if test="lastLoginTime != null" >
        last_login_time,
      </if>
      <if test="currentLoginTime != null" >
        current_login_time,
      </if>
      <if test="cookieValue != null" >
        cookie_value,
      </if>
      <if test="isDel != null" >
        is_del,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides="," >
      <if test="studentId != null" >
        #{studentId,jdbcType=VARCHAR},
      </if>
      <if test="studentName != null" >
        #{studentName,jdbcType=VARCHAR},
      </if>
      <if test="mobile != null" >
        #{mobile,jdbcType=VARCHAR},
      </if>
      <if test="email != null" >
        #{email,jdbcType=VARCHAR},
      </if>
      <if test="state != null" >
        #{state,jdbcType=VARCHAR},
      </if>
      <if test="password != null" >
        #{password,jdbcType=VARCHAR},
      </if>
      <if test="lastPwd != null" >
        #{lastPwd,jdbcType=VARCHAR},
      </if>
      <if test="createTime != null" >
        #{createTime,jdbcType=VARCHAR},
      </if>
      <if test="lastLoginTime != null" >
        #{lastLoginTime,jdbcType=VARCHAR},
      </if>
      <if test="currentLoginTime != null" >
        #{currentLoginTime,jdbcType=VARCHAR},
      </if>
      <if test="cookieValue != null" >
        #{cookieValue,jdbcType=VARCHAR},
      </if>
      <if test="isDel != null" >
        #{isDel,jdbcType=VARCHAR},
      </if>
    </trim>
  </insert>
  <update id="updateByPrimaryKeySelective" parameterType="com.xue.model.StudentInfo" >
    update student_info
    <set >
      <if test="studentName != null" >
        student_name = #{studentName,jdbcType=VARCHAR},
      </if>
      <if test="mobile != null" >
        mobile = #{mobile,jdbcType=VARCHAR},
      </if>
      <if test="email != null" >
        email = #{email,jdbcType=VARCHAR},
      </if>
      <if test="state != null" >
        state = #{state,jdbcType=VARCHAR},
      </if>
      <if test="password != null" >
        password = #{password,jdbcType=VARCHAR},
      </if>
      <if test="lastPwd != null" >
        last_pwd = #{lastPwd,jdbcType=VARCHAR},
      </if>
      <if test="createTime != null" >
        create_time = #{createTime,jdbcType=VARCHAR},
      </if>
      <if test="lastLoginTime != null" >
        last_login_time = #{lastLoginTime,jdbcType=VARCHAR},
      </if>
      <if test="currentLoginTime != null" >
        current_login_time = #{currentLoginTime,jdbcType=VARCHAR},
      </if>
      <if test="cookieValue != null" >
        cookie_value = #{cookieValue,jdbcType=VARCHAR},
      </if>
      <if test="isDel != null" >
        is_del = #{isDel,jdbcType=VARCHAR},
      </if>
      <if test="balance != null">
        balance = #{balance,jdbcType=INTEGER}
      </if>
    </set>
    where student_id = #{studentId,jdbcType=VARCHAR}
  </update>
  <update id="updateByPrimaryKey" parameterType="com.xue.model.StudentInfo" >
    update student_info
    set student_name = #{studentName,jdbcType=VARCHAR},
      mobile = #{mobile,jdbcType=VARCHAR},
      email = #{email,jdbcType=VARCHAR},
      state = #{state,jdbcType=VARCHAR},
      password = #{password,jdbcType=VARCHAR},
      last_pwd = #{lastPwd,jdbcType=VARCHAR},
      create_time = #{createTime,jdbcType=VARCHAR},
      last_login_time = #{lastLoginTime,jdbcType=VARCHAR},
      current_login_time = #{currentLoginTime,jdbcType=VARCHAR},
      cookie_value = #{cookieValue,jdbcType=VARCHAR},
      is_del = #{isDel,jdbcType=VARCHAR}
    where student_id = #{studentId,jdbcType=VARCHAR}
  </update>
  
  <update id="resetPassword" parameterType="com.xue.vo.query.ResetPasswordQuery">
      update student_info   set password = #{defaultPassword,jdbcType=VARCHAR}    where mobile = #{mobile,jdbcType=VARCHAR}
  </update>
  
  <update id="deleteStudentByPhone"   parameterType="java.util.HashMap">
      update student_info   set is_del = '1'    where mobile = #{mobile,jdbcType=VARCHAR}
  </update>
  
</mapper>