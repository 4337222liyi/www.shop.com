<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.xue.dao.UserMapper" >
  <resultMap id="BaseResultMap" type="com.xue.model.User" >
    <id column="user_id" property="userId" jdbcType="VARCHAR" />
    <result column="user_name" property="userName" jdbcType="VARCHAR" />
    <result column="password" property="password" jdbcType="VARCHAR" />
    <result column="user_level" property="userLevel" jdbcType="VARCHAR" />
    <result column="address_a" property="addresA" jdbcType="VARCHAR" />
    <result column="telephone_number" property="telephoneNumber" jdbcType="VARCHAR" />
    <result column="mobile_number" property="mobileNumber" jdbcType="VARCHAR" />
    <result column="fax_number" property="faxNumber" jdbcType="VARCHAR" />
    <result column="url" property="url" jdbcType="VARCHAR" />
    <result column="user_img" property="userImg" jdbcType="VARCHAR" />
    <result column="create_date" property="createDate" jdbcType="VARCHAR" />
    <result column="create_user" property="createUser" jdbcType="VARCHAR" />
    <result column="LAST_UPDATE_DATE" property="lastUpdateDate" jdbcType="VARCHAR" />
    <result column="LAST_UPDATE_USER" property="lastUpdateUser" jdbcType="VARCHAR" />
  </resultMap>
  
  <resultMap type="com.xue.dto.PageBean" id="pageBean"></resultMap>
  
  <sql id="Base_Column_List" >
     user_id,user_name,password,user_level,ADDRES_A,telephone_number,mobile_number,
     fax_number,url,user_img,create_date,create_user,LAST_UPDATE_DATE,LAST_UPDATE_USER
  </sql>
  <select id="selectByPrimaryKey" resultMap="BaseResultMap" parameterType="java.lang.String" >
    select 
    <include refid="Base_Column_List" />
    from student_info
    where student_id = #{studentId,jdbcType=VARCHAR}
  </select>
  
  <select id="queryCount" resultType="java.lang.Integer">
       select count(*) from student_info where  is_del='0' 
  </select>
  
  <select id="queryCountByKeyword" resultType="java.lang.Integer" parameterType="java.lang.String">
       select count(*) from student_info where  is_del='0'  and student_id like concat('%', #{keyword,jdbcType=VARCHAR}, '%')
  </select>
  
  <select id="queryByKeyword" resultMap="BaseResultMap" parameterType="java.util.HashMap">
     select 
    <include refid="Base_Column_List" />
    from student_info
    where    is_del='0' and student_id like concat('%',#{keyword,jdbcType=VARCHAR}, '%') limit #{startNum,jdbcType=INTEGER},5
  </select>
  
  <select id="queryAllStudentsForPage" resultMap="BaseResultMap" parameterType="java.lang.Integer" >
     select 
    <include refid="Base_Column_List" />
    from student_info where is_del='0' limit #{startNum,jdbcType=INTEGER},5
  </select>
  
   <select id="queryAllStudents" resultMap="BaseResultMap">
     select 
    <include refid="Base_Column_List" />
    from student_info where is_del='0'
  </select>
  
  <select id="queryStudentByShop" resultMap="BaseResultMap" parameterType="java.util.HashMap">
     select si.* from (select *from student_info where is_del='0') si
     inner join  student_shop_set sss on si.student_id=sss.STUDENT_ID
     inner join (select *from shop where major_id=#{majorId,jdbcType=VARCHAR}) s on sss.SHOP_ID=s.SHOP_ID limit #{startNum,jdbcType=INTEGER},5
  </select>
  
  <select id="queryStudentByShopCount" resultType="java.lang.Integer" parameterType="java.util.HashMap">
     select count(*) from (select *from student_info where is_del='0') si
     inner join  student_shop_set sss on si.student_id=sss.STUDENT_ID
     inner join (select *from shop where major_id=#{majorId,jdbcType=VARCHAR}) s on sss.SHOP_ID=s.SHOP_ID
  </select>
  
  <select id="queryStudentByShopKeyword" resultMap="BaseResultMap" parameterType="java.util.HashMap">
      select si.* from (select *from student_info where is_del='0' and student_id like concat('%',#{keyword,jdbcType=VARCHAR}, '%')) si
     inner join  student_shop_set sss on si.student_id=sss.STUDENT_ID
     inner join (select *from shop where major_id=#{majorId,jdbcType=VARCHAR}) s on sss.SHOP_ID=s.SHOP_ID limit #{startNum,jdbcType=INTEGER},5
  </select>
  
  <select id="queryStudentByShopKeywordCount" resultType="java.lang.Integer" parameterType="java.util.HashMap">
    select count(*) from (select *from student_info where is_del='0' and student_id like concat('%',#{keyword,jdbcType=VARCHAR}, '%')) si
     inner join  student_shop_set sss on si.student_id=sss.STUDENT_ID
     inner join (select *from shop where major_id=#{majorId,jdbcType=VARCHAR}) s on sss.SHOP_ID=s.SHOP_ID
  </select>
  
   <select id="login" resultMap="BaseResultMap" parameterType="com.xue.vo.query.UserQuery" >
    select 
    <include refid="Base_Column_List" />
    from user
    <where>
		<if test="userId !=null and userId != ''">  
	     	 AND user_Id =  #{userId,jdbcType=VARCHAR} 
		</if> 
		<if test="mobileNumber !=null and mobileNumber != ''">  
	     	 AND mobileNumber =  #{mobileNumber,jdbcType=VARCHAR} 
		</if> 
		<if test="userName !=null and userName != ''">  
	     	 AND user_Name =  #{userName,jdbcType=VARCHAR} 
		</if>  
	     	 AND password =  #{password,jdbcType=VARCHAR}  
	 </where>
  </select>
  
   <select id="findByStudentName" resultMap="BaseResultMap" parameterType="com.xue.vo.query.StudentInfoQuery" >
    select 
    <include refid="Base_Column_List" />
    from student_info
    <where>
		<if test="studentName !=null and studentName != ''">  
	     	 OR student_name =  #{studentName,jdbcType=VARCHAR} 
		</if> 
		<if test="mobile !=null and mobile != ''">  
	     	 OR mobile =  #{mobile,jdbcType=VARCHAR} 
		</if> 
	</where>
  </select>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.String" >
    delete from student_info
    where student_id = #{studentId,jdbcType=VARCHAR}
  </delete>
  <insert id="insert" parameterType="com.xue.model.StudentInfo" >
    insert into student_info (student_id, student_name, mobile, 
      email, state, password, 
      last_pwd, create_time, last_login_time, 
      current_login_time, cookie_value, is_del
      )
    values (#{studentId,jdbcType=VARCHAR}, #{studentName,jdbcType=VARCHAR}, #{mobile,jdbcType=VARCHAR}, 
      #{email,jdbcType=VARCHAR}, #{state,jdbcType=VARCHAR}, #{password,jdbcType=VARCHAR}, 
      #{lastPwd,jdbcType=VARCHAR}, #{createTime,jdbcType=VARCHAR}, #{lastLoginTime,jdbcType=VARCHAR}, 
      #{currentLoginTime,jdbcType=VARCHAR}, #{cookieValue,jdbcType=VARCHAR}, #{isDel,jdbcType=VARCHAR}
      )
  </insert>
  <insert id="insertSelective" parameterType="com.xue.model.StudentInfo" >
    insert into student_info
    <trim prefix="(" suffix=")" suffixOverrides="," >
      <if test="studentId != null" >
        student_id,
      </if>
      <if test="studentName != null" >
        student_name,
      </if>
      <if test="mobile != null" >
        mobile,
      </if>
      <if test="email != null" >
        email,
      </if>
      <if test="state != null" >
        state,
      </if>
      <if test="password != null" >
        password,
      </if>
      <if test="lastPwd != null" >
        last_pwd,
      </if>
      <if test="createTime != null" >
        create_time,
      </if>
      <if test="lastLoginTime != null" >
        last_login_time,
      </if>
      <if test="currentLoginTime != null" >
        current_login_time,
      </if>
      <if test="cookieValue != null" >
        cookie_value,
      </if>
      <if test="isDel != null" >
        is_del,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides="," >
      <if test="studentId != null" >
        #{studentId,jdbcType=VARCHAR},
      </if>
      <if test="studentName != null" >
        #{studentName,jdbcType=VARCHAR},
      </if>
      <if test="mobile != null" >
        #{mobile,jdbcType=VARCHAR},
      </if>
      <if test="email != null" >
        #{email,jdbcType=VARCHAR},
      </if>
      <if test="state != null" >
        #{state,jdbcType=VARCHAR},
      </if>
      <if test="password != null" >
        #{password,jdbcType=VARCHAR},
      </if>
      <if test="lastPwd != null" >
        #{lastPwd,jdbcType=VARCHAR},
      </if>
      <if test="createTime != null" >
        #{createTime,jdbcType=VARCHAR},
      </if>
      <if test="lastLoginTime != null" >
        #{lastLoginTime,jdbcType=VARCHAR},
      </if>
      <if test="currentLoginTime != null" >
        #{currentLoginTime,jdbcType=VARCHAR},
      </if>
      <if test="cookieValue != null" >
        #{cookieValue,jdbcType=VARCHAR},
      </if>
      <if test="isDel != null" >
        #{isDel,jdbcType=VARCHAR},
      </if>
    </trim>
  </insert>
  <update id="updateByPrimaryKeySelective" parameterType="com.xue.model.User" >
    update student_info
    <set >
      <if test="userName != null" >
        userName = #{userName,jdbcType=VARCHAR},
      </if>
      <if test="mobileNumber != null" >
        mobileNumber = #{mobileNumber,jdbcType=VARCHAR},
      </if>
      <if test="organization != null" >
        organization = #{organization,jdbcType=VARCHAR},
      </if>
      <if test="state != null" >
        state = #{state,jdbcType=VARCHAR},
      </if>
      <if test="password != null" >
        password = #{password,jdbcType=VARCHAR},
      </if>
    </set>
    where user_id = #{userId,jdbcType=VARCHAR}
  </update>
  <update id="updateByPrimaryKey" parameterType="com.xue.model.StudentInfo" >
    update student_info
    set student_name = #{studentName,jdbcType=VARCHAR},
      mobile = #{mobile,jdbcType=VARCHAR},
      email = #{email,jdbcType=VARCHAR},
      state = #{state,jdbcType=VARCHAR},
      password = #{password,jdbcType=VARCHAR},
      last_pwd = #{lastPwd,jdbcType=VARCHAR},
      create_time = #{createTime,jdbcType=VARCHAR},
      last_login_time = #{lastLoginTime,jdbcType=VARCHAR},
      current_login_time = #{currentLoginTime,jdbcType=VARCHAR},
      cookie_value = #{cookieValue,jdbcType=VARCHAR},
      is_del = #{isDel,jdbcType=VARCHAR}
    where student_id = #{studentId,jdbcType=VARCHAR}
  </update>
  
  <update id="resetPassword" parameterType="java.lang.String">
      update student_info   set password = '123456'    where mobile = #{mobile,jdbcType=VARCHAR}
  </update>
  
  <update id="deleteStudentByPhone"   parameterType="java.util.HashMap">
      update student_info   set is_del = '1'    where mobile = #{mobile,jdbcType=VARCHAR}
  </update>
  
</mapper>