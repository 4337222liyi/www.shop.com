var IS_CONCAT_BUILD=!0,BUILD_LMV_WORKER_URL="lmvworker.min.js",LMV_WORKER_URL=BUILD_LMV_WORKER_URL,ENABLE_DEBUG=!1,ENABLE_TRACE=!1,ENABLE_INLINE_WORKER=!0,TeratekNamespace=function(a){var b="undefined"!==typeof window&&null!==window?window:self;a=a.split(".");for(var c=0;c<a.length;++c)b[a[c]]=b[a[c]]||{},b=b[a[c]];return b};TeratekNamespace("Teratek.Viewing.Private");TeratekNamespace("Teratek.Viewing.Extensions");TeratekNamespace("Teratek.Viewing.Shaders");TeratekNamespace("Teratek.Viewing.UI");
var _isIE11=!!navigator.userAgent.match(/Trident\/7\./);"undefined"!==typeof window&&_isIE11&&function(){function a(a,c){c=c||{bubbles:!1,cancelable:!1,detail:void 0};var d=document.createEvent("CustomEvent");d.initCustomEvent(a,c.bubbles,c.cancelable,c.detail);return d}a.prototype=window.CustomEvent.prototype;window.CustomEvent=a}();
ArrayBuffer.prototype.slice||(ArrayBuffer.prototype.slice=function(a,b){!b||b>this.byteLength?b=this.byteLength:0>b&&(b=this.byteLength+b,0>b&&(b=0));0>a&&(a=this.byteLength+a,0>a&&(a=0));if(b<=a)return new ArrayBuffer;for(var c=b-a,d=new Uint8Array(this,a,c),e=new Uint8Array(c),f=0;f<c;f++)e[f]=d[f];return e.buffer});"undefined"!==typeof window&&(window.BlobBuilder=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder);
function launchFullscreen(a,b){a.requestFullscreen?a.requestFullscreen(b):a.mozRequestFullScreen?a.mozRequestFullScreen(b):a.webkitRequestFullscreen?a.webkitRequestFullscreen(b):a.msRequestFullscreen&&a.msRequestFullscreen(b)}function exitFullscreen(){document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen&&document.msExitFullscreen()}
function inFullscreen(){return document.fullscreenEnabled||document.mozFullScreenElement||document.webkitIsFullScreen||document.msFullscreenElement?!0:!1}function fullscreenElement(){return document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement}function isFullscreenAvailable(a){return a.requestFullscreen||a.mozRequestFullScreen||a.webkitRequestFullscreen||a.msRequestFullscreen}
function getAndroidVersion(a){a=a||navigator.userAgent;return(a=a.match(/Android\s([0-9\.]*)/))?a[1]:!1}function isTouchDevice(){return"ontouchstart"in window}function isIOSDevice(){return/ip(ad|hone|od)/.test(navigator.userAgent.toLowerCase())}function isAndroidDevice(){return-1!==navigator.userAgent.toLowerCase().indexOf("android")}function isMobileDevice(){return isIOSDevice()||isAndroidDevice()}
function detectWebGL(){if(window.WebGLRenderingContext){for(var a=document.createElement("canvas"),b=["webgl","experimental-webgl","moz-webgl","webkit-3d"],c=!1,d=0;4>d;d++)try{if((c=a.getContext(b[d]))&&"function"===typeof c.getParameter)return 1}catch(e){}return 0}return-1}function touchStartToClick(a){a.preventDefault();a.stopPropagation();a.target.click()}(function(){var a="undefined"!==typeof window&&null!==window?window:self;a.performance||(a.performance=Date)})();
LmvMatrix4=function(){this.elements=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])};
LmvMatrix4.prototype={constructor:LmvMatrix4,set:function(a,b,c,d,e,f,g,h,k,n,r,q,p,l,t,u){var m=this.elements;m[0]=a;m[4]=b;m[8]=c;m[12]=d;m[1]=e;m[5]=f;m[9]=g;m[13]=h;m[2]=k;m[6]=n;m[10]=r;m[14]=q;m[3]=p;m[7]=l;m[11]=t;m[15]=u;return this},identity:function(){this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);return this},copy:function(a){this.elements.set(a.elements);return this},makeRotationFromQuaternion:function(a){var b=this.elements,c=a.x,d=a.y,e=a.z,f=a.w,g=c+c,h=d+d,k=e+e;a=c*g;var n=c*h,c=c*k,r=
d*h,d=d*k,e=e*k,g=f*g,h=f*h,f=f*k;b[0]=1-(r+e);b[4]=n-f;b[8]=c+h;b[1]=n+f;b[5]=1-(a+e);b[9]=d-g;b[2]=c-h;b[6]=d+g;b[10]=1-(a+r);b[3]=0;b[7]=0;b[11]=0;b[12]=0;b[13]=0;b[14]=0;b[15]=1;return this},multiply:function(a){return this.multiplyMatrices(this,a)},multiplyMatrices:function(a,b){var c=a.elements,d=b.elements,e=this.elements,f=c[0],g=c[4],h=c[8],k=c[12],n=c[1],r=c[5],q=c[9],p=c[13],l=c[2],t=c[6],u=c[10],m=c[14],w=c[3],A=c[7],F=c[11],c=c[15],y=d[0],B=d[4],J=d[8],K=d[12],I=d[1],D=d[5],E=d[9],v=
d[13],C=d[2],G=d[6],H=d[10],x=d[14],z=d[3],M=d[7],N=d[11],d=d[15];e[0]=f*y+g*I+h*C+k*z;e[4]=f*B+g*D+h*G+k*M;e[8]=f*J+g*E+h*H+k*N;e[12]=f*K+g*v+h*x+k*d;e[1]=n*y+r*I+q*C+p*z;e[5]=n*B+r*D+q*G+p*M;e[9]=n*J+r*E+q*H+p*N;e[13]=n*K+r*v+q*x+p*d;e[2]=l*y+t*I+u*C+m*z;e[6]=l*B+t*D+u*G+m*M;e[10]=l*J+t*E+u*H+m*N;e[14]=l*K+t*v+u*x+m*d;e[3]=w*y+A*I+F*C+c*z;e[7]=w*B+A*D+F*G+c*M;e[11]=w*J+A*E+F*H+c*N;e[15]=w*K+A*v+F*x+c*d;return this},multiplyToArray:function(a,b,c){var d=this.elements;this.multiplyMatrices(a,b);c[0]=
d[0];c[1]=d[1];c[2]=d[2];c[3]=d[3];c[4]=d[4];c[5]=d[5];c[6]=d[6];c[7]=d[7];c[8]=d[8];c[9]=d[9];c[10]=d[10];c[11]=d[11];c[12]=d[12];c[13]=d[13];c[14]=d[14];c[15]=d[15];return this},multiplyScalar:function(a){var b=this.elements;b[0]*=a;b[4]*=a;b[8]*=a;b[12]*=a;b[1]*=a;b[5]*=a;b[9]*=a;b[13]*=a;b[2]*=a;b[6]*=a;b[10]*=a;b[14]*=a;b[3]*=a;b[7]*=a;b[11]*=a;b[15]*=a;return this},determinant:function(){var a=this.elements,b=a[0],c=a[4],d=a[8],e=a[12],f=a[1],g=a[5],h=a[9],k=a[13],n=a[2],r=a[6],q=a[10],p=a[14];
return a[3]*(+e*h*r-d*k*r-e*g*q+c*k*q+d*g*p-c*h*p)+a[7]*(+b*h*p-b*k*q+e*f*q-d*f*p+d*k*n-e*h*n)+a[11]*(+b*k*r-b*g*p-e*f*r+c*f*p+e*g*n-c*k*n)+a[15]*(-d*g*n-b*h*r+b*g*q+d*f*r-c*f*q+c*h*n)},transpose:function(){var a=this.elements,b;b=a[1];a[1]=a[4];a[4]=b;b=a[2];a[2]=a[8];a[8]=b;b=a[6];a[6]=a[9];a[9]=b;b=a[3];a[3]=a[12];a[12]=b;b=a[7];a[7]=a[13];a[13]=b;b=a[11];a[11]=a[14];a[14]=b;return this},flattenToArrayOffset:function(a,b){var c=this.elements;a[b]=c[0];a[b+1]=c[1];a[b+2]=c[2];a[b+3]=c[3];a[b+4]=
c[4];a[b+5]=c[5];a[b+6]=c[6];a[b+7]=c[7];a[b+8]=c[8];a[b+9]=c[9];a[b+10]=c[10];a[b+11]=c[11];a[b+12]=c[12];a[b+13]=c[13];a[b+14]=c[14];a[b+15]=c[15];return a},setPosition:function(a){var b=this.elements;b[12]=a.x;b[13]=a.y;b[14]=a.z;return this},getInverse:function(a,b){var c=this.elements,d=a.elements,e=d[0],f=d[4],g=d[8],h=d[12],k=d[1],n=d[5],r=d[9],q=d[13],p=d[2],l=d[6],t=d[10],u=d[14],m=d[3],w=d[7],A=d[11],d=d[15];c[0]=r*u*w-q*t*w+q*l*A-n*u*A-r*l*d+n*t*d;c[4]=h*t*w-g*u*w-h*l*A+f*u*A+g*l*d-f*t*
d;c[8]=g*q*w-h*r*w+h*n*A-f*q*A-g*n*d+f*r*d;c[12]=h*r*l-g*q*l-h*n*t+f*q*t+g*n*u-f*r*u;c[1]=q*t*m-r*u*m-q*p*A+k*u*A+r*p*d-k*t*d;c[5]=g*u*m-h*t*m+h*p*A-e*u*A-g*p*d+e*t*d;c[9]=h*r*m-g*q*m-h*k*A+e*q*A+g*k*d-e*r*d;c[13]=g*q*p-h*r*p+h*k*t-e*q*t-g*k*u+e*r*u;c[2]=n*u*m-q*l*m+q*p*w-k*u*w-n*p*d+k*l*d;c[6]=h*l*m-f*u*m-h*p*w+e*u*w+f*p*d-e*l*d;c[10]=f*q*m-h*n*m+h*k*w-e*q*w-f*k*d+e*n*d;c[14]=h*n*p-f*q*p-h*k*l+e*q*l+f*k*u-e*n*u;c[3]=r*l*m-n*t*m-r*p*w+k*t*w+n*p*A-k*l*A;c[7]=f*t*m-g*l*m+g*p*w-e*t*w-f*p*A+e*l*A;c[11]=
g*n*m-f*r*m-g*k*w+e*r*w+f*k*A-e*n*A;c[15]=f*r*p-g*n*p+g*k*l-e*r*l-f*k*t+e*n*t;c=e*c[0]+k*c[4]+p*c[8]+m*c[12];if(0==c){if(b)throw Error("Matrix4.getInverse(): can't invert matrix, determinant is 0");console.warn("Matrix4.getInverse(): can't invert matrix, determinant is 0");this.identity();return this}this.multiplyScalar(1/c);return this},scale:function(a){var b=this.elements,c=a.x,d=a.y;a=a.z;b[0]*=c;b[4]*=d;b[8]*=a;b[1]*=c;b[5]*=d;b[9]*=a;b[2]*=c;b[6]*=d;b[10]*=a;b[3]*=c;b[7]*=d;b[11]*=a;return this},
makeTranslation:function(a,b,c){this.set(1,0,0,a,0,1,0,b,0,0,1,c,0,0,0,1);return this},makeRotationX:function(a){var b=Math.cos(a);a=Math.sin(a);this.set(1,0,0,0,0,b,-a,0,0,a,b,0,0,0,0,1);return this},makeRotationY:function(a){var b=Math.cos(a);a=Math.sin(a);this.set(b,0,a,0,0,1,0,0,-a,0,b,0,0,0,0,1);return this},makeRotationZ:function(a){var b=Math.cos(a);a=Math.sin(a);this.set(b,-a,0,0,a,b,0,0,0,0,1,0,0,0,0,1);return this},makeRotationAxis:function(a,b){var c=Math.cos(b),d=Math.sin(b),e=1-c,f=a.x,
g=a.y,h=a.z,k=e*f,n=e*g;this.set(k*f+c,k*g-d*h,k*h+d*g,0,k*g+d*h,n*g+c,n*h-d*f,0,k*h-d*g,n*h+d*f,e*h*h+c,0,0,0,0,1);return this},makeScale:function(a,b,c){this.set(a,0,0,0,0,b,0,0,0,0,c,0,0,0,0,1);return this},compose:function(a,b,c){this.makeRotationFromQuaternion(b);this.scale(c);this.setPosition(a);return this},transformPoint:function(a){var b=a.x,c=a.y,d=a.z,e=this.elements;a.x=e[0]*b+e[4]*c+e[8]*d+e[12];a.y=e[1]*b+e[5]*c+e[9]*d+e[13];a.z=e[2]*b+e[6]*c+e[10]*d+e[14];return a},transformDirection:function(a){var b=
a.x,c=a.y,d=a.z,e=this.elements;a.x=e[0]*b+e[4]*c+e[8]*d;a.y=e[1]*b+e[5]*c+e[9]*d;a.z=e[2]*b+e[6]*c+e[10]*d;b=Math.sqrt(a.x*a.x+a.y*a.y+a.z*a.z);0<b&&(b=1/b,a.x*=b,a.y*=b,a.z*=b);return a},fromArray:function(a){this.elements.set(a);return this},toArray:function(){var a=this.elements;return[a[0],a[1],a[2],a[3],a[4],a[5],a[6],a[7],a[8],a[9],a[10],a[11],a[12],a[13],a[14],a[15]]},clone:function(){return(new LmvMatrix4).fromArray(this.elements)}};
(function(){function a(a){throw a;}function b(a,b){var c=a.split("."),d=r;c[0]in d||!d.execScript||d.execScript("var "+c[0]);for(var e;c.length&&(e=c.shift());)c.length||void 0===b?d=d[e]?d[e]:d[e]={}:d[e]=b}function c(a,b,c){var d="number"===typeof b?b:b=0,e="number"===typeof c?c:a.length;c=-1;for(d=e&7;d--;++b)c=c>>>8^u[(c^a[b])&255];for(d=e>>3;d--;b+=8)c=c>>>8^u[(c^a[b])&255],c=c>>>8^u[(c^a[b+1])&255],c=c>>>8^u[(c^a[b+2])&255],c=c>>>8^u[(c^a[b+3])&255],c=c>>>8^u[(c^a[b+4])&255],c=c>>>8^u[(c^a[b+
5])&255],c=c>>>8^u[(c^a[b+6])&255],c=c>>>8^u[(c^a[b+7])&255];return(c^4294967295)>>>0}function d(){}function e(a){var b=a.length,c=0,d=Number.POSITIVE_INFINITY,e,f,x,g,h,m,k,l,p;for(l=0;l<b;++l)a[l]>c&&(c=a[l]),a[l]<d&&(d=a[l]);e=1<<c;f=new (q?Uint32Array:Array)(e);x=1;g=0;for(h=2;x<=c;){for(l=0;l<b;++l)if(a[l]===x){m=0;k=g;for(p=0;p<x;++p)m=m<<1|k&1,k>>=1;for(p=m;p<e;p+=h)f[p]=x<<16|l;++g}++x;g<<=1;h<<=1}return[f,c,d]}function f(b,c){this.i=[];this.j=32768;this.d=this.f=this.c=this.n=0;this.input=
q?new Uint8Array(b):b;this.o=!1;this.k=w;this.w=!1;if(c||!(c={}))c.index&&(this.c=c.index),c.bufferSize&&(this.j=c.bufferSize),c.bufferType&&(this.k=c.bufferType),c.resize&&(this.w=c.resize);switch(this.k){case m:this.a=32768;this.b=new (q?Uint8Array:Array)(32768+this.j+258);break;case w:this.a=0;this.b=new (q?Uint8Array:Array)(this.j);this.e=this.D;this.q=this.A;this.l=this.C;break;default:a(Error("invalid inflate mode"))}}function g(b,c){for(var d=b.f,e=b.d,f=b.input,g=b.c,x;e<c;)x=f[g++],void 0===
x&&a(Error("input buffer is broken")),d|=x<<e,e+=8;b.f=d>>>c;b.d=e-c;b.c=g;return d&(1<<c)-1}function h(a,b){for(var c=a.f,d=a.d,e=a.input,f=a.c,x=b[0],g=b[1],h;d<g;){h=e[f++];if(void 0===h)break;c|=h<<d;d+=8}e=x[c&(1<<g)-1];x=e>>>16;a.f=c>>x;a.d=d-x;a.c=f;return e&65535}function k(a){function b(a,c,d){var e,f,x,v;for(v=0;v<a;)switch(e=h(this,c),e){case 16:for(x=3+g(this,2);x--;)d[v++]=f;break;case 17:for(x=3+g(this,3);x--;)d[v++]=0;f=0;break;case 18:for(x=11+g(this,7);x--;)d[v++]=0;f=0;break;default:f=
d[v++]=e}return d}var c=g(a,5)+257,d=g(a,5)+1,f=g(a,4)+4,m=new (q?Uint8Array:Array)(A.length),x;for(x=0;x<f;++x)m[A[x]]=g(a,3);f=e(m);m=new (q?Uint8Array:Array)(c);x=new (q?Uint8Array:Array)(d);a.l(e(b.call(a,c,f,m)),e(b.call(a,d,f,x)))}function n(a){this.input=a;this.c=0;this.m=[];this.s=!1}var r=this,q="undefined"!==typeof Uint8Array&&"undefined"!==typeof Uint16Array&&"undefined"!==typeof Uint32Array;new (q?Uint8Array:Array)(256);var p;for(p=0;256>p;++p)for(var l=p,t=7,l=l>>>1;l;l>>>=1)--t;p=[0,
1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,
651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,
4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,
167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,
3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918E3,
2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117];var u=q?new Uint32Array(p):p;d.prototype.getName=function(){return this.name};d.prototype.getData=function(){return this.data};d.prototype.G=function(){return this.H};b("Zlib.GunzipMember",d);b("Zlib.GunzipMember.prototype.getName",d.prototype.getName);b("Zlib.GunzipMember.prototype.getData",
d.prototype.getData);b("Zlib.GunzipMember.prototype.getMtime",d.prototype.G);p=[];for(l=0;288>l;l++)switch(!0){case 143>=l:p.push([l+48,8]);break;case 255>=l:p.push([l-144+400,9]);break;case 279>=l:p.push([l-256+0,7]);break;case 287>=l:p.push([l-280+192,8]);break;default:a("invalid literal: "+l)}p=function(){function b(c){switch(!0){case 3===c:return[257,c-3,0];case 4===c:return[258,c-4,0];case 5===c:return[259,c-5,0];case 6===c:return[260,c-6,0];case 7===c:return[261,c-7,0];case 8===c:return[262,
c-8,0];case 9===c:return[263,c-9,0];case 10===c:return[264,c-10,0];case 12>=c:return[265,c-11,1];case 14>=c:return[266,c-13,1];case 16>=c:return[267,c-15,1];case 18>=c:return[268,c-17,1];case 22>=c:return[269,c-19,2];case 26>=c:return[270,c-23,2];case 30>=c:return[271,c-27,2];case 34>=c:return[272,c-31,2];case 42>=c:return[273,c-35,3];case 50>=c:return[274,c-43,3];case 58>=c:return[275,c-51,3];case 66>=c:return[276,c-59,3];case 82>=c:return[277,c-67,4];case 98>=c:return[278,c-83,4];case 114>=c:return[279,
c-99,4];case 130>=c:return[280,c-115,4];case 162>=c:return[281,c-131,5];case 194>=c:return[282,c-163,5];case 226>=c:return[283,c-195,5];case 257>=c:return[284,c-227,5];case 258===c:return[285,c-258,0];default:a("invalid length: "+c)}}var c=[],d,e;for(d=3;258>=d;d++)e=b(d),c[d]=e[2]<<24|e[1]<<16|e[0];return c}();q&&new Uint32Array(p);var m=0,w=1;f.prototype.g=function(){for(;!this.o;){var b=g(this,3);b&1&&(this.o=!0);b>>>=1;switch(b){case 0:var b=this.input,c=this.c,d=this.b,e=this.a,f=void 0,h=void 0,
x=void 0,z=d.length,f=void 0;this.d=this.f=0;f=b[c++];void 0===f&&a(Error("invalid uncompressed block header: LEN (first byte)"));h=f;f=b[c++];void 0===f&&a(Error("invalid uncompressed block header: LEN (second byte)"));h|=f<<8;f=b[c++];void 0===f&&a(Error("invalid uncompressed block header: NLEN (first byte)"));x=f;f=b[c++];void 0===f&&a(Error("invalid uncompressed block header: NLEN (second byte)"));x|=f<<8;h===~x&&a(Error("invalid uncompressed block header: length verify"));c+h>b.length&&a(Error("input buffer is broken"));
switch(this.k){case m:for(;e+h>d.length;){f=z-e;h-=f;if(q)d.set(b.subarray(c,c+f),e),e+=f,c+=f;else for(;f--;)d[e++]=b[c++];this.a=e;d=this.e();e=this.a}break;case w:for(;e+h>d.length;)d=this.e({t:2});break;default:a(Error("invalid inflate mode"))}if(q)d.set(b.subarray(c,c+h),e),e+=h,c+=h;else for(;h--;)d[e++]=b[c++];this.c=c;this.a=e;this.b=d;break;case 1:this.l(K,I);break;case 2:k(this);break;default:a(Error("unknown BTYPE: "+b))}}return this.q()};p=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,
15];var A=q?new Uint16Array(p):p;p=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,258,258];var F=q?new Uint16Array(p):p;p=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0];var y=q?new Uint8Array(p):p;p=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577];var B=q?new Uint16Array(p):p;p=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13];var J=q?new Uint8Array(p):p;p=
new (q?Uint8Array:Array)(288);l=0;for(t=p.length;l<t;++l)p[l]=143>=l?8:255>=l?9:279>=l?7:8;var K=e(p);p=new (q?Uint8Array:Array)(30);l=0;for(t=p.length;l<t;++l)p[l]=5;var I=e(p);f.prototype.l=function(a,b){var c=this.b,d=this.a;this.r=a;for(var e=c.length-258,f,x,z;256!==(f=h(this,a));)if(256>f)d>=e&&(this.a=d,c=this.e(),d=this.a),c[d++]=f;else for(f-=257,z=F[f],0<y[f]&&(z+=g(this,y[f])),f=h(this,b),x=B[f],0<J[f]&&(x+=g(this,J[f])),d>=e&&(this.a=d,c=this.e(),d=this.a);z--;)c[d]=c[d++-x];for(;8<=this.d;)this.d-=
8,this.c--;this.a=d};f.prototype.C=function(a,b){var c=this.b,d=this.a;this.r=a;for(var e=c.length,f,x,z;256!==(f=h(this,a));)if(256>f)d>=e&&(c=this.e(),e=c.length),c[d++]=f;else for(f-=257,z=F[f],0<y[f]&&(z+=g(this,y[f])),f=h(this,b),x=B[f],0<J[f]&&(x+=g(this,J[f])),d+z>e&&(c=this.e(),e=c.length);z--;)c[d]=c[d++-x];for(;8<=this.d;)this.d-=8,this.c--;this.a=d};f.prototype.e=function(){var a=new (q?Uint8Array:Array)(this.a-32768),b=this.a-32768,c,d,e=this.b;if(q)a.set(e.subarray(32768,a.length));else for(c=
0,d=a.length;c<d;++c)a[c]=e[c+32768];this.i.push(a);this.n+=a.length;if(q)e.set(e.subarray(b,b+32768));else for(c=0;32768>c;++c)e[c]=e[b+c];this.a=32768;return e};f.prototype.D=function(a){var b,c=this.input.length/this.c+1|0,d,e,f,x=this.input,g=this.b;a&&("number"===typeof a.t&&(c=a.t),"number"===typeof a.z&&(c+=a.z));2>c?(d=(x.length-this.c)/this.r[2],f=d/2*258|0,e=f<g.length?g.length+f:g.length<<1):e=g.length*c;q?(b=new Uint8Array(e),b.set(g)):b=g;return this.b=b};f.prototype.q=function(){var a=
0,b=this.b,c=this.i,d,e=new (q?Uint8Array:Array)(this.n+(this.a-32768)),f,x,g,h;if(0===c.length)return q?this.b.subarray(32768,this.a):this.b.slice(32768,this.a);f=0;for(x=c.length;f<x;++f)for(d=c[f],g=0,h=d.length;g<h;++g)e[a++]=d[g];f=32768;for(x=this.a;f<x;++f)e[a++]=b[f];this.i=[];return this.buffer=e};f.prototype.A=function(){var a,b=this.a;q?this.w?(a=new Uint8Array(b),a.set(this.b.subarray(0,b))):a=this.b.subarray(0,b):(this.b.length>b&&(this.b.length=b),a=this.b);return this.buffer=a};n.prototype.F=
function(){this.s||this.g();return this.m.slice()};n.prototype.g=function(){for(var b=this.input.length;this.c<b;){var e=new d,g=void 0,h=void 0,m=void 0,k=g=m=void 0,x=void 0,g=g=void 0,z=this.input,h=this.c;e.u=z[h++];e.v=z[h++];31===e.u&&139===e.v||a(Error("invalid file signature:"+e.u+","+e.v));e.p=z[h++];switch(e.p){case 8:break;default:a(Error("unknown compression method: "+e.p))}e.h=z[h++];g=z[h++]|z[h++]<<8|z[h++]<<16|z[h++]<<24;e.H=new Date(1E3*g);e.N=z[h++];e.M=z[h++];0<(e.h&4)&&(e.I=z[h++]|
z[h++]<<8,h+=e.I);if(0<(e.h&8)){x=[];for(k=0;0<(g=z[h++]);)x[k++]=String.fromCharCode(g);e.name=x.join("")}if(0<(e.h&16)){x=[];for(k=0;0<(g=z[h++]);)x[k++]=String.fromCharCode(g);e.J=x.join("")}0<(e.h&2)&&(e.B=c(z,0,h)&65535,e.B!==(z[h++]|z[h++]<<8)&&a(Error("invalid header crc16")));g=z[z.length-4]|z[z.length-3]<<8|z[z.length-2]<<16|z[z.length-1]<<24;z.length-h-4-4<512*g&&(m=g);h=new f(z,{index:h,bufferSize:m});e.data=m=h.g();h=h.c;e.K=g=(z[h++]|z[h++]<<8|z[h++]<<16|z[h++]<<24)>>>0;c(m,void 0,void 0)!==
g&&a(Error("invalid CRC-32 checksum: 0x"+c(m,void 0,void 0).toString(16)+" / 0x"+g.toString(16)));e.L=g=(z[h++]|z[h++]<<8|z[h++]<<16|z[h++]<<24)>>>0;(m.length&4294967295)!==g&&a(Error("invalid input size: "+(m.length&4294967295)+" / "+g));this.m.push(e);this.c=h}this.s=!0;b=this.m;e=m=h=0;for(z=b.length;e<z;++e)m+=b[e].data.length;if(q)for(m=new Uint8Array(m),e=0;e<z;++e)m.set(b[e].data,h),h+=b[e].data.length;else{m=[];for(e=0;e<z;++e)m[e]=b[e].data;m=Array.prototype.concat.apply([],m)}return m};
b("Zlib.Gunzip",n);b("Zlib.Gunzip.prototype.decompress",n.prototype.g);b("Zlib.Gunzip.prototype.getMembers",n.prototype.F)}).call(this);
(function(){function a(a){throw a;}function b(a,b){var c=a.split("."),d=t;c[0]in d||!d.execScript||d.execScript("var "+c[0]);for(var e;c.length&&(e=c.shift());)c.length||void 0===b?d=d[e]?d[e]:d[e]={}:d[e]=b}function c(a){var b=a.length,c=0,d=Number.POSITIVE_INFINITY,e,f,g,h,m,k,l,v,p;for(v=0;v<b;++v)a[v]>c&&(c=a[v]),a[v]<d&&(d=a[v]);e=1<<c;f=new (u?Uint32Array:Array)(e);g=1;h=0;for(m=2;g<=c;){for(v=0;v<b;++v)if(a[v]===g){k=0;l=h;for(p=0;p<g;++p)k=k<<1|l&1,l>>=1;for(p=k;p<e;p+=m)f[p]=g<<16|v;++h}++g;
h<<=1;m<<=1}return[f,c,d]}function d(b,c){this.l=[];this.m=32768;this.d=this.f=this.c=this.t=0;this.input=u?new Uint8Array(b):b;this.u=!1;this.n=y;this.K=!1;if(c||!(c={}))c.index&&(this.c=c.index),c.bufferSize&&(this.m=c.bufferSize),c.bufferType&&(this.n=c.bufferType),c.resize&&(this.K=c.resize);switch(this.n){case F:this.a=32768;this.b=new (u?Uint8Array:Array)(32768+this.m+258);break;case y:this.a=0;this.b=new (u?Uint8Array:Array)(this.m);this.e=this.W;this.B=this.R;this.q=this.V;break;default:a(Error("invalid inflate mode"))}}
function e(b,c){for(var d=b.f,e=b.d,f=b.input,g=b.c,h;e<c;)h=f[g++],void 0===h&&a(Error("input buffer is broken")),d|=h<<e,e+=8;b.f=d>>>c;b.d=e-c;b.c=g;return d&(1<<c)-1}function f(a,b){for(var c=a.f,d=a.d,e=a.input,f=a.c,g=b[0],h=b[1],m;d<h;){m=e[f++];if(void 0===m)break;c|=m<<d;d+=8}e=g[c&(1<<h)-1];g=e>>>16;a.f=c>>g;a.d=d-g;a.c=f;return e&65535}function g(a){function b(a,c,d){var g,h,x,m;for(m=0;m<a;)switch(g=f(this,c),g){case 16:for(x=3+e(this,2);x--;)d[m++]=h;break;case 17:for(x=3+e(this,3);x--;)d[m++]=
0;h=0;break;case 18:for(x=11+e(this,7);x--;)d[m++]=0;h=0;break;default:h=d[m++]=g}return d}var d=e(a,5)+257,g=e(a,5)+1,h=e(a,4)+4,m=new (u?Uint8Array:Array)(B.length),k;for(k=0;k<h;++k)m[B[k]]=e(a,3);h=c(m);m=new (u?Uint8Array:Array)(d);k=new (u?Uint8Array:Array)(g);a.q(c(b.call(a,d,h,m)),c(b.call(a,g,h,k)))}function h(a){a=a||{};this.files=[];this.v=a.comment}function k(a,b){b=b||{};this.input=u&&a instanceof Array?new Uint8Array(a):a;this.c=0;this.ba=b.verify||!1;this.j=b.password}function n(a,
b){this.input=a;this.offset=b}function r(a,b){this.input=a;this.offset=b}function q(b){var c=[],d={},e,f,g,h;if(!b.i){if(void 0===b.o){e=b.input;if(!b.D)a:{f=b.input;for(g=f.length-12;0<g;--g)if(f[g]===H[0]&&f[g+1]===H[1]&&f[g+2]===H[2]&&f[g+3]===H[3]){b.D=g;break a}a(Error("End of Central Directory Record not found"))}f=b.D;e[f++]===H[0]&&e[f++]===H[1]&&e[f++]===H[2]&&e[f++]===H[3]||a(Error("invalid signature"));b.ha=e[f++]|e[f++]<<8;b.ja=e[f++]|e[f++]<<8;b.ka=e[f++]|e[f++]<<8;b.aa=e[f++]|e[f++]<<
8;b.Q=(e[f++]|e[f++]<<8|e[f++]<<16|e[f++]<<24)>>>0;b.o=(e[f++]|e[f++]<<8|e[f++]<<16|e[f++]<<24)>>>0;b.w=e[f++]|e[f++]<<8;b.v=u?e.subarray(f,f+b.w):e.slice(f,f+b.w)}e=b.o;g=0;for(h=b.aa;g<h;++g)f=new n(b.input,e),f.parse(),e+=f.length,c[g]=f,d[f.filename]=g;b.Q<e-b.o&&a(Error("invalid file header size"));b.i=c;b.G=d}}function p(a,b,c){c^=a.s(b);a.k(b,c);return c}var l,t=this,u="undefined"!==typeof Uint8Array&&"undefined"!==typeof Uint16Array&&"undefined"!==typeof Uint32Array;new (u?Uint8Array:Array)(256);
for(l=0;256>l;++l)for(var m=l,w=7,m=m>>>1;m;m>>>=1)--w;l=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,
3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,
314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,
3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,
1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,
1231636301,1047427035,2932959818,3654703836,1088359270,936918E3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117];var A=u?new Uint32Array(l):l;l=[];for(m=0;288>m;m++)switch(!0){case 143>=m:l.push([m+48,8]);break;case 255>=m:l.push([m-144+400,9]);break;case 279>=m:l.push([m-256+0,7]);break;case 287>=m:l.push([m-280+192,8]);break;default:a("invalid literal: "+
m)}l=function(){function b(c){switch(!0){case 3===c:return[257,c-3,0];case 4===c:return[258,c-4,0];case 5===c:return[259,c-5,0];case 6===c:return[260,c-6,0];case 7===c:return[261,c-7,0];case 8===c:return[262,c-8,0];case 9===c:return[263,c-9,0];case 10===c:return[264,c-10,0];case 12>=c:return[265,c-11,1];case 14>=c:return[266,c-13,1];case 16>=c:return[267,c-15,1];case 18>=c:return[268,c-17,1];case 22>=c:return[269,c-19,2];case 26>=c:return[270,c-23,2];case 30>=c:return[271,c-27,2];case 34>=c:return[272,
c-31,2];case 42>=c:return[273,c-35,3];case 50>=c:return[274,c-43,3];case 58>=c:return[275,c-51,3];case 66>=c:return[276,c-59,3];case 82>=c:return[277,c-67,4];case 98>=c:return[278,c-83,4];case 114>=c:return[279,c-99,4];case 130>=c:return[280,c-115,4];case 162>=c:return[281,c-131,5];case 194>=c:return[282,c-163,5];case 226>=c:return[283,c-195,5];case 257>=c:return[284,c-227,5];case 258===c:return[285,c-258,0];default:a("invalid length: "+c)}}var c=[],d,e;for(d=3;258>=d;d++)e=b(d),c[d]=e[2]<<24|e[1]<<
16|e[0];return c}();u&&new Uint32Array(l);var F=0,y=1;d.prototype.r=function(){for(;!this.u;){var b=e(this,3);b&1&&(this.u=!0);b>>>=1;switch(b){case 0:var b=this.input,c=this.c,d=this.b,f=this.a,h=void 0,m=void 0,k=void 0,l=d.length,h=void 0;this.d=this.f=0;h=b[c++];void 0===h&&a(Error("invalid uncompressed block header: LEN (first byte)"));m=h;h=b[c++];void 0===h&&a(Error("invalid uncompressed block header: LEN (second byte)"));m|=h<<8;h=b[c++];void 0===h&&a(Error("invalid uncompressed block header: NLEN (first byte)"));
k=h;h=b[c++];void 0===h&&a(Error("invalid uncompressed block header: NLEN (second byte)"));k|=h<<8;m===~k&&a(Error("invalid uncompressed block header: length verify"));c+m>b.length&&a(Error("input buffer is broken"));switch(this.n){case F:for(;f+m>d.length;){h=l-f;m-=h;if(u)d.set(b.subarray(c,c+h),f),f+=h,c+=h;else for(;h--;)d[f++]=b[c++];this.a=f;d=this.e();f=this.a}break;case y:for(;f+m>d.length;)d=this.e({H:2});break;default:a(Error("invalid inflate mode"))}if(u)d.set(b.subarray(c,c+m),f),f+=m,
c+=m;else for(;m--;)d[f++]=b[c++];this.c=c;this.a=f;this.b=d;break;case 1:this.q(E,v);break;case 2:g(this);break;default:a(Error("unknown BTYPE: "+b))}}return this.B()};l=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];var B=u?new Uint16Array(l):l;l=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,258,258];var J=u?new Uint16Array(l):l;l=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0];var K=u?new Uint8Array(l):l;l=[1,2,3,4,5,7,9,13,17,25,33,49,
65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577];var I=u?new Uint16Array(l):l;l=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13];var D=u?new Uint8Array(l):l;l=new (u?Uint8Array:Array)(288);m=0;for(w=l.length;m<w;++m)l[m]=143>=m?8:255>=m?9:279>=m?7:8;var E=c(l);l=new (u?Uint8Array:Array)(30);m=0;for(w=l.length;m<w;++m)l[m]=5;var v=c(l);l=d.prototype;l.q=function(a,b){var c=this.b,d=this.a;this.C=a;for(var g=c.length-258,h,m,k;256!==(h=f(this,
a));)if(256>h)d>=g&&(this.a=d,c=this.e(),d=this.a),c[d++]=h;else for(h-=257,k=J[h],0<K[h]&&(k+=e(this,K[h])),h=f(this,b),m=I[h],0<D[h]&&(m+=e(this,D[h])),d>=g&&(this.a=d,c=this.e(),d=this.a);k--;)c[d]=c[d++-m];for(;8<=this.d;)this.d-=8,this.c--;this.a=d};l.V=function(a,b){var c=this.b,d=this.a;this.C=a;for(var g=c.length,h,m,k;256!==(h=f(this,a));)if(256>h)d>=g&&(c=this.e(),g=c.length),c[d++]=h;else for(h-=257,k=J[h],0<K[h]&&(k+=e(this,K[h])),h=f(this,b),m=I[h],0<D[h]&&(m+=e(this,D[h])),d+k>g&&(c=
this.e(),g=c.length);k--;)c[d]=c[d++-m];for(;8<=this.d;)this.d-=8,this.c--;this.a=d};l.e=function(){var a=new (u?Uint8Array:Array)(this.a-32768),b=this.a-32768,c,d,e=this.b;if(u)a.set(e.subarray(32768,a.length));else for(c=0,d=a.length;c<d;++c)a[c]=e[c+32768];this.l.push(a);this.t+=a.length;if(u)e.set(e.subarray(b,b+32768));else for(c=0;32768>c;++c)e[c]=e[b+c];this.a=32768;return e};l.W=function(a){var b,c=this.input.length/this.c+1|0,d,e,f,h=this.input,g=this.b;a&&("number"===typeof a.H&&(c=a.H),
"number"===typeof a.P&&(c+=a.P));2>c?(d=(h.length-this.c)/this.C[2],f=d/2*258|0,e=f<g.length?g.length+f:g.length<<1):e=g.length*c;u?(b=new Uint8Array(e),b.set(g)):b=g;return this.b=b};l.B=function(){var a=0,b=this.b,c=this.l,d,e=new (u?Uint8Array:Array)(this.t+(this.a-32768)),f,h,g,m;if(0===c.length)return u?this.b.subarray(32768,this.a):this.b.slice(32768,this.a);f=0;for(h=c.length;f<h;++f)for(d=c[f],g=0,m=d.length;g<m;++g)e[a++]=d[g];f=32768;for(h=this.a;f<h;++f)e[a++]=b[f];this.l=[];return this.buffer=
e};l.R=function(){var a,b=this.a;u?this.K?(a=new Uint8Array(b),a.set(this.b.subarray(0,b))):a=this.b.subarray(0,b):(this.b.length>b&&(this.b.length=b),a=this.b);return this.buffer=a};h.prototype.L=function(a){this.j=a};h.prototype.s=function(a){a=a[2]&65535|2;return a*(a^1)>>8&255};h.prototype.k=function(a,b){a[0]=(A[(a[0]^b)&255]^a[0]>>>8)>>>0;a[1]=(6681*(20173*(a[1]+(a[0]&255))>>>0)>>>0)+1>>>0;a[2]=(A[(a[2]^a[1]>>>24)&255]^a[2]>>>8)>>>0};h.prototype.T=function(a){var b=[305419896,591751049,878082192],
c,d;u&&(b=new Uint32Array(b));c=0;for(d=a.length;c<d;++c)this.k(b,a[c]&255);return b};var C=[80,75,1,2],G=[80,75,3,4],H=[80,75,5,6];n.prototype.parse=function(){var b=this.input,c=this.offset;b[c++]===C[0]&&b[c++]===C[1]&&b[c++]===C[2]&&b[c++]===C[3]||a(Error("invalid file header signature"));this.version=b[c++];this.ia=b[c++];this.Z=b[c++]|b[c++]<<8;this.I=b[c++]|b[c++]<<8;this.A=b[c++]|b[c++]<<8;this.time=b[c++]|b[c++]<<8;this.U=b[c++]|b[c++]<<8;this.p=(b[c++]|b[c++]<<8|b[c++]<<16|b[c++]<<24)>>>
0;this.z=(b[c++]|b[c++]<<8|b[c++]<<16|b[c++]<<24)>>>0;this.J=(b[c++]|b[c++]<<8|b[c++]<<16|b[c++]<<24)>>>0;this.h=b[c++]|b[c++]<<8;this.g=b[c++]|b[c++]<<8;this.F=b[c++]|b[c++]<<8;this.ea=b[c++]|b[c++]<<8;this.ga=b[c++]|b[c++]<<8;this.fa=b[c++]|b[c++]<<8|b[c++]<<16|b[c++]<<24;this.$=(b[c++]|b[c++]<<8|b[c++]<<16|b[c++]<<24)>>>0;this.filename=String.fromCharCode.apply(null,u?b.subarray(c,c+=this.h):b.slice(c,c+=this.h));this.X=u?b.subarray(c,c+=this.g):b.slice(c,c+=this.g);this.v=u?b.subarray(c,c+this.F):
b.slice(c,c+this.F);this.length=c-this.offset};r.prototype.parse=function(){var b=this.input,c=this.offset;b[c++]===G[0]&&b[c++]===G[1]&&b[c++]===G[2]&&b[c++]===G[3]||a(Error("invalid local file header signature"));this.Z=b[c++]|b[c++]<<8;this.I=b[c++]|b[c++]<<8;this.A=b[c++]|b[c++]<<8;this.time=b[c++]|b[c++]<<8;this.U=b[c++]|b[c++]<<8;this.p=(b[c++]|b[c++]<<8|b[c++]<<16|b[c++]<<24)>>>0;this.z=(b[c++]|b[c++]<<8|b[c++]<<16|b[c++]<<24)>>>0;this.J=(b[c++]|b[c++]<<8|b[c++]<<16|b[c++]<<24)>>>0;this.h=
b[c++]|b[c++]<<8;this.g=b[c++]|b[c++]<<8;this.filename=String.fromCharCode.apply(null,u?b.subarray(c,c+=this.h):b.slice(c,c+=this.h));this.X=u?b.subarray(c,c+=this.g):b.slice(c,c+=this.g);this.length=c-this.offset};l=k.prototype;l.Y=function(){var a=[],b,c,d;this.i||q(this);d=this.i;b=0;for(c=d.length;b<c;++b)a[b]=d[b].filename;return a};l.r=function(b,c){var e;this.G||q(this);e=this.G[b];void 0===e&&a(Error(b+" not found"));var f;f=c||{};var h=this.input,g=this.i,m,k,l,v;g||q(this);void 0===g[e]&&
a(Error("wrong index"));g=g[e].$;e=new r(this.input,g);e.parse();g+=e.length;m=e.z;if(0!==(e.I&1)){f.password||this.j||a(Error("please set password"));f=this.S(f.password||this.j);l=g;for(v=g+12;l<v;++l)p(this,f,h[l]);g+=12;m-=12;l=g;for(v=g+m;l<v;++l)h[l]=p(this,f,h[l])}switch(e.A){case 0:k=u?this.input.subarray(g,g+m):this.input.slice(g,g+m);break;case 8:k=(new d(this.input,{index:g,bufferSize:e.J})).r();break;default:a(Error("unknown compression type"))}if(this.ba){h=void 0;m="number"===typeof h?
h:h=0;f=k.length;g=-1;for(m=f&7;m--;++h)g=g>>>8^A[(g^k[h])&255];for(m=f>>3;m--;h+=8)g=g>>>8^A[(g^k[h])&255],g=g>>>8^A[(g^k[h+1])&255],g=g>>>8^A[(g^k[h+2])&255],g=g>>>8^A[(g^k[h+3])&255],g=g>>>8^A[(g^k[h+4])&255],g=g>>>8^A[(g^k[h+5])&255],g=g>>>8^A[(g^k[h+6])&255],g=g>>>8^A[(g^k[h+7])&255];h=(g^4294967295)>>>0;e.p!==h&&a(Error("wrong crc: file=0x"+e.p.toString(16)+", data=0x"+h.toString(16)))}return k};l.L=function(a){this.j=a};l.k=h.prototype.k;l.S=h.prototype.T;l.s=h.prototype.s;b("Zlib.Unzip",k);
b("Zlib.Unzip.prototype.decompress",k.prototype.r);b("Zlib.Unzip.prototype.getFilenames",k.prototype.Y);b("Zlib.Unzip.prototype.setPassword",k.prototype.L)}).call(this);
(function(){function a(a){throw a;}function b(a,b){var c=a.split("."),d=k;c[0]in d||!d.execScript||d.execScript("var "+c[0]);for(var e;c.length&&(e=c.shift());)c.length||void 0===b?d=d[e]?d[e]:d[e]={}:d[e]=b}function c(a){var b=a.length,c=0,d=Number.POSITIVE_INFINITY,e,f,g,h,m,k,l,p,t;for(p=0;p<b;++p)a[p]>c&&(c=a[p]),a[p]<d&&(d=a[p]);e=1<<c;f=new (n?Uint32Array:Array)(e);g=1;h=0;for(m=2;g<=c;){for(p=0;p<b;++p)if(a[p]===g){k=0;l=h;for(t=0;t<g;++t)k=k<<1|l&1,l>>=1;for(t=k;t<e;t+=m)f[t]=g<<16|p;++h}++g;
h<<=1;m<<=1}return[f,c,d]}function d(b,c){this.g=[];this.h=32768;this.d=this.f=this.a=this.l=0;this.input=n?new Uint8Array(b):b;this.m=!1;this.i=q;this.r=!1;if(c||!(c={}))c.index&&(this.a=c.index),c.bufferSize&&(this.h=c.bufferSize),c.bufferType&&(this.i=c.bufferType),c.resize&&(this.r=c.resize);switch(this.i){case r:this.b=32768;this.c=new (n?Uint8Array:Array)(32768+this.h+258);break;case q:this.b=0;this.c=new (n?Uint8Array:Array)(this.h);this.e=this.z;this.n=this.v;this.j=this.w;break;default:a(Error("invalid inflate mode"))}}
function e(b,c){for(var d=b.f,e=b.d,f=b.input,g=b.a,h;e<c;)h=f[g++],void 0===h&&a(Error("input buffer is broken")),d|=h<<e,e+=8;b.f=d>>>c;b.d=e-c;b.a=g;return d&(1<<c)-1}function f(a,b){for(var c=a.f,d=a.d,e=a.input,f=a.a,g=b[0],h=b[1],m;d<h;){m=e[f++];if(void 0===m)break;c|=m<<d;d+=8}e=g[c&(1<<h)-1];g=e>>>16;a.f=c>>g;a.d=d-g;a.a=f;return e&65535}function g(a){function b(a,c,d){var g,h,m,k;for(k=0;k<a;)switch(g=f(this,c),g){case 16:for(m=3+e(this,2);m--;)d[k++]=h;break;case 17:for(m=3+e(this,3);m--;)d[k++]=
0;h=0;break;case 18:for(m=11+e(this,7);m--;)d[k++]=0;h=0;break;default:h=d[k++]=g}return d}var d=e(a,5)+257,g=e(a,5)+1,h=e(a,4)+4,m=new (n?Uint8Array:Array)(u.length),k;for(k=0;k<h;++k)m[u[k]]=e(a,3);h=c(m);m=new (n?Uint8Array:Array)(d);k=new (n?Uint8Array:Array)(g);a.j(c(b.call(a,d,h,m)),c(b.call(a,g,h,k)))}function h(b,c){var e,f;this.input=b;this.a=0;if(c||!(c={}))c.index&&(this.a=c.index),c.verify&&(this.A=c.verify);e=b[this.a++];f=b[this.a++];switch(e&15){case I:this.method=I;break;default:a(Error("unsupported compression method"))}0!==
((e<<8)+f)%31&&a(Error("invalid fcheck flag:"+((e<<8)+f)%31));f&32&&a(Error("fdict flag is not supported"));this.q=new d(b,{index:this.a,bufferSize:c.bufferSize,bufferType:c.bufferType,resize:c.resize})}var k=this,n="undefined"!==typeof Uint8Array&&"undefined"!==typeof Uint16Array&&"undefined"!==typeof Uint32Array,r=0,q=1,p=r,l=q;d.prototype.k=function(){for(;!this.m;){var b=e(this,3);b&1&&(this.m=!0);b>>>=1;switch(b){case 0:var b=this.input,c=this.a,d=this.c,f=this.b,h=void 0,m=void 0,k=void 0,l=
d.length,h=void 0;this.d=this.f=0;h=b[c++];void 0===h&&a(Error("invalid uncompressed block header: LEN (first byte)"));m=h;h=b[c++];void 0===h&&a(Error("invalid uncompressed block header: LEN (second byte)"));m|=h<<8;h=b[c++];void 0===h&&a(Error("invalid uncompressed block header: NLEN (first byte)"));k=h;h=b[c++];void 0===h&&a(Error("invalid uncompressed block header: NLEN (second byte)"));k|=h<<8;m===~k&&a(Error("invalid uncompressed block header: length verify"));c+m>b.length&&a(Error("input buffer is broken"));
switch(this.i){case r:for(;f+m>d.length;){h=l-f;m-=h;if(n)d.set(b.subarray(c,c+h),f),f+=h,c+=h;else for(;h--;)d[f++]=b[c++];this.b=f;d=this.e();f=this.b}break;case q:for(;f+m>d.length;)d=this.e({p:2});break;default:a(Error("invalid inflate mode"))}if(n)d.set(b.subarray(c,c+m),f),f+=m,c+=m;else for(;m--;)d[f++]=b[c++];this.a=c;this.b=f;this.c=d;break;case 1:this.j(J,K);break;case 2:g(this);break;default:a(Error("unknown BTYPE: "+b))}}return this.n()};var t=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,
1,15],u=n?new Uint16Array(t):t,t=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,258,258],m=n?new Uint16Array(t):t,t=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0],w=n?new Uint8Array(t):t,t=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],A=n?new Uint16Array(t):t,t=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],F=n?new Uint8Array(t):t,t=new (n?Uint8Array:
Array)(288),y,B;y=0;for(B=t.length;y<B;++y)t[y]=143>=y?8:255>=y?9:279>=y?7:8;var J=c(t),t=new (n?Uint8Array:Array)(30);y=0;for(B=t.length;y<B;++y)t[y]=5;var K=c(t);d.prototype.j=function(a,b){var c=this.c,d=this.b;this.o=a;for(var g=c.length-258,h,k,l;256!==(h=f(this,a));)if(256>h)d>=g&&(this.b=d,c=this.e(),d=this.b),c[d++]=h;else for(h-=257,l=m[h],0<w[h]&&(l+=e(this,w[h])),h=f(this,b),k=A[h],0<F[h]&&(k+=e(this,F[h])),d>=g&&(this.b=d,c=this.e(),d=this.b);l--;)c[d]=c[d++-k];for(;8<=this.d;)this.d-=
8,this.a--;this.b=d};d.prototype.w=function(a,b){var c=this.c,d=this.b;this.o=a;for(var h=c.length,g,k,l;256!==(g=f(this,a));)if(256>g)d>=h&&(c=this.e(),h=c.length),c[d++]=g;else for(g-=257,l=m[g],0<w[g]&&(l+=e(this,w[g])),g=f(this,b),k=A[g],0<F[g]&&(k+=e(this,F[g])),d+l>h&&(c=this.e(),h=c.length);l--;)c[d]=c[d++-k];for(;8<=this.d;)this.d-=8,this.a--;this.b=d};d.prototype.e=function(){var a=new (n?Uint8Array:Array)(this.b-32768),b=this.b-32768,c,d,e=this.c;if(n)a.set(e.subarray(32768,a.length));else for(c=
0,d=a.length;c<d;++c)a[c]=e[c+32768];this.g.push(a);this.l+=a.length;if(n)e.set(e.subarray(b,b+32768));else for(c=0;32768>c;++c)e[c]=e[b+c];this.b=32768;return e};d.prototype.z=function(a){var b,c=this.input.length/this.a+1|0,d,e,f,g=this.input,h=this.c;a&&("number"===typeof a.p&&(c=a.p),"number"===typeof a.u&&(c+=a.u));2>c?(d=(g.length-this.a)/this.o[2],f=d/2*258|0,e=f<h.length?h.length+f:h.length<<1):e=h.length*c;n?(b=new Uint8Array(e),b.set(h)):b=h;return this.c=b};d.prototype.n=function(){var a=
0,b=this.c,c=this.g,d,e=new (n?Uint8Array:Array)(this.l+(this.b-32768)),f,h,g,m;if(0===c.length)return n?this.c.subarray(32768,this.b):this.c.slice(32768,this.b);f=0;for(h=c.length;f<h;++f)for(d=c[f],g=0,m=d.length;g<m;++g)e[a++]=d[g];f=32768;for(h=this.b;f<h;++f)e[a++]=b[f];this.g=[];return this.buffer=e};d.prototype.v=function(){var a,b=this.b;n?this.r?(a=new Uint8Array(b),a.set(this.c.subarray(0,b))):a=this.c.subarray(0,b):(this.c.length>b&&(this.c.length=b),a=this.c);return this.buffer=a};h.prototype.k=
function(){var b=this.input,c;c=this.q.k();this.a=this.q.a;if(this.A){var b=(b[this.a++]<<24|b[this.a++]<<16|b[this.a++]<<8|b[this.a++])>>>0,d=c;if("string"===typeof d){var d=d.split(""),e,f;e=0;for(f=d.length;e<f;e++)d[e]=(d[e].charCodeAt(0)&255)>>>0}e=1;f=0;for(var h=d.length,g,m=0;0<h;){g=1024<h?1024:h;h-=g;do e+=d[m++],f+=e;while(--g);e%=65521;f%=65521}b!==(f<<16|e)>>>0&&a(Error("invalid adler-32 checksum"))}return c};var I=8;b("Zlib.Inflate",h);b("Zlib.Inflate.prototype.decompress",h.prototype.k);
var p={ADAPTIVE:l,BLOCK:p},D;if(Object.keys)l=Object.keys(p);else for(D in l=[],t=0,p)l[t++]=D;t=0;for(y=l.length;t<y;++t)D=l[t],b("Zlib.Inflate.BufferType."+D,p[D])}).call(this);
(function(a){var b="object"==typeof exports&&exports,c="object"==typeof module&&module&&module.exports==b&&module,d="object"==typeof global&&global;if(d.global===d||d.window===d)a=d;var e=function(a){this.message=a};e.prototype=Error();e.prototype.name="InvalidCharacterError";var f=/<%= spaceCharacters %>/g,g={encode:function(a){a=String(a);if(/[^\0-\xFF]/.test(a))throw new e("The string to be encoded contains characters outside of the Latin1 range.");for(var b=a.length%3,c="",d=-1,f,h,g,u=a.length-
b;++d<u;)f=a.charCodeAt(d)<<16,h=a.charCodeAt(++d)<<8,g=a.charCodeAt(++d),f=f+h+g,c+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(f>>18&63)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(f>>12&63)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(f>>6&63)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(f&63);2==b?(f=a.charCodeAt(d)<<8,h=a.charCodeAt(++d),f+=h,c+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(f>>
10)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(f>>4&63)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(f<<2&63)+"="):1==b&&(f=a.charCodeAt(d),c+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(f>>2)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(f<<4&63)+"==");return c},decode:function(a){a=String(a).replace(f,"");var b=a.length;0==b%4&&(a=a.replace(/==?$/,""),b=a.length);if(1==b%4||/[^+a-zA-Z0-9/]/.test(a))throw new e("Invalid character: the string to be decoded is not correctly encoded.");
for(var c=0,d,h,g="",t=-1;++t<b;)h="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(a.charAt(t)),d=c%4?64*d+h:h,c++%4&&(g+=String.fromCharCode(255&d>>(-2*c&6)));return g},version:"<%= version %>"};if("function"==typeof define&&"object"==typeof define.amd&&define.amd)define(function(){return g});else if(b&&!b.nodeType)if(c)c.exports=g;else for(var h in g)g.hasOwnProperty(h)&&(b[h]=g[h]);else a.base64=g})(this);
function InputStream(a){this.buffer=a;this.offset=0;this.byteLength=a.length;this.convBuf=new ArrayBuffer(8);this.convUint8=new Uint8Array(this.convBuf);this.convUint16=new Uint16Array(this.convBuf);this.convInt32=new Int32Array(this.convBuf);this.convUint32=new Uint32Array(this.convBuf);this.convFloat32=new Float32Array(this.convBuf);this.convFloat64=new Float64Array(this.convBuf)}InputStream.prototype.seek=function(a){this.offset=a};
InputStream.prototype.getBytes=function(a){var b=new Uint8Array(this.buffer.buffer,this.offset,a);this.offset+=a;return b};InputStream.prototype.getVarints=function(){var a,b=0,c=0;do a=this.buffer[this.offset++],b|=(a&127)<<c,c+=7;while(a&128);return b};InputStream.prototype.getUint8=function(){return this.buffer[this.offset++]};InputStream.prototype.getUint16=function(){this.convUint8[0]=this.buffer[this.offset++];this.convUint8[1]=this.buffer[this.offset++];return this.convUint16[0]};
InputStream.prototype.getInt16=function(){var a=this.getUint16();32767<a&&(a|=4294901760);return a};InputStream.prototype.getInt32=function(){var a=this.buffer,b=this.convUint8,c=this.offset;b[0]=a[c];b[1]=a[c+1];b[2]=a[c+2];b[3]=a[c+3];this.offset+=4;return this.convInt32[0]};InputStream.prototype.getUint32=function(){var a=this.buffer,b=this.convUint8,c=this.offset;b[0]=a[c];b[1]=a[c+1];b[2]=a[c+2];b[3]=a[c+3];this.offset+=4;return this.convUint32[0]};
InputStream.prototype.getFloat32=function(){var a=this.buffer,b=this.convUint8,c=this.offset;b[0]=a[c];b[1]=a[c+1];b[2]=a[c+2];b[3]=a[c+3];this.offset+=4;return this.convFloat32[0]};InputStream.prototype.getFloat64=function(){for(var a=this.buffer,b=this.convUint8,c=this.offset,d=0;8>d;d++)b[d]=a[c+d];this.offset+=8;return this.convFloat64[0]};
InputStream.prototype.getString=function(a){for(var b=this.buffer,c="",d=this.offset,e=this.offset+a;d<e;d++)c+=String.fromCharCode(b[d]);this.offset+=a;var f;try{f=decodeURIComponent(escape(c))}catch(g){f=c,debug("Failed to decode string "+f)}return f};InputStream.prototype.reset=function(a){this.buffer=a;this.offset=0;this.byteLength=a.length};
VBUtils={deduceUVRepetition:function(a){for(var b in a.vblayout)if(0==b.indexOf("uv"))for(var c=a.vbstride,d=a.vb,e=a.vb.length/c,f=0,g=a.vblayout[b].offset;f<e;f++,g+=c){var h=d[g],k=d[g+1];if(2<h||0>h||2<k||0>k){a.vblayout[b].isPattern=!0;break}}},computeBounds3D:function(a){var b=Infinity,c=Infinity,d=Infinity,e=-Infinity,f=-Infinity,g=-Infinity,h,k,n,r,q,p=a.vbstride,l=a.vblayout.position.offset,t=a.vb,u=a.vb.length/p;h=0;for(k=l;h<u;h++,k+=p)n=t[k],r=t[k+1],q=t[k+2],b>n&&(b=n),c>r&&(c=r),d>q&&
(d=q),e<n&&(e=n),f<r&&(f=r),g<q&&(g=q);a.boundingBox={min:{x:b,y:c,z:d},max:{x:e,y:f,z:g}};b=.5*(b+e);c=.5*(c+f);d=.5*(d+g);a=a.boundingSphere={};a.center={x:b,y:c,z:d};h=g=0;for(k=l;h<u;h++,k+=p)n=t[k],r=t[k+1],q=t[k+2],n-=b,r-=c,q-=d,q=n*n+r*r+q*q,q>g&&(g=q);a.radius=Math.sqrt(g)},bboxUnion:function(a,b){b.min.x<a.min.x&&(a.min.x=b.min.x);b.min.y<a.min.y&&(a.min.y=b.min.y);b.min.z<a.min.z&&(a.min.z=b.min.z);b.max.x>a.max.x&&(a.max.x=b.max.x);b.max.y>a.max.y&&(a.max.y=b.max.y);b.max.z>a.max.z&&(a.max.z=
b.max.z)}};
(function(a){function b(a,b){var c=b||65536;this.useInstancing=a;this.stride=12;this.vb=new ArrayBuffer(4*this.stride*(this.useInstancing?c/4:c));this.vbf=new Float32Array(this.vb);this.vbi=new Int32Array(this.vb);this.vcount=0;this.ib=this.useInstancing?null:new Uint16Array(c);this.icount=0;this.minx=this.miny=Infinity;this.maxx=this.maxy=-Infinity;this.dbIds={};this.numTriangleGeoms=this.numCirculars=this.numEllipticals=0}var c=2*Math.PI;b.prototype.expandStride=function(){var a=this.stride;if(!(12<=
a)){for(var b=this.stride+2,c=new ArrayBuffer(this.vb.byteLength/a*b),g=new Uint8Array(this.vb),h=new Uint8Array(c),k=0,n=this.vcount;k<n;k++)for(var r=k*a*4,q=k*b*4,p=0;p<4*a;p++)h[q+p]=g[r+p];this.vb=c;this.vbf=new Float32Array(c);this.vbi=new Int32Array(c);this.stride=b}};b.prototype.addToBounds=function(a,b){a<this.minx&&(this.minx=a);a>this.maxx&&(this.maxx=a);b<this.miny&&(this.miny=b);b>this.maxy&&(this.maxy=b)};b.prototype.setVertexFlag=function(a,b,c,g){this.vbi[a*this.stride+9]=g|c|b<<16};
b.prototype.addVertexTriangleGeom=function(a,b,c,g,h,k,n,r,q){for(var p=this.vcount,l=this.useInstancing?1:4,t=0;t<l;t++){var u=(p+t)*this.stride,m=this.vbf;m[u]=a;m[u+1]=b;m[u+2]=c;m[u+3]=g;m[u+4]=h;m[u+5]=k;this.vbi[u+6]=n;this.vbi[u+7]=r;this.vbi[u+8]=q<<16;this.vcount++;this.dbIds[r]=1}return p};b.prototype.addVertexLine=function(a,b,c,g,h,k,n,r,q,p){for(var l=this.vcount,t=this.useInstancing?1:4,u=0;u<t;u++){var m=(l+u)*this.stride,w=this.vbf;w[m]=a;w[m+1]=b;w[m+2]=c;w[m+3]=g;w[m+4]=k;w[m+5]=
h;this.vbi[m+6]=n;this.vbi[m+7]=r;this.vbi[m+8]=q<<16|p;this.dbIds[r]=1;this.vcount++}return l};b.prototype.addVertexArc=function(a,b,c,g,h,k,n,r,q,p,l){for(var t=this.vcount,u=this.useInstancing?1:4,m=0;m<u;m++){var w=(t+m)*this.stride,A=this.vbf;A[w]=a;A[w+1]=b;A[w+2]=c;A[w+3]=g;A[w+4]=r;A[w+5]=h;this.vbi[w+6]=q;this.vbi[w+7]=p;this.vbi[w+8]=l<<16|0;h!=k&&(A[w+10]=k,A[w+11]=n);this.dbIds[p]=1;this.vcount++}return t};b.prototype.addVertex=function(a,b,c,g,h,k,n,r,q){if(!this.useInstancing){var p=
this.vcount,l=p*this.stride,t=this.vbf;t[l]=a;t[l+1]=b;t[l+2]=c;t[l+3]=g;t[l+4]=h;t[l+5]=0;this.vbi[l+6]=k;this.vbi[l+7]=n;this.vbi[l+8]=q<<16|0;this.setVertexFlag(p,r,0,0);this.vcount++;this.dbIds[n]=1;return p}};b.prototype.addVertexPolytriangle=function(a,b,c,g,h,k,n,r,q){this.useInstancing||(this.addVertex(a,b,c,g,h,k,n,r,q),this.addToBounds(a,b))};b.prototype.setVertexColor=function(a,b){this.useInstancing||(this.vbi[a*this.stride+6]=b)};b.prototype.addTriangle=function(a,b,c){if(!this.useInstancing){var g=
this.ib,h=this.icount;if(h+3>=g.length){for(var k=new Uint16Array(2*g.length),n=0;n<h;n++)k[n]=g[n];this.ib=g=k}g[h]=a;g[h+1]=b;g[h+2]=c;this.icount+=3}};b.prototype.finalizeQuad=function(a,b,c){this.useInstancing?this.setVertexFlag(a,c,0,b):(this.addTriangle(a,a+1,a+2),this.addTriangle(a,a+2,a+3),this.setVertexFlag(a,c,1,b),this.setVertexFlag(a+1,c,3,b),this.setVertexFlag(a+2,c,4,b),this.setVertexFlag(a+3,c,2,b))};b.prototype.addSegment=function(a,b,c,g,h,k,n,r,q,p,l){var t=c-a,u=g-b,m=0;if(t||u)m=
Math.atan2(u,t);t=Math.sqrt(t*t+u*u);h=this.addVertexLine(a,b,m,t,h,.5*k,n,r,p,l);this.finalizeQuad(h,16,q);this.addToBounds(a,b);this.addToBounds(c,g)};b.prototype.addTriangleGeom=function(a,b,c,g,h,k,n,r,q,p){this.numTriangleGeoms++;n=this.addVertexTriangleGeom(a,b,c,g,h,k,n,r,q,p);this.finalizeQuad(n,80,q);this.addToBounds(a,b);this.addToBounds(c,g);this.addToBounds(h,k)};b.prototype.addCircularArc=function(a,b,f,g,h,k,n,r,q,p){this.numCirculars++;0==f&&0==g&&(g=c);var l=Math.abs(f-g);if(1E-4<
l&&1E-4<Math.abs(l-c)){var l=a+h*Math.cos(f),t=b+h*Math.sin(f);this.addSegment(l,t,l,t,0,k,n,r,q,p);l=a+h*Math.cos(g);t=b+h*Math.sin(g);this.addSegment(l,t,l,t,0,k,n,r,q,p)}else this.addToBounds(a-h,b-h),this.addToBounds(a+h,b+h);a=this.addVertexArc(a,b,f,g,h,h,0,.5*k,n,r,p);this.finalizeQuad(a,32,q)};b.prototype.addEllipticalArc=function(a,b,f,g,h,k,n,r,q,p,l,t){this.expandStride();this.numEllipticals++;0==f&&0==g&&(g=c);var u=Math.abs(f-g);if(1E-4<Math.abs(u-c)){var u=a+h*Math.cos(f),m=b+k*Math.sin(f);
this.addSegment(u,m,u,m,0,r,q,p,l,t);u=a+h*Math.cos(g);m=b+k*Math.sin(g);this.addSegment(u,m,u,m,0,r,q,p,l,t)}else this.addToBounds(a-h,b-k),this.addToBounds(a+h,b+k);a=this.addVertexArc(a,b,f,g,h,k,n,.5*r,q,p,t);this.finalizeQuad(a,48,l)};b.prototype.addTexturedQuad=function(a,b,c,g,h,k,n){var r=.5*g;h=this.addVertexLine(a,b+r,0,c,0,r,4278255615,h,n,0);this.finalizeQuad(h,64,k);this.addToBounds(a,b);this.addToBounds(a+c,b+g)};b.prototype.isFull=function(a){a||(a=3);return this.useInstancing?32767<
4*this.vcount+a:32767<this.vcount+a};b.prototype.toMesh=function(){var a={};a.vb=new Float32Array(this.vb.slice(0,this.vcount*this.stride*4));a.vbstride=this.stride;var b=this.useInstancing?1:0;a.vblayout={fields1:{offset:0,itemSize:3,bytesPerItem:4,divisor:b},fields2:{offset:3,itemSize:3,bytesPerItem:4,divisor:b},color4b:{offset:6,itemSize:4,bytesPerItem:1,divisor:b,normalize:!0},dbId4b:{offset:7,itemSize:4,bytesPerItem:1,divisor:b,normalize:!0},linetype4b:{offset:8,itemSize:4,bytesPerItem:1,divisor:b,
normalize:!1},flags4b:{offset:9,itemSize:4,bytesPerItem:1,divisor:b,normalize:!1}};10<this.stride&&(a.vblayout.extraParams={offset:10,itemSize:2,bytesPerItem:4,divisor:b,normalize:!1});if(this.useInstancing){for(var c in a.vblayout)a.vblayout[c].divisor=1;a.numInstances=this.vcount;b=new Int32Array(4);b[0]=1;b[1]=3;b[2]=4;b[3]=2;a.vblayout.instFlags4b={offset:0,itemSize:4,bytesPerItem:1,normalize:!1,divisor:0};a.vblayout.instFlags4b.array=b.buffer;b=a.indices=new Uint16Array(6);b[0]=0;b[1]=1;b[2]=
2;b[3]=0;b[4]=2;b[5]=3}else a.indices=new Uint16Array(this.ib.buffer.slice(0,2*this.icount));a.dbIds=this.dbIds;b=this.maxx-this.minx;c=this.maxy-this.miny;var g=Math.max(b,c);a.boundingBox={min:{x:this.minx,y:this.miny,z:.001*-g},max:{x:this.maxx,y:this.maxy,z:.001*g}};g=a.boundingSphere={};g.center={x:.5*(this.minx+this.maxx),y:.5*(this.miny+this.maxy),z:0};g.radius=.5*Math.sqrt(b*b+c*c);return a};a.VertexBufferBuilder=b})(Teratek.Viewing.Private);
function PackFileReader(a){31==a[0]&&139==a[1]&&(a=(new Zlib.Gunzip(a)).decompress());a=this.stream=new InputStream(a);var b=a.getInt32();this.type=a.getString(b);this.version=a.getInt32();this.types=null;this.entryOffsets=[];a.seek(a.byteLength-8);var c=a.getUint32();this.typesOffset=a.getUint32();a.seek(this.typesOffset);var d=this.readU32V();this.types=[];for(b=0;b<d;++b)this.types.push({entryClass:this.readString(),entryType:this.readString(),version:this.readU32V()});a.seek(c);c=this.readU32V();
d=this.entryOffsets;for(b=0;b<c;++b)d.push(a.getUint32());a.seek(0)}PackFileReader.prototype.readVarint=function(){var a,b=0,c=0;do a=this.stream.getUint8(),b|=(a&127)<<c,c+=7;while(a&128);return b};PackFileReader.prototype.readU32V=PackFileReader.prototype.readVarint;PackFileReader.prototype.readU16=function(){return this.stream.getUint16()};PackFileReader.prototype.readU8=function(){return this.stream.getUint8()};PackFileReader.prototype.readString=function(){return this.stream.getString(this.readU32V())};
PackFileReader.prototype.readVector3f=function(){var a=this.stream;return{x:a.getFloat32(),y:a.getFloat32(),z:a.getFloat32()}};PackFileReader.prototype.readVector3d=function(){var a={x:0,y:0,z:0};return function(b){var c=this.stream;a.x=c.getFloat64();a.y=c.getFloat64();a.z=c.getFloat64();b&&(a.x-=b.x,a.y-=b.y,a.z-=b.z);return a}}();
PackFileReader.prototype.readQuaternionf=function(){var a={x:0,y:0,z:0,w:0};return function(){var b=this.stream;a.x=b.getFloat32();a.y=b.getFloat32();a.z=b.getFloat32();a.w=b.getFloat32();return a}}();PackFileReader.prototype.readMatrix3f=function(){var a=new LmvMatrix4;return function(b){b||(b=a);var c=this.stream;b.identity();for(var d=0;3>d;++d)for(var e=0;3>e;++e)b.elements[4*d+e]=c.getFloat32();return b}}();
PackFileReader.prototype.readTransform=function(){var a={x:1,y:1,z:1},b=new LmvMatrix4;return function(c,d,e,f){var g=this.stream;switch(g.getUint8()){case 4:b.identity();f&&(b.elements[12]-=f.x,b.elements[13]-=f.y,b.elements[14]-=f.z);break;case 0:f=this.readVector3d(f);b.makeTranslation(f.x,f.y,f.z);break;case 1:g=this.readQuaternionf();f=this.readVector3d(f);a.x=1;a.y=1;a.z=1;b.compose(f,g,a);break;case 2:var h=g.getFloat32(),g=this.readQuaternionf();f=this.readVector3d(f);a.x=h;a.y=h;a.z=h;b.compose(f,
g,a);break;case 3:this.readMatrix3f(b),f=this.readVector3d(f),b.setPosition(f)}if(void 0!==c)c=b.elements,d&&(d[e+0]=c[0],d[e+1]=c[1],d[e+2]=c[2],d[e+3]=c[4],d[e+4]=c[5],d[e+5]=c[6],d[e+6]=c[8],d[e+7]=c[9],d[e+8]=c[10],d[e+9]=c[12],d[e+10]=c[13],d[e+11]=c[14]);else return(new LmvMatrix4).copy(b)}}();PackFileReader.prototype.getEntryCounts=function(){return this.entryOffsets.length};
PackFileReader.prototype.seekToEntry=function(a){var b=this.getEntryCounts();if(a>=b)return null;this.stream.seek(this.entryOffsets[a]);a=this.stream.getUint32();return a>=this.types.length?null:this.types[a]};
PackFileReader.prototype.readPathID=function(){var a=this.stream;if(2>this.version){var b=a.getUint16();if(!b)return null;a.getUint16();if(1==b)return"";for(var c=a.getUint16(),d=2;d<b;++d)c+="/"+a.getUint16()}else{b=this.readU32V();if(!b)return null;this.readU32V();if(1==b)return"";c=this.readU32V();for(d=2;d<b;++d)c+="/"+this.readU32V()}return c};
function readOpenCTM_RAW(a,b){var c=a.getString(4);if("INDX"!=c)return null;for(var d=b.vertexCount,e=b.triangleCount,f=b.indices=new Uint16Array(3*e),c=0,e=3*e;c<e;c++)f[c]=a.getInt32();c=a.getString(4);if("VERT"!=c)return null;var f=b.vbstride,e=b.vb,g;b.vblayout.normal&&2===b.vblayout.normal.itemSize&&(g=new Uint16Array(e.buffer));for(var c=0,h=b.vblayout.position.offset;c<d;c++,h+=f)e[h]=a.getFloat32(),e[h+1]=a.getFloat32(),e[h+2]=a.getFloat32();if(b.flags&1){c=a.getString(4);if("NORM"!=c)return null;
c=0;for(h=b.vblayout.normal.offset;c<d;c++,h+=f)if(g){var k=a.getFloat32(),n=a.getFloat32(),r=a.getFloat32(),k=.5*(Math.atan2(n,k)/Math.PI+1),r=.5*(r+1);g[2*h]=65535*k|0;g[2*h+1]=65535*r|0}else e[h]=a.getFloat32(),e[h+1]=a.getFloat32(),e[h+2]=a.getFloat32()}for(g=0;g<b.texMapCount;g++){c=a.getString(4);if("TEXC"!=c)return null;c={name:a.getString(a.getInt32()),file:a.getString(a.getInt32())};b.uvs.push(c);h="uv";g&&(h+=(g+1).toString());c=0;for(h=b.vblayout[h].offset;c<d;c++,h+=f)e[h]=a.getFloat32(),
e[h+1]=a.getFloat32()}for(g=0;g<b.attribMapCount;g++){c=a.getString(4);if("ATTR"!=c)return null;c={name:a.getString(a.getInt32())};if(-1!=c.name.indexOf("Color"))for(c=0,h=b.vblayout.color.offset;c<d;c++,h+=f)e[h]=a.getFloat32(),e[h+1]=a.getFloat32(),e[h+2]=a.getFloat32(),a.getFloat32();else b.attrs.push(c),a.getBytes(16*d)}}
var readOpenCTM=function(a){if("OCTM"!=a.getString(4)||5!=a.getInt32())return null;var b=a.getString(3);a.getUint8();var c={stream:null,vertices:null,indices:null,normals:null,colors:null,uvs:[],attrs:[]};c.vertexCount=a.getInt32();c.triangleCount=a.getInt32();c.texMapCount=a.getInt32();c.attribMapCount=a.getInt32();c.flags=a.getInt32();c.comment=a.getString(a.getInt32());c.vbstride=3;c.flags&1&&(c.vbstride+=1);c.vbstride+=2*(c.texMapCount||0);0<c.attribMapCount&&(c.vbstride+=3);c.vblayout={};var d=
0;c.vblayout.position={offset:d,itemSize:3};d+=3;c.flags&1&&(c.vblayout.normal={offset:d,itemSize:2,bytesPerItem:2,normalize:!0},d+=1);if(c.texMapCount)for(var e=0;e<c.texMapCount;e++){var f="uv";e&&(f+=(e+1).toString());c.vblayout[f]={offset:d,itemSize:2};d+=2}c.attribMapCount&&(c.vblayout.color={offset:d,itemSize:3});c.vb=new Float32Array(c.vertexCount*c.vbstride);return"RAW"==b?(readOpenCTM_RAW(a,c),VBUtils.deduceUVRepetition(c),VBUtils.computeBounds3D(c),c):"MG2"==b?(readOpenCTM_MG2(a,c),VBUtils.deduceUVRepetition(c),
VBUtils.computeBounds3D(c),c):null},readLines=function(a,b){var c={isLines:!0,vertices:null,indices:null,colors:null,normals:null,uvs:[],attrs:[]},d,e;1<b.version?(c.vertexCount=a.readU16(),d=a.readU16(),e=a.readU16()):(c.vertexCount=a.readU32V(),d=a.readU32V(),e=a.readU32V());var f=0!=a.stream.getUint8();c.vbstride=3;f&&(c.vbstride+=3);c.vblayout={};var g=0;c.vblayout.position={offset:g,itemSize:3};f&&(c.vblayout.color={offset:g+3,itemSize:3});c.vb=new Float32Array(c.vertexCount*c.vbstride);for(var h=
c.vb,k=c.vbstride,n=a.stream,r=0,g=c.vblayout.position.offset,q=c.vertexCount;r<q;r++,g+=k)h[g]=n.getFloat32(),h[g+1]=n.getFloat32(),h[g+2]=n.getFloat32();if(f)for(r=0,g=c.vblayout.color.offset,f=c.vertexCount;r<f;r++,g+=k)h[g]=n.getFloat32(),h[g+1]=n.getFloat32(),h[g+2]=n.getFloat32(),n.getFloat32();r=function(a){return a.buffer.slice(a.byteOffset,a.byteOffset+a.length)};1<b.version?(d=new Uint16Array(r(n.getBytes(2*d))),n=new Uint16Array(r(n.getBytes(2*e)))):(d=new Int32Array(r(n.getBytes(4*d))),
n=new Int32Array(r(n.getBytes(4*e))));c.indices=new Uint16Array(2*(n[e-1]-e+1));for(r=g=0;r+1<e;r++)for(h=n[r];h+1<n[r+1];h++)c.indices[g++]=d[h],c.indices[g++]=d[h+1];VBUtils.computeBounds3D(c);return c};function readGeometry(a,b,c){return(b=a.seekToEntry(b))?"Autodesk.CloudPlatform.OpenCTM"==b.entryType?readOpenCTM(a.stream):"Autodesk.CloudPlatform.Lines"==b.entryType?readLines(a,b):null:null}
function readLightDefinition(a,b){var c=a.seekToEntry(b);if(!c||1<c.version)return null;c=a.stream;return{position:a.readVector3f(),dir:a.readVector3f(),r:c.getFloat32(),g:c.getFloat32(),b:c.getFloat32(),intensity:c.getFloat32(),spotAngle:c.getFloat32(),size:c.getFloat32(),type:c.getUint8()}}
function readCameraDefinition(a,b){var c=a.seekToEntry(b.definition);if(!c||2<c.version)return null;var d=a.stream,e={isPerspective:!d.getUint8(),position:a.readVector3f(),target:a.readVector3f(),up:a.readVector3f(),aspect:d.getFloat32(),fov:d.getFloat32()*(180/Math.PI)};2>c.version&&(d.getFloat32(),d.getFloat32());e.orthoScale=d.getFloat32();return e}var NUM_FRAGMENT_LIMITS=(isAndroidDevice()||isIOSDevice(),null);
function FragList(){this.numLoaded=this.length=0;this.topoIndexes=this.mesh2frag=this.fragId2dbId=this.entityIndexes=this.packIds=this.materials=this.transforms=this.boxes=null}
function readGeometryMetadataIntoFragments(a,b,c){b=c.geomDataIndexes.length;var d=a.stream,e=0,f={};c.polygonCounts=c.geomDataIndexes;for(var g=0;g<b;g++){var h=c.geomDataIndexes[g];if(f[h])h=f[h],c.polygonCounts[g]=c.polygonCounts[h],c.packIds[g]=c.packIds[h],c.entityIndexes[g]=c.entityIndexes[h],e+=c.polygonCounts[g];else{if(!a.seekToEntry(h))return;d.getUint8();d.seek(d.offset+24);c.polygonCounts[g]=d.getUint16();c.packIds[g]=parseInt(a.readString());c.entityIndexes[g]=a.readU32V();e+=c.polygonCounts[g];
f[h]=g}}c.geomDataIndexes=null;return e}
function readGeometryMetadata(a,b,c){c=a.getEntryCounts();var d=a.stream;b.length=c;for(var e=b.fragTypes=new Uint8Array(c),f=b.primCounts=new Uint16Array(c),g=b.packIds=new Int32Array(c),h=b.entityIndexes=new Int32Array(c),k,n=0;n<c;n++){var r=a.seekToEntry(n);if(!r)break;e[n]=d.getUint8();d.seek(d.offset+24);f[n]=d.getUint16();g[n]=parseInt(a.readString());h[n]=a.readU32V();if(2<r.version){r=d.getInt32();if(-1!=r&&void 0===k){k=b.topoIndexes=new Int32Array(c);for(var q=0;q<n;q++)k[q]=-1}void 0!=
k&&(k[n]=r)}}}function objectIds2FragmentIndices(a,b,c,d){b=[];if(!d)return b;for(var e=a.getEntryCounts(),f=a.stream;0<e;){e=a.seekToEntry(0);if(!e)break;if(5<e.version)break;4<e.version&&a.readU8();a.readU32V();2<e.version||a.readString();a.readU32V();a.readTransform(0,null,0,c);for(c=0;6>c;c++)f.getFloat32();1<e.version&&(a=a.readU32V(),0<=d.indexOf(a)&&b.push(0));return b}}
function readFragments(a,b,c,d){function e(a){a*=6;for(var b=0;6>b;b++)k[a++]=h.getFloat32()}function f(a,b,c){a*=6;for(var d=0;6>d;d++)k[a++]=h.getFloat32()+b[c+d%3]}d=objectIds2FragmentIndices(a,b,c,d);var g=d.length?d.length:a.getEntryCounts(),h=a.stream;NUM_FRAGMENT_LIMITS&&g>NUM_FRAGMENT_LIMITS&&(g=NUM_FRAGMENT_LIMITS);b.length=g;b.numLoaded=0;for(var k=b.boxes=new Float32Array(6*g),n=b.transforms=new Float32Array(12*g),r=b.materials=new Int32Array(g),q=b.packIds=new Int32Array(g),p=b.entityIndexes=
new Int32Array(g),l=b.geomDataIndexes=new Int32Array(g),g=b.fragId2dbId=new Int32Array(g),t=0,u=b.length;t<u;t++){var m=d.length?a.seekToEntry(d[t]):a.seekToEntry(t);if(!m||5<m.version)return;4<m.version&&a.readU8();r[t]=a.readU32V();2<m.version?l[t]=a.readU32V():(q[t]=parseInt(a.readString()),p[t]=a.readU32V());a.readTransform(t,n,12*t,c);if(3<m.version)f(t,n,12*t+9);else if(e(t),c){var w=6*t;k[w++]-=c.x;k[w++]-=c.y;k[w++]-=c.z;k[w++]-=c.x;k[w++]-=c.y;k[w++]-=c.z}1<m.version&&(g[t]=a.readU32V())}b.finishLoading=
!0}
function filterFragments(a,b){a.length=b.length;a.numLoaded=0;for(var c=a.length,d=[Infinity,Infinity,Infinity,-Infinity,-Infinity,-Infinity],e=new Float32Array(6*c),f=new Float32Array(12*c),g=new Int32Array(c),h=new Int32Array(c),c=new Int32Array(c),k={},n=0;n<b.length;++n){for(var r=b[n],q=6*r,p=6*n,l=0;6>l;++l)e[p++]=a.boxes[q++];q=12*r;p=12*n;for(l=0;12>l;++l)f[p++]=a.transforms[q++];g[n]=a.materials[r];h[n]=a.packIds[r];c[n]=a.entityIndexes[r];l=a.packIds[r]+":"+a.entityIndexes[r];r=k[l];void 0==
r?k[l]=n:Array.isArray(r)?r.push(n):k[l]=[r,n];r=6*n;for(l=0;3>l;++l)e[r+l]<d[l]&&(d[l]=e[r+l]);for(l=3;6>l;++l)e[r+l]>d[l]&&(d[l]=e[r+l])}a.boxes=e;a.transforms=f;a.materials=g;a.packIds=h;a.entityIndexes=c;a.mesh2frag=k;return d}function readInstance(a,b,c){b=a.seekToEntry(b);if(!b||2<b.version)return null;1<b.version&&a.readU8();return{definition:a.stream.getUint32(),transform:a.readTransform(void 0,void 0,void 0,c),instanceNodePath:a.readPathID()}}
var MAX_FRAGMENT_PACK_SIZE=isAndroidDevice()||isIOSDevice()?6291456:33554432;function Package(a){this.unzip=new Zlib.Unzip(a);this.fragments=this.metadata=this.simplemats=this.materials=this.manifest=null;this.geompacks=[];this.instances=[];this.cameras=[];this.lights=[];this.propertydb={attrs:[],avs:[],ids:[],values:[],offsets:[]};this.animations=this.bbox=null;this.pendingRequests=0;this.globalOffset={x:0,y:0,z:0};this.topology=null;this.memoryOptimizedMode=!1}
Package.prototype.loadAsyncResource=function(a,b,c,d){function e(b){f.pendingRequests--;b&&(b=new Uint8Array(b),31==b[0]&&139==b[1]&&(b=(new Zlib.Gunzip(b)).decompress()),d(b));0==f.pendingRequests&&f.postLoad(a)}if(c)d(c);else{var f=this;this.pendingRequests++;Teratek.Viewing.Private.ViewingService.get(a.viewing_url,"items",a.basePath+b,e,a.onFailureCallback,{withCredentials:!!a.auth,responseType:"arraybuffer",asynchronous:!0,headers:a.headers,queryParams:a.queryParams,oss_url:a.oss_url})}};
Package.prototype.loadManifest=function(a){a=this.unzip.decompress("manifest.json");if(!a)return!1;var b=new InputStream(a);this.manifest=JSON.parse(b.getString(a.byteLength))};
Package.prototype.loadRemainingSvf=function(a){var b=this,c=this.unzip,d=this.manifest=a.manifest,e=d.assets,f=c.decompress("metadata.json"),g=new InputStream(f);3<f.byteLength&&0!==f[3]&&(this.metadata=JSON.parse(g.getString(f.byteLength)).metadata)&&(g=this.metadata["world bounding box"],f={x:g.minXYZ[0],y:g.minXYZ[1],z:g.minXYZ[2]},g={x:g.maxXYZ[0],y:g.maxXYZ[1],z:g.maxXYZ[2]},this.bbox={min:f,max:g},this.globalOffset=a.globalOffset||{x:.5*(f.x+g.x),y:.5*(f.y+g.y),z:.5*(f.z+g.z)},f.x-=this.globalOffset.x,
f.y-=this.globalOffset.y,f.z-=this.globalOffset.z,g.x-=this.globalOffset.x,g.y-=this.globalOffset.y,g.z-=this.globalOffset.z,this.metadata.hasOwnProperty("double sided geometry")&&this.metadata["double sided geometry"].value&&(this.doubleSided=!0));this.primitiveCount=this.packFileTotalSize=0;g=d.typesets;d={};for(f=0;f<g.length;f++){var h=g[f];d[h.id]=h.types}for(var k={},f=0;f<e.length;f++){g=e[f];h=g.type;0==h.indexOf("Autodesk.CloudPlatform.")&&(h=h.substr(23));var n=g.URI,r=g.typeset?d[g.typeset]:
null;0!=n.indexOf("embed:/")&&("PackFile"==h?"Autodesk.CloudPlatform.Geometry"==(r?r[0]["class"]:null)&&(this.packFileTotalSize+=g.usize||0,this.geompacks.push({id:g.id,uri:n})):"PropertyAttributes"==h?this.propertydb.attrs.push(n):"PropertyAVs"==h?this.propertydb.avs.push(n):"PropertyIDs"==h?this.propertydb.ids.push(n):"PropertyOffsets"==h?this.propertydb.offsets.push(n):"PropertyValues"==h&&this.propertydb.values.push(n));var q=g.URI,p=null;0==q.indexOf("embed:/")&&(q=q.substr(7),p=c.decompress(q));
if("ProteinMaterials"==h)-1==q.indexOf("Protein")?this.loadAsyncResource(a,q,p,function(a){var c=new InputStream(a);a=a.byteLength;b.materials=0<a?JSON.parse(c.getString(a)):null}):this.loadAsyncResource(a,q,p,function(a){var c=new InputStream(a);a=a.byteLength;b.proteinMaterials=0<a?JSON.parse(c.getString(a)):null});else if("FragmentList"==h){this.memoryOptimizedMode=g.size>MAX_FRAGMENT_PACK_SIZE&&(isAndroidDevice()||isIOSDevice());var l=this;this.loadAsyncResource(a,q,p,function(c){var d=new PackFileReader(c);
c=b.fragments=new FragList;readFragments(d,c,b.globalOffset,a.objectIds);d=null;l.memoryOptimizedMode&&k.path&&b.loadAsyncResource(a,k.path,k.contents,function(a){d=new PackFileReader(a);b.primitiveCount=readGeometryMetadataIntoFragments(d,b.globalOffset,b.fragments);d=null;k.contents=null})})}else"GeometryMetadataList"==h?(l=this,this.loadAsyncResource(a,q,p,function(a){a=new PackFileReader(a);b.geomMetadata={};l.memoryOptimizedMode?b.fragments&&b.fragments.finishLoading?b.primitiveCount=readGeometryMetadataIntoFragments(a,
b.globalOffset,b.fragments):(k.path=q,k.contents=p,p=null):readGeometryMetadata(a,b.geomMetadata)})):"PackFile"==h?-1!=q.indexOf("CameraDefinitions.bin")?this.loadAsyncResource(a,q,p,function(a){b.camDefPack=new PackFileReader(a)}):-1!=q.indexOf("CameraList.bin")?this.loadAsyncResource(a,q,p,function(a){b.camInstPack=new PackFileReader(a)}):-1!=q.indexOf("LightDefinitions.bin")?this.loadAsyncResource(a,q,p,function(a){b.lightDefPack=new PackFileReader(a)}):-1!=q.indexOf("LightList.bin")&&this.loadAsyncResource(a,
q,p,function(a){b.lightInstPack=new PackFileReader(a)}):"Animations"==h?this.loadAsyncResource(a,q,p,function(a){var c=new InputStream(a);a=a.byteLength;if(0<a){if(b.animations=JSON.parse(c.getString(a)),c=b.animations.animations){a=function(a,b){a[0]-=b.x;a[1]-=b.y;a[2]-=b.z};for(var d=b.globalOffset,e=(new LmvMatrix4).makeTranslation(d.x,d.y,d.z),h=(new LmvMatrix4).makeTranslation(-d.x,-d.y,-d.z),f=new LmvMatrix4,g=new LmvMatrix4,k=0;k<c.length;k++){var l=c[k];if(l.hierarchy)for(var p=0;p<l.hierarchy.length;p++){var n=
l.hierarchy[p].keys;if(n)for(var q=0;q<n.length;q++){var r=n[q].pos;if(r){var v=d,C=n[q].rot;C&&(f.makeRotationFromQuaternion({x:C[0],y:C[1],z:C[2],w:C[3]}),g.multiplyMatrices(e,f).multiply(h),v={x:g.elements[12],y:g.elements[13],z:g.elements[14]});a(r,v)}(r=n[q].target)&&a(r,d);if(r=n[q].points)for(v=0;v<r.length;v++)a(r[v],d)}}}}}else b.animations=null}):"Topology"==h&&this.loadAsyncResource(a,q,p,function(a){var c=new InputStream(a);a=a.byteLength;b.topology=0<a?JSON.parse(c.getString(a)):null})}0==
this.pendingRequests&&this.postLoad(a);delete this.unzip};Package.prototype.addTransparencyFlagsToMaterials=function(a){for(var b in a){var c=a[b];c.transparent=c.materials[c.userassets[0]].transparent}};
Package.prototype.postLoad=function(a){if(this.camDefPack&&this.camInstPack){for(var b=0,c=this.camInstPack.getEntryCounts();b<c;b++){var d=readInstance(this.camInstPack,b,this.globalOffset),e=readCameraDefinition(this.camDefPack,d);d.transform&&(d.transform.transformPoint(e.position),d.transform.transformPoint(e.target),d.transform.transformDirection(e.up));this.cameras.push(e)}delete this.camDefPack;delete this.camInstPack}if(this.lightDefPack&&this.lightInstPack){b=0;for(c=this.lightInstPack.getEntryCounts();b<
c;b++)d=readInstance(this.lightInstPack,b),this.lights.push(readLightDefinition(this.lightDefPack,d.definition));delete this.lightInstPack;delete this.lightDefPack}d=this.fragments;if(this.geomMetadata){d.polygonCounts=d.geomDataIndexes;c=this.geomMetadata;void 0!=c.topoIndexes&&(d.topoIndexes=new Int32Array(d.length));b=0;for(e=d.length;b<e;b++){var f=d.geomDataIndexes[b];d.entityIndexes[b]=c.entityIndexes[f];d.packIds[b]=c.packIds[f];d.polygonCounts[b]=c.primCounts[f];this.primitiveCount+=c.primCounts[f];
void 0!=c.topoIndexes&&(d.topoIndexes[b]=c.topoIndexes[f])}this.geomMetadata=d.geomDataIndexes=null}for(var f=d.mesh2frag={},c=d.packIds,g=d.entityIndexes,b=0,e=d.length;b<e;b++){var h=c[b]+":"+g[b],k=f[h];void 0===k?f[h]=b:Array.isArray(k)?k.push(b):f[h]=[k,b]}if(!this.bbox){c=[Infinity,Infinity,Infinity,-Infinity,-Infinity,-Infinity];e=d.boxes;f=0;for(d=d.length;f<d;f++){g=6*f;for(b=0;3>b;b++)e[g+b]<c[b]&&(c[b]=e[g+b]);for(b=3;6>b;b++)e[g+b]>c[b]&&(c[b]=e[g+b])}this.bbox={min:{x:c[0],y:c[1],z:c[2]},
max:{x:c[3],y:c[4],z:c[5]}}}f=a.objectIds;if(null!=f){c=[];d=[];for(b=0;b<f.length;++b)for(e=0;e<this.fragments.length;++e)this.fragments.fragId2dbId[e]==f[b]&&(c.push(this.fragments.packIds[e]),d.push(e));e=1;f=c.length;for(b=1;b<f;){for(;b<f&&c[b]==c[b-1];)++b;if(f==b)break;c[e++]=c[b++]}c.splice(e-1,f-e);f=[];for(b=0;b<this.geompacks.length;++b)for(e=0;e<c.length;++e)parseInt(this.geompacks[b].id)==c[e]&&f.push(this.geompacks[b]);this.geompacks=f;b=filterFragments(this.fragments,d);this.bbox={min:{x:b[0],
y:b[1],z:b[2]},max:{x:b[3],y:b[4],z:b[5]}}}this.memoryOptimizedMode||a.loadDoneCB("svf");this.fragments.polygonCounts&&(b=performance.now(),(c=this.materials?this.materials.materials:null)&&this.addTransparencyFlagsToMaterials(c),this.bvh=new BVHBuilder(this.fragments,c),this.bvh.build(a.bvhOptions),c=performance.now(),debug("BVH build time (worker thread):"+(c-b)),this.memoryOptimizedMode?a.loadDoneCB("svf"):a.loadDoneCB("bvh"));a.loadDoneCB("done")};
function PropertyDatabase(a){function b(a){for(var b="",c=0;c<a.length;c++)b+=String.fromCharCode(a[c]);a=decodeURIComponent(escape(b));return JSON.parse(a)}function c(a,b){for(var c=b,d="";c<a.length-1;){var e=a[c];if(44==e&&(10==a[c+1]||13==a[c+1]))break;if(10==e||13==e)break;d+=String.fromCharCode(e);c++}try{var h=decodeURIComponent(escape(d));return JSON.parse(h)}catch(g){return console.error("Error parsing property blob to JSON : "+d),d}}function d(a,b){for(var c=0,d=0,e=a.length;d<e;d++)44==
a[d]&&c++;c++;for(var e=new Uint32Array(c+(b?1:0)),d=0,h=a.length;91!=a[d]&&d<h;)d++;if(d==a.length)return null;d++;for(var g=!1,f=c=0;d<h;){var m=a[d];48<=m&&57>=m?(f=10*f+(m-48),g=!0):44==m||93==m?g&&(e[c++]=f,g=!1,f=0):(g=!1,f=0);d++}return e}function e(a){for(var b=0,c=a.length-1,d=0;d<c;d++)44!=a[d]||10!=a[d+1]&&13!=a[d+1]||b++;if(!b)return null;b++;for(var e=new Uint32Array(b),b=d=0;91!=a[d]&&d<c;)d++;d++;e[b++]=d;for(var h=!1;d<c;)10==a[d]||13==a[d]?h=!0:h&&(h=!1,e[b++]=d),d++;return e}var f,
g,h,k,n,r,q,p,l,t,u,m,w,A,F,y;for(y in a.attrs){f=b(a.attrs[y]);for(var B=0;B<f.length;B++)switch(f[B][1]){case "__parent__":l=B;break;case "__child__":p=B;break;case "__name__":t=B;break;case "__instanceof__":u=B;break;case "__viewable_in__":m=B;break;case "__externalref__":w=B;break;case "__node_flags__":A=B}break}for(y in a.avs){h=d(a.avs[y],0);delete a.avs;break}for(y in a.offsets){g=d(a.offsets[y],1);g[g.length-1]=h.length/2;delete a.offsets;break}for(y in a.values){k=a.values[y];n=e(k);break}for(y in a.ids){r=
a.ids[y];q=e(r);break}this.getObjectCount=function(){return g.length-2};this.getValueAt=function(a){return c(k,n[a])};this.getIntValueAt=function(a){var b=0;a=n[a];for(34==k[a]&&a++;a<k.length-1;){var c=k[a];if(44==c&&(10==k[a+1]||13==k[a+1]))break;if(10==c||13==c||34==c)break;48<=c&&57>=c&&(b=10*b+(c-48));a++}return b};this.getIdAt=function(a){return c(r,q[a])};this.getObjectProperties=function(a){var b={dbId:a,name:"",externalId:this.getIdAt(a),properties:[]},c=null,d=2*g[a+1];for(a=2*g[a];a<d;a+=
2){var e=h[a];if(e==t){var k=this.getValueAt(h[a+1]);b.name=k}else e==u?(k=this.getObjectProperties(this.getValueAt(h[a+1])))&&k.properties&&(c=k):(k=f[e],e=(k[6]?k[6]:0)&1||e==l||e==p||e==m||e==w,b.properties.push({displayName:k[5]?k[5]:k[0],displayValue:this.getValueAt(h[a+1]),displayCategory:k[1],type:k[2],units:k[3],hidden:e}))}if(c){d={};k=b.properties;for(a=0;a<k.length;a++)d[k[a].displayName]=1;b.name||(b.name=c.name);c=c.properties;for(a=0;a<c.length;a++)d.hasOwnProperty(c[a].displayName)||
k.push(c[a])}return b};this.getExternalIdMapping=function(){if(!F&&(F={},q&&"length"in q))for(var a=1,b=q.length;a<b;++a){var c=this.getIdAt(a);F[c]=a}return F};this.findRootNodes=function(){for(var a=[],b=1,c=g.length;b<c;b++){for(var d=!1,e=!1,f=!1,m=2*g[b+1],k=2*g[b];k<m;k+=2){var n=h[k];n==l?this.getIntValueAt(h[k+1])&&(e=!0):n==p?d=!0:n==t&&(f=!0)}d&&f&&!e&&a.push(b)}return a};this.getNodeNameAndChildren=function(a,b){for(var c=a.dbId,d=2*g[c+1],e,c=2*g[c];c<d;c+=2){var f=h[c];f!=l&&(f!=p||b?
f==t?a.name=this.getValueAt(h[c+1]):f==A?a.flags=this.getIntValueAt(h[c+1]):f==u&&(f={dbId:this.getIntValueAt(h[c+1]),name:null},this.getNodeNameAndChildren(f,!0),f&&f.name&&!a.name&&(a.name=f.name)):(f=this.getIntValueAt(h[c+1]),f={dbId:f,parent:a.dbId},e?e.push(f):e=[f]))}return e};this.buildObjectTree=function(a,b,c,d){c>d[0]&&(d[0]=c);var e=this.getNodeNameAndChildren(a);if(e){for(var f=0;f<e.length;f++)this.buildObjectTree(e[f],b,c+1,d);for(f=0;f<e.length;f++)if(!b||e[f].children||void 0!==e[f].fragIds)a.children?
a.children.push(e[f]):a.children=[e[f]]}b&&(b=b[a.dbId],void 0!==b&&(a.fragIds=b))};this.bruteForceSearch=function(a,b){a=a.toLowerCase();for(var c=a.match(/"[^"]+"|[^\s]+/g)||[],d=c.length;d--;)c[d]=c[d].replace(/"/g,"");for(var e=[],d=0;d<c.length;d++)1<c[d].length&&e.push(c[d]);if(0===e.length)return[];for(var c=[],m=0;m<e.length;m++){for(var k=[],l=[],d=0,p=n.length;d<p;d++){var q=this.getValueAt(d);"string"==typeof q?-1!=q.toLowerCase().indexOf(e[m])&&l.push(d):-1!=q.toString().toLowerCase().indexOf(e[m])&&
l.push(d)}p=1;for(q=g.length;p<q;p++)for(var r=2*g[p+1],d=2*g[p];d<r;d+=2)if(!(-1==l.indexOf(h[d+1])||b&&b.length&&-1===b.indexOf(f[h[d]][0]))){k.push(p);break}c.push(k)}if(1===c.length)return c[0];e={};k=c[0];for(d=0;d<k.length;d++)e[k[d]]=1;for(l=1;l<c.length;l++){k=c[l];p={};for(d=0;d<k.length;d++)1===e[k[d]]&&(p[k[d]]=1);e=p}k=[];for(m in e)k.push(parseInt(m));return k};this.getAttributeToIdMap=function(){var a={};f.forEach(function(b){a[b[0]]={ids:[],values:[],units:b[3],category:b[1],isnumber:!0}});
for(var b=0;b<g.length;b++)for(var c=2*g[b+1],d=2*g[b];d<c;d+=2){var e=h[d];if(e!=t&&e!=l&&e!=p){var m=f[e],e=this.getValueAt(h[d+1]),k=a[m[0]];isNaN(e)&&(k.isnumber=!1);k.ids.push(b);k.values.push({value:e,id:b})}}for(var n in a)if(m=a[n],m.values.sort(function(a,b){return a.value<b.value?-1:a.value>b.value?1:0}),!m.isnumber){m.uniqueValues=[];var q=null;m.values.forEach(function(a){a.value!=q&&(m.uniqueValues.push(a.value),q=a.value)})}return a}}
function F2D(a,b,c,d){function e(a){a=a.children;if(void 0!==a){for(var b=0;b<a.length;++b)e(a[b]);a.sort(function(a,b){var c=a.isLayer,d=b.isLayer;return c&&!d?-1:!c&&d?1:a.name.localeCompare(b.name,void 0,{sensitivity:"base",numeric:!0})})}}function f(a){var b=0;if(a.isLayer)b=1;else{for(var c=a.children,d=0;d<c.length;++d)b+=f(c[d]);a.childCount=b}return b}this.metadata=a;this.scaleY=this.scaleX=1;this.bbox={min:{x:0,y:0,z:0},max:{x:0,y:0,z:0}};this.is2d=!0;this.layersMap={};this.layersRoot={name:"root",
id:"root",children:[],isLayer:!1,childCount:0};this.fontDefs={};this.fontId=this.fontCount=0;this.manifestAvailable=!1;this.objectMemberQueue=[];this.propertydb={attrs:[],avs:[],ids:[],values:[],offsets:[],rcv_offsets:[],rcvs:[],viewables:[]};if(a){var g=function(a,b,c){var d=k,e=a.length;if(1<e)for(var f=0;f<e-1;++f){var h=a[f],g;a:{g=d.children;for(var l=0;l<g.length;++l){var p=g[l];if(p.name===h){g=p;break a}}g=null}g||(g={name:h,id:"group-"+n++,children:[],isLayer:!1,childCount:0},d.children.push(g));
d=g}d.children.push({name:b,index:c,id:r++,isLayer:!0})},h=a.page_dimensions;this.paperWidth=h.page_width;this.paperHeight=h.page_height;this.scaleX=this.paperWidth/h.plot_width;this.scaleY=this.paperHeight/h.plot_height;this.hidePaper=h.hide_paper;this.bbox.max.x=this.paperWidth;this.bbox.max.y=this.paperHeight;var k=this.layersRoot,n=0,r=0,h=0;this.layersMap[0]=h++;for(var q in a.layers){var p=parseInt(q),l=a.layers[q];(l="string"===typeof l?l:l.name)||(l=q);g(l.split("|"),l,p);this.layersMap[p]=
h++}this.layerCount=h}this.hidePaper=this.hidePaper||d&&d.modelSpace;e(this.layersRoot);f(this.layersRoot);this.opCount=0;this.fontFaces=[];this.fontFamilies=[];this.viewports=[];this.currentVpId=0;this.clips=[];this.maxObjectNumber=this.imageNumber=this.objectNumber=0;this.objectStack=[];this.objectNameStack=[];this.parseObjState={polyTriangle:{},viewport:{},clip:{},raster:{},text:{},fontDef:{},uknown:{}};this.layer=0;this.bgColor=d.bgColor?d.bgColor:4294967295;this.contrastColor=this.color=this.fillColor=
4278190080;this.currentVbb=new Teratek.Viewing.Private.VertexBufferBuilder(!1);this.meshes=[];this.numPolytriangles=this.numTriangles=this.numCircles=this.numEllipses=this.numPolylines=this.numLineSegs=0;this.error=!1;this.offsetY=this.offsetX=0;if(b){this.manifestAvailable=!0;this.imageId2URI={};a=b.assets;b=0;for(d=a.length;b<d;++b)g=a[b],-1!=g.mime.indexOf("image/")&&(q=g.id,q=q.substr(0,q.indexOf(".")),this.imageId2URI[q]=c+g.URI),"Autodesk.CloudPlatform.PropertyAttributes"==g.type&&this.propertydb.attrs.push(g.URI),
"Autodesk.CloudPlatform.PropertyValues"==g.type&&this.propertydb.values.push(g.URI),"Autodesk.CloudPlatform.PropertyIDs"==g.type&&this.propertydb.ids.push(g.URI),"Autodesk.CloudPlatform.PropertyViewables"==g.type&&this.propertydb.viewables.push(g.URI),"Autodesk.CloudPlatform.PropertyOffsets"==g.type&&(-1!=g.id.indexOf("rcv")?this.propertydb.rcv_offsets.push(g.URI):this.propertydb.offsets.push(g.URI)),"Autodesk.CloudPlatform.PropertyAVs"==g.type&&this.propertydb.avs.push(g.URI),"Autodesk.CloudPlatform.PropertyRCVs"==
g.type&&this.propertydb.rcvs.push(g.URI);debug(JSON.stringify(this.propertydb))}}F2D.prototype.load=function(a,b){31==b[0]&&139==b[1]&&(b=(new Zlib.Gunzip(b)).decompress());this.data=b;this.parse();a.loadDoneCB(!0)};F2D.prototype.loadFrames=function(a){a.data?this.data=new Uint8Array(a.data):a.finalFrame&&(this.data=null);this.parseFrames(a.finalFrame);a.loadDoneCB(!0)};
var F2dDataType={dt_object:0,dt_void:1,dt_byte:2,dt_int:3,dt_float:4,dt_double:5,dt_varint:6,dt_point_varint:7,dt_byte_array:32,dt_int_array:33,dt_float_array:34,dt_double_array:35,dt_varint_array:36,dt_point_varint_array:37,dt_arc:38,dt_circle:39,dt_circular_arc:40,dt_string:63,dt_last_data_type:127},F2dSemanticType={st_object_member:0,st_fill:1,st_fill_off:2,st_clip_off:3,st_layer:4,st_link:5,st_line_weight:6,st_miter_angle:7,st_miter_length:8,st_line_pattern_ref:9,st_back_color:10,st_color:11,
st_markup:12,st_object_id:13,st_markup_id:14,st_reset_rel_offset:15,st_font_ref:16,st_begin_object:32,st_clip:33,st_line_caps:34,st_line_join:35,st_line_pattern_def:36,st_font_def:37,st_viewport:38,st_sheet:42,st_arc:43,st_polyline:44,st_raster:45,st_text:46,st_polytriangle:47,st_dot:48,st_end_object:63,st_last_semantic_type:127};
F2D.prototype.flushBuffer=function(a,b){if(this.currentVbb.vcount){var c;if(c=b||this.currentVbb.isFull(a))c=this.currentVbb.toMesh(),VBUtils.bboxUnion(this.bbox,c.boundingBox),this.meshes.push(c),c.material={skipEllipticals:!this.currentVbb.numEllipticals,skipCircles:!this.currentVbb.numCirculars,skipTriangleGeoms:!this.currentVbb.numTriangleGeoms,useInstancing:this.currentVbb.useInstancing},this.currentImage&&(c.material.image=this.currentImage,c.material.image.name=this.imageNumber++,this.currentImage=
null),this.currentVbb=new Teratek.Viewing.Private.VertexBufferBuilder}};F2D.prototype.tx=function(a){return this.sx(a)};F2D.prototype.ty=function(a){return this.sy(a)};F2D.prototype.sx=function(a){return a*this.scaleX};F2D.prototype.sy=function(a){return a*this.scaleY};F2D.prototype.invertColor=function(a){var b,c,d;b=255-(a>>16&255);c=255-(a>>8&255);d=255-(a&255);return(a>>24&255)<<24|b<<16|c<<8|d};F2D.prototype.mapColor=function(a){return a};
F2D.prototype.restoreSignBitFromLSB=function(a){return a&1?-(a>>>1):a>>>1};F2D.prototype.parsePointPositions=function(){var a=this.stream.getVarints(),b=this.stream.getVarints(),a=this.restoreSignBitFromLSB(a),b=this.restoreSignBitFromLSB(b),a=a+this.offsetX,b=b+this.offsetY;this.offsetX=a;this.offsetY=b;return[this.tx(a),this.ty(b)]};F2D.prototype.parserAssert=function(a,b,c){return a!=b?(debug("Expect "+b+"; actual type is "+a+"; in function "+c),this.error=!0):!1};
F2D.prototype.unhandledTypeWarning=function(a,b){debug("Unhandled semantic type : "+b+" in function "+a)};
F2D.prototype.parseObject=function(){var a=this.stream.getVarints();this.objectStack.push(a);switch(a){case F2dSemanticType.st_sheet:this.objectNameStack.push("sheet");this.objectMemberQueue.unshift("paperColor");break;case F2dSemanticType.st_viewport:this.objectNameStack.push("viewport");this.objectMemberQueue.unshift("units","transform");break;case F2dSemanticType.st_clip:this.objectNameStack.push("clip");this.objectMemberQueue.unshift("contourCounts","points");break;case F2dSemanticType.st_polytriangle:this.objectNameStack.push("polyTriangle");
this.objectMemberQueue.unshift("points","indices","colors");break;case F2dSemanticType.st_raster:this.objectNameStack.push("raster");this.objectMemberQueue.unshift("position","width","height","imageId");break;case F2dSemanticType.st_text:this.objectNameStack.push("text");this.objectMemberQueue.unshift("string","position","height","widthScale","rotation","oblique","charWidths");break;case F2dSemanticType.st_font_def:this.objectNameStack.push("fontDef");this.objectMemberQueue.unshift("name","fullName",
"flags","spacing","panose");break;case F2dSemanticType.st_end_object:this.objectStack.pop();if(this.objectStack.length){switch(this.objectStack.pop()){case F2dSemanticType.st_polytriangle:this.actOnPolyTriangle();break;case F2dSemanticType.st_viewport:this.actOnViewport();break;case F2dSemanticType.st_clip:this.actOnClip();break;case F2dSemanticType.st_raster:this.actOnRaster();break;case F2dSemanticType.st_text:this.actOnText();break;case F2dSemanticType.st_font_def:this.actOnFontDef()}var a=this.objectNameStack.pop(),
a=this.parseObjState[a],b;for(b in a)a[b]=null}else this.parserAssert(0,1,"parseEndObject (Stack Empty)");this.objectMemberQueue.length=0;break;default:this.objectNameStack.push("unknown"),this.error=!0,this.unhandledTypeWarning("parseObject",a)}};
F2D.prototype.initSheet=function(a){this.bgColor=a;if(!this.hidePaper&&this.metadata){var b=this.paperWidth,c=this.paperHeight,d=this.currentVbb,e=.0075*b;this.addPolyTriangle([0,0,b,0,b,c,0,c,e,-e,b+e,-e,b+e,0,e,0,b,0,b+e,0,b+e,c-e,b,c-e],[a,a,a,a,4283782485,4283782485,4283782485,4283782485,4283782485,4283782485,4283782485,4283782485],[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11],4294967295,0,4294967295,!1);d.addSegment(0,0,b,0,0,1E-6,4278190080,4294967295,0,this.currentVpId);d.addSegment(b,0,b,c,0,1E-6,
4278190080,4294967295,0,this.currentVpId);d.addSegment(b,c,0,c,0,1E-6,4278190080,4294967295,0,this.currentVpId);d.addSegment(0,c,0,0,0,1E-6,4278190080,4294967295,0,this.currentVpId)}};F2D.prototype.setObjectMember=function(a){if(!this.objectMemberQueue.length)return debug("Unexpected object member. "+a),!1;var b=this.objectMemberQueue.shift(),c=this.objectNameStack[this.objectNameStack.length-1];return"sheet"==c&&"paperColor"==b?(this.initSheet(a),!0):c?(this.parseObjState[c][b]=a,!0):!1};
F2D.prototype.parseString=function(){var a=this.stream,b=a.getVarints(),c=a.getVarints(),a=a.getString(c);switch(b){case F2dSemanticType.st_object_member:if(this.setObjectMember(a))return;break;default:debug("Unexpected opcode semantic type for string.")}return a};F2D.prototype.actOnFontDef=function(){var a=this.parseObjState.fontDef;this.fontDefs[++this.fontCount]=a;this.fontId=this.fontCount};
F2D.prototype.parsePoint=function(){var a=this.stream.getVarints(),b=this.parsePointPositions();switch(a){case F2dSemanticType.st_object_member:if(this.setObjectMember(b))return;break;default:debug("Unexpected opcode semantic type for point.")}return b};
F2D.prototype.parsePointsArray=function(){var a=this.stream,b=a.getVarints();if(a=a.getVarints()){for(var a=a/2,c=[],d,e=0;e<a;++e)d=this.parsePointPositions(),c.push(d[0]),c.push(d[1]);switch(b){case F2dSemanticType.st_polyline:this.actOnPolylinePointsArray(c);return;case F2dSemanticType.st_dot:this.actOnDot(c);return;case F2dSemanticType.st_object_member:if(this.setObjectMember(c))return;break;default:debug("Unexpected opcode semantic type for points array.")}return c}};
F2D.prototype.parseIntArray=function(){for(var a=this.stream,b=a.getVarints(),c=a.getVarints(),d=[],e=0;e<c;++e)d.push(a.getUint32());switch(b){case F2dSemanticType.st_object_member:if(this.setObjectMember(d))return;break;default:this.unhandledTypeWarning("parseIntArray",b)}return d};
F2D.prototype.parseDoubleArray=function(){for(var a=this.stream,b=a.getVarints(),c=a.getVarints(),d=[],e=0;e<c;++e)d.push(a.getFloat64());switch(b){case F2dSemanticType.st_object_member:if(this.setObjectMember(d))return;break;default:this.unhandledTypeWarning("parseDoubleArray",b)}return d};
F2D.prototype.parseByteArray=function(){for(var a=this.stream,b=a.getVarints(),c=a.getVarints(),d=[],e=0;e<c;++e)d.push(a.getUint8());switch(b){case F2dSemanticType.st_object_member:if(this.setObjectMember(d))return;break;default:this.unhandledTypeWarning("parseByteArray",b)}return d};
F2D.prototype.parseVarintArray=function(){for(var a=this.stream,b=a.getVarints(),c=[],d=a.getVarints(),e=0;e<d;++e)c.push(a.getVarints());switch(b){case F2dSemanticType.st_object_member:if(this.setObjectMember(c))return;break;default:this.unhandledTypeWarning("parseVarIntArray",b)}return c};
F2D.prototype.parseInt=function(){var a=this.stream,b=a.getVarints(),a=a.getUint32();switch(b){case F2dSemanticType.st_color:this.color=a;break;case F2dSemanticType.st_fill:this.fill=!0;this.fillColor=a;break;case F2dSemanticType.st_object_member:if(this.setObjectMember(a))return;default:this.unhandledTypeWarning("parseInt",b)}return a};
F2D.prototype.parseVoid=function(){var a=this.stream.getVarints();switch(a){case F2dSemanticType.st_fill_off:this.fill=!1;break;default:this.unhandledTypeWarning("parseVoid",a)}};
F2D.prototype.parseVarint=function(){var a=this.stream,b=a.getVarints(),a=a.getVarints();switch(b){case F2dSemanticType.st_line_weight:this.lineWeight=this.tx(a);break;case F2dSemanticType.st_object_id:case F2dSemanticType.st_markup_id:this.objectNumber=a;this.maxObjectNumber=Math.max(this.maxObjectNumber,a);break;case F2dSemanticType.st_layer:this.layer=this.layersMap[a];break;case F2dSemanticType.st_font_ref:this.fontId=a;break;case F2dSemanticType.st_object_member:if(this.setObjectMember(a))return}return a};
F2D.prototype.parseFloat=function(){var a=this.stream,b=a.getVarints(),a=a.getFloat32();switch(b){case F2dSemanticType.st_object_member:if(this.setObjectMember(a))return}return a};F2D.prototype.parseCircularArc=function(){var a=this.stream,b=a.getVarints();if(!this.parserAssert(b,F2dSemanticType.st_arc,"parseCircularArc")){var b=this.parsePointPositions(),c=a.getVarints(),d=a.getFloat32(),a=a.getFloat32();this.actOnCircularArc(b[0],b[1],d,a,this.sx(c))}};
F2D.prototype.parseCircle=function(){var a=this.stream,b=a.getVarints();this.parserAssert(b,F2dSemanticType.st_arc,"parseCircle")||(b=this.parsePointPositions(),a=a.getVarints(),this.actOnCompleteCircle(b[0],b[1],this.sx(a)))};
F2D.prototype.parseArc=function(){var a=this.stream,b=a.getVarints();if(!this.parserAssert(b,F2dSemanticType.st_arc,"parseArc")){var b=this.parsePointPositions(),c=a.getVarints(),d=a.getVarints(),e=a.getFloat32(),f=a.getFloat32(),a=a.getFloat32();this.actOnArc(b[0],b[1],f,a,this.sx(c),this.sy(d),e)}};
F2D.prototype.parseDataType=function(){var a=this.stream.getVarints();switch(a){case F2dDataType.dt_void:this.parseVoid();break;case F2dDataType.dt_int:this.parseInt();break;case F2dDataType.dt_object:this.parseObject();break;case F2dDataType.dt_varint:this.parseVarint();break;case F2dDataType.dt_point_varint:this.parsePoint();break;case F2dDataType.dt_float:this.parseFloat();break;case F2dDataType.dt_point_varint_array:this.parsePointsArray();break;case F2dDataType.dt_circular_arc:this.parseCircularArc();
break;case F2dDataType.dt_circle:this.parseCircle();break;case F2dDataType.dt_arc:this.parseArc();break;case F2dDataType.dt_int_array:this.parseIntArray();break;case F2dDataType.dt_varint_array:this.parseVarintArray();break;case F2dDataType.dt_byte_array:this.parseByteArray();break;case F2dDataType.dt_string:this.parseString();break;case F2dDataType.dt_double_array:this.parseDoubleArray();break;default:this.error=!0,debug("Data type not supported yet: "+a)}};
F2D.prototype.parse=function(){var a=this.stream=new InputStream(this.data),b=a.getString(3);if("F2D"!=b)debug("Invalid F2D header : "+b);else if(b=a.getString(2),"01"!=b)debug("Only support f2d major version 1; actual version is : "+b);else if("."!=a.getString(1))debug("Invalid version delimiter.");else{for(a.getString(2);a.offset<a.byteLength;){this.parseDataType();if(this.error)break;this.opCount++}this.flushBuffer(0,!0);this.data=this.stream=this.currentVbb=null;debug("F2d parse: data types count : "+
this.opCount)}};F2D.prototype.parseFrames=function(a){if(this.data)for(var b=this.stream=new InputStream(this.data);b.offset<b.byteLength;){this.parseDataType();if(this.error)break;this.opCount++}else a||debug("Unexpected F2D parse state: If there is no data, we only expect a flush command, but flush was false.");a&&this.flushBuffer(0,!0);this.data=this.stream=null};
F2D.prototype.actOnPolylinePointsArray=function(a){this.flushBuffer();this.numPolylines++;for(var b=a.length/2,c=0,d=a[0],e=a[1],f=1;f<b;++f){var g=a[2*f],h=a[2*f+1];this.currentVbb.addSegment(d,e,g,h,c,this.lineWeight,this.color,this.objectNumber,this.layer,this.currentVpId);c+=Math.sqrt((g-d)*(g-d)+(h-e)*(h-e));d=g;e=h}this.numLineSegs+=b-1};F2D.prototype.actOnDot=function(a){this.actOnCompleteCircle(a[0],a[1],this.sx(1))};
F2D.prototype.actOnCompleteCircle=function(a,b,c){this.flushBuffer();this.numCircles++;this.fill?this.currentVbb.addSegment(a,b,a,b,0,2*c,this.color,this.objectNumber,this.layer,this.currentVpId,!0,!1,!0):this.currentVbb.addCircularArc(a,b,0,2*Math.PI,c,this.lineWeight,this.color,this.objectNumber,this.layer,this.currentVpId)};
F2D.prototype.actOnCircularArc=function(a,b,c,d,e){this.numCircles++;this.flushBuffer();this.currentVbb.addCircularArc(a,b,c,d,e,this.lineWeight,this.color,this.objectNumber,this.layer,this.currentVpId)};F2D.prototype.actOnArc=function(a,b,c,d,e,f,g){this.numEllipses++;this.flushBuffer();this.currentVbb.addEllipticalArc(a,b,c,d,e,f,g,this.lineWeight,this.color,this.objectNumber,this.layer,this.currentVpId)};
F2D.prototype.actOnRaster=function(){if(this.manifestAvailable){this.flushBuffer(4,!0);var a=this.parseObjState.raster,b=a.position,c=a.height,d=a.imageId,e=b[0],b=b[1],a=this.sx(a.width),c=this.sy(c),d={dataURI:this.imageId2URI[d],width:a,height:c};this.currentVbb.addTexturedQuad(e,b-c,a,c,this.objectNumber,this.layer,this.currentVpId);this.currentImage=d;this.flushBuffer(0,!0)}};F2D.prototype.actOnClip=function(){var a=this.parseObjState.clip;this.parseObjState.clip={};this.clips.push(a)};
F2D.prototype.actOnText=function(){};
F2D.prototype.addPolyTriangle=function(a,b,c,d,e,f,g){function h(a,b){if(a>b){var c=a;a=b;b=c}if(q[a]){var c=q[a],d=c.lastIndexOf(b);-1==d?c.push(b):c[d]=-1}else q[a]=[b]}function k(){for(var c=0,h=q.length;c<h;c++){var g=q[c];if(g)for(var m=0;m<g.length;m++){var k=g[m];-1!=k&&(r.flushBuffer(4),r.currentVbb.addSegment(a[2*c],a[2*c+1],a[2*k],a[2*k+1],0,p,b?b[c]:d,f,e,this.currentVpId),b&&b[c]!=b[k]&&debug("Gouraud triangle encountered. Will have incorrect antialiasing."))}}}function n(c,h){if(c>h){var g=
c;c=h;h=g}(g=q[c])&&-1!=g.indexOf(h)&&(r.flushBuffer(4),r.currentVbb.addSegment(a[2*c],a[2*c+1],a[2*h],a[2*h+1],0,p,b?b[c]:d,f,e,this.currentVpId),b&&b[c]!=b[h]&&debug("Gouraud triangle encountered. Will have incorrect antialiasing."))}var r=this,q=null,p=-1;this.objectStack[this.objectStack.length-1]==F2dSemanticType.st_text&&(p=-.5);if(g)for(var q=Array(a.length/2),l=0,t=c.length;l<t;l+=3){var u=c[l],m=c[l+1],w=c[l+2];h(u,m);h(m,w);h(w,u)}if(this.currentVbb.useInstancing)for(t=c.length,l=0;l<t;l+=
3)u=c[l],m=c[l+1],w=c[l+2],this.flushBuffer(4),this.currentVbb.addTriangleGeom(a[2*u],a[2*u+1],a[2*m],a[2*m+1],a[2*w],a[2*w+1],b?b[u]:d,f,e,this.currentVpId),g&&(n(u,m),n(m,w),n(w,u));else{t=a.length/2;this.flushBuffer(t);u=this.currentVbb;m=u.vcount;for(l=0;l<t;++l)u.addVertexPolytriangle(a[2*l],a[2*l+1],0,0,0,b?b[l]:d,f,e,this.currentVpId);t=c.length;for(l=0;l<t;l+=3)u.addTriangle(m+c[l],m+c[l+1],m+c[l+2]);g&&k()}};
F2D.prototype.actOnPolyTriangle=function(){var a=this.parseObjState.polyTriangle;this.parseObjState.polyTriangle={};var b=a.points,c=a.indices,a=a.colors;b&&c?(this.numPolytriangles++,this.numTriangles+=c.length/3,this.addPolyTriangle(b,a,c,this.color,this.layer,this.objectNumber,!0)):debug("Malformed polytriangle.")};F2D.prototype.actOnViewport=function(){var a=this.parseObjState.viewport;this.parseObjState.viewport={};this.viewports.push(a);this.currentVpId=this.viewports.length-1};
function F2DProbe(){this.data=null;this.frameEnd=this.frameStart=0;this.stream=null;this.opCount=0;this.marker={frameStart:this.frameStart,frameEnd:this.frameEnd}}F2DProbe.prototype.load=function(a){this.data=a;this.frameStart=0;this.stream?(this.stream.reset(this.data),this.stream.seek(0),this.frameEnd=0):(this.stream=new CheckedInputStream(this.data),this.stream.seek(8),this.frameEnd=this.frameStart=8);this.probe();this.marker.frameStart=this.frameStart;this.marker.frameEnd=this.frameEnd;return this.marker};
var F2dProbeDataType={dt_object:0,dt_void:1,dt_byte:2,dt_int:3,dt_float:4,dt_double:5,dt_varint:6,dt_point_varint:7,dt_byte_array:32,dt_int_array:33,dt_float_array:34,dt_double_array:35,dt_varint_array:36,dt_point_varint_array:37,dt_arc:38,dt_circle:39,dt_circular_arc:40,dt_string:63,dt_last_data_type:127},F2dProbeSemanticType={st_object_member:0,st_fill:1,st_fill_off:2,st_clip_off:3,st_layer:4,st_link:5,st_line_weight:6,st_miter_angle:7,st_miter_length:8,st_line_pattern_ref:9,st_back_color:10,st_color:11,
st_markup:12,st_object_id:13,st_markup_id:14,st_reset_rel_offset:15,st_font_ref:16,st_begin_object:32,st_clip:33,st_line_caps:34,st_line_join:35,st_line_pattern_def:36,st_font_def:37,st_viewport:38,st_sheet:42,st_arc:43,st_polyline:44,st_raster:45,st_text:46,st_polytriangle:47,st_dot:48,st_end_object:63,st_last_semantic_type:127};F2DProbe.prototype.readColor=function(){var a=this.stream;a.getVarints();a.getVarints();a.skipUint32()};
F2DProbe.prototype.parsePointPositions=function(){this.stream.getVarints();this.stream.getVarints()};F2DProbe.prototype.unhandledTypeWarning=function(a,b){debug("Unhandled semantic type when probing F2d : "+b+" in function "+a)};F2DProbe.prototype.parseObject=function(){this.stream.getVarints()};F2DProbe.prototype.parseString=function(){var a=this.stream;a.getVarints();var b=a.getVarints();a.skipBytes(b)};F2DProbe.prototype.parsePoint=function(){this.stream.getVarints();this.parsePointPositions()};
F2DProbe.prototype.parseVarintArray=function(){var a=this.stream;a.getVarints();for(var b=a.getVarints(),c=0;c<b;++c)a.getVarints()};F2DProbe.prototype.parseByteArray=function(){var a=this.stream;a.getVarints();var b=a.getVarints();a.skipBytes(b)};F2DProbe.prototype.parseEndOfObject=function(){var a=this.stream;a.getVarints();a.getVarints()};F2DProbe.prototype.parsePointsArray=function(a){a=this.stream;a.getVarints();if(a=a.getVarints()){a/=2;for(var b=0;b<a;++b)this.parsePointPositions()}};
F2DProbe.prototype.parsePoint=function(a){this.stream.getVarints();this.parsePointPositions()};F2DProbe.prototype.parseInt=function(){var a=this.stream,b=a.getVarints();switch(b){case F2dProbeSemanticType.st_color:a.skipUint32();break;case F2dProbeSemanticType.st_fill:a.skipUint32();break;default:a.skipUint32(),this.unhandledTypeWarning("parseInt",b)}};
F2DProbe.prototype.parseVoid=function(){var a=this.stream.getVarints();switch(a){case F2dProbeSemanticType.st_fill_off:break;default:this.unhandledTypeWarning("parseVoid",a)}};F2DProbe.prototype.parseVarint=function(){this.stream.getVarints();this.stream.getVarints()};F2DProbe.prototype.parseIntArray=function(){var a=this.stream;a.getVarints();for(var b=a.getVarints(),c=0;c<b;++c)a.skipUint32()};F2DProbe.prototype.parseFloat=function(){var a=this.stream;a.getVarints();a.getFloat32()};
F2DProbe.prototype.parseDoubleArray=function(){var a=this.stream;a.getVarints();for(var b=a.getVarints(),c=0;c<b;++c)a.skipFloat64()};F2DProbe.prototype.parseCircularArc=function(){var a=this.stream;a.getVarints();this.parsePointPositions();a.getVarints();a.getFloat32();a.getFloat32()};F2DProbe.prototype.parseCircle=function(){var a=this.stream;a.getVarints();this.parsePointPositions();a.getVarints()};
F2DProbe.prototype.parseArc=function(){var a=this.stream;a.getVarints();this.parsePointPositions();a.getVarints();a.getVarints();a.getFloat32();a.getFloat32();a.getFloat32()};
F2DProbe.prototype.parseDataType=function(){var a=this.stream.getVarints();switch(a){case F2dProbeDataType.dt_void:this.parseVoid();break;case F2dProbeDataType.dt_int:this.parseInt();break;case F2dProbeDataType.dt_object:this.parseObject();break;case F2dProbeDataType.dt_varint:this.parseVarint();break;case F2dProbeDataType.dt_float:this.parseFloat();break;case F2dProbeDataType.dt_point_varint:this.parsePoint();break;case F2dProbeDataType.dt_point_varint_array:this.parsePointsArray();break;case F2dProbeDataType.dt_circular_arc:this.parseCircularArc();
break;case F2dProbeDataType.dt_circle:this.parseCircle();break;case F2dProbeDataType.dt_arc:this.parseArc();break;case F2dProbeDataType.dt_varint_array:this.parseVarintArray();break;case F2dProbeDataType.dt_int_array:this.parseIntArray();break;case F2dProbeDataType.dt_byte_array:this.parseByteArray();break;case F2dProbeDataType.dt_string:this.parseString();break;case F2dProbeDataType.dt_double_array:this.parseDoubleArray();break;default:this.error=!0,debug("Bad op code encountered : "+a+" , bail out.")}this.error||
(this.frameEnd=this.stream.offset)};F2DProbe.prototype.probe=function(){var a=this.stream;try{for(;a.offset<a.byteLength;){this.parseDataType();if(this.error)break;this.opCount++}}catch(b){}};function CheckedInputStream(a){this.buffer=a;this.offset=0;this.byteLength=a.length;this.convBuf=new ArrayBuffer(8);this.convUint8=new Uint8Array(this.convBuf);this.convUint16=new Uint16Array(this.convBuf);this.convInt32=new Int32Array(this.convBuf);this.convUint32=new Uint32Array(this.convBuf)}
function OutOfBoundsBufferAccessException(a){this.offset=a;this.message="try to access an offset that is out of bounds: "+this.offset;this.toString=function(){return this.message}}CheckedInputStream.prototype.boundsCheck=function(a){if(a>=this.byteLength)throw new OutOfBoundsBufferAccessException(a);};CheckedInputStream.prototype.seek=function(a){this.boundsCheck(a);this.offset=a};
CheckedInputStream.prototype.getBytes=function(a){this.boundsCheck(this.offset+a);var b=new Uint8Array(this.buffer.buffer,this.offset,a);this.offset+=a;return b};CheckedInputStream.prototype.skipBytes=function(a){this.boundsCheck(this.offset+a);this.offset+=a};CheckedInputStream.prototype.getVarints=function(){var a,b=0,c=0;do this.boundsCheck(this.offset),a=this.buffer[this.offset++],b|=(a&127)<<c,c+=7;while(a&128);return b};
CheckedInputStream.prototype.getUint8=function(){this.boundsCheck(this.offset+1);return this.buffer[this.offset++]};CheckedInputStream.prototype.getUint16=function(){this.boundsCheck(this.offset+2);this.convUint8[0]=this.buffer[this.offset++];this.convUint8[1]=this.buffer[this.offset++];return this.convUint16[0]};CheckedInputStream.prototype.getInt16=function(){var a=this.getUint16();32767<a&&(a|=4294901760);return a};
CheckedInputStream.prototype.getInt32=function(){this.boundsCheck(this.offset+4);var a=this.buffer,b=this.convUint8,c=this.offset;b[0]=a[c];b[1]=a[c+1];b[2]=a[c+2];b[3]=a[c+3];this.offset+=4;return this.convInt32[0]};CheckedInputStream.prototype.getUint32=function(){this.boundsCheck(this.offset+4);var a=this.buffer,b=this.convUint8,c=this.offset;b[0]=a[c];b[1]=a[c+1];b[2]=a[c+2];b[3]=a[c+3];this.offset+=4;return this.convUint32[0]};
CheckedInputStream.prototype.skipUint32=function(){this.boundsCheck(this.offset+4);this.offset+=4};CheckedInputStream.prototype.getFloat32=function(){this.boundsCheck(this.offset+4);this.offset+=4;return 0};CheckedInputStream.prototype.getFloat64=function(){this.boundsCheck(this.offset+8);this.offset+=8;return 0};CheckedInputStream.prototype.skipFloat64=function(){this.boundsCheck(this.offset+8);this.offset+=8};
CheckedInputStream.prototype.reset=function(a){this.buffer=a;this.offset=0;this.byteLength=a.length};
function NodeArray(a,b){this.bytes_per_node=b?32:36;var c,d;a instanceof ArrayBuffer?(c=a.byteLength/this.bytes_per_node,d=a,this.nodeCount=c):(c=a|0,d=new ArrayBuffer(this.bytes_per_node*c),this.nodeCount=0);this.nodeCapacity=c;this.nodesRaw=d;this.is_lean_node=b;this.node_stride=this.bytes_per_node/4;this.node_stride_short=this.bytes_per_node/2;this.nodesF=new Float32Array(this.nodesRaw);this.nodesI=new Int32Array(this.nodesRaw);this.nodesS=new Uint16Array(this.nodesRaw)}
NodeArray.prototype.setLeftChild=function(a,b){this.nodesI[a*this.node_stride+6]=b};NodeArray.prototype.getLeftChild=function(a){return this.nodesI[a*this.node_stride+6]};NodeArray.prototype.setPrimStart=function(a,b){this.is_lean_node?this.nodesI[a*this.node_stride+6]=b:this.nodesI[a*this.node_stride+8]=b};NodeArray.prototype.getPrimStart=function(a){return this.is_lean_node?this.nodesI[a*this.node_stride+6]:this.nodesI[a*this.node_stride+8]};
NodeArray.prototype.setPrimCount=function(a,b){this.nodesS[a*this.node_stride_short+14]=b};NodeArray.prototype.getPrimCount=function(a){return this.nodesS[a*this.node_stride_short+14]};NodeArray.prototype.setFlags=function(a,b,c,d){this.nodesS[a*this.node_stride_short+15]=d<<3|c<<2|b&3};NodeArray.prototype.getFlags=function(a){return this.nodesS[a*this.node_stride_short+15]};
NodeArray.prototype.setBox0=function(a,b){var c=a*this.node_stride,d=this.nodesF;d[c]=b[0];d[c+1]=b[1];d[c+2]=b[2];d[c+3]=b[3];d[c+4]=b[4];d[c+5]=b[5]};NodeArray.prototype.getBoxThree=function(a,b){var c=a*this.node_stride,d=this.nodesF;b.min.x=d[c];b.min.y=d[c+1];b.min.z=d[c+2];b.max.x=d[c+3];b.max.y=d[c+4];b.max.z=d[c+5]};NodeArray.prototype.setBoxThree=function(a,b){var c=a*this.node_stride,d=this.nodesF;d[c]=b.min.x;d[c+1]=b.min.y;d[c+2]=b.min.z;d[c+3]=b.max.x;d[c+4]=b.max.y;d[c+5]=b.max.z};
NodeArray.prototype.makeEmpty=function(a){a*=this.node_stride;var b=this.nodesI;b[a+6]=-1;b[a+7]=0;this.is_lean_node||(b[a+8]=-1)};NodeArray.prototype.realloc=function(a){if(this.nodeCount+a>this.nodeCapacity){var b=0|3*this.nodeCapacity/2;b<this.nodeCount+a&&(b=this.nodeCount+a);a=new ArrayBuffer(b*this.bytes_per_node);var c=new Int32Array(a);c.set(this.nodesI);this.nodeCapacity=b;this.nodesRaw=a;this.nodesF=new Float32Array(a);this.nodesI=c;this.nodesS=new Uint16Array(a)}};
NodeArray.prototype.nextNodes=function(a){this.realloc(a);var b=this.nodeCount;this.nodeCount+=a;for(var c=0;c<a;c++)this.makeEmpty(b+c);return b};NodeArray.prototype.getRawData=function(){return this.nodesRaw.slice(0,this.nodeCount*this.bytes_per_node)};
var BOX_STRIDE=6,POINT_STRIDE=3,BOX_EPSILON=1E-5,BOX_SCALE_EPSILON=1E-5,MAX_DEPTH=15,MAX_BINS=16,BVHModule=function(){function a(a,b,c){a[0]>b[c]&&(a[0]=b[c]);a[3]<b[c]&&(a[3]=b[c]);a[1]>b[c+1]&&(a[1]=b[c+1]);a[4]<b[c+1]&&(a[4]=b[c+1]);a[2]>b[c+2]&&(a[2]=b[c+2]);a[5]<b[c+2]&&(a[5]=b[c+2])}function b(a,b,c){a[0]>b[c]&&(a[0]=b[c]);a[1]>b[c+1]&&(a[1]=b[c+1]);a[2]>b[c+2]&&(a[2]=b[c+2]);a[3]<b[c+3]&&(a[3]=b[c+3]);a[4]<b[c+4]&&(a[4]=b[c+4]);a[5]<b[c+5]&&(a[5]=b[c+5])}function c(a,b){a[0]>b[0]&&(a[0]=b[0]);
a[1]>b[1]&&(a[1]=b[1]);a[2]>b[2]&&(a[2]=b[2]);a[3]<b[3]&&(a[3]=b[3]);a[4]<b[4]&&(a[4]=b[4]);a[5]<b[5]&&(a[5]=b[5])}function d(a,b,c,d){for(var e=0;3>e;e++)a[b+e]=c[d+3+e]-c[d+e]}function e(a,b){a[0]=b[0];a[1]=b[1];a[2]=b[2];a[3]=b[3];a[4]=b[4];a[5]=b[5]}function f(a){a[0]=Infinity;a[1]=Infinity;a[2]=Infinity;a[3]=-Infinity;a[4]=-Infinity;a[5]=-Infinity}function g(a){var b=a[3]-a[0],c=a[4]-a[1];a=a[5]-a[2];return 0>b||0>c||0>a?0:2*(b*c+c*a+a*b)}function h(){this.vb_left=new Float32Array(6);this.vb_right=
new Float32Array(6);this.cb_left=new Float32Array(6);this.cb_right=new Float32Array(6);this.num_left=0;this.num_bins=this.best_cost=this.best_split=-1}function k(){this.box_bbox=new Float32Array(6);this.box_centroid=new Float32Array(6);this.num_prims=0}function n(){this.BL=new Float32Array(6);this.CL=new Float32Array(6);this.AL=this.NL=0}h.prototype.reset=function(){this.num_left=0;this.num_bins=this.best_cost=this.best_split=-1};k.prototype.reset=function(){this.num_prims=0;f(this.box_bbox);f(this.box_centroid)};
n.prototype.reset=function(){this.AL=this.NL=0;f(this.BL);f(this.CL)};for(var r=[],q=0;q<MAX_BINS;q++)r.push(new k);for(var p=[],q=0;q<MAX_BINS-1;q++)p.push(new n);var l=new Float32Array(6),t=new Float32Array(6),u=new Float32Array(3);return{bvh_subdivide:function(k,n,q,F,y,B,J,K){d(u,0,B,0);var I=k.nodes,D=J?k.frags_per_leaf_node_transparent:k.frags_per_leaf_node,E=J?k.frags_per_inner_node_transparent:k.frags_per_inner_node,v=k.max_polys_per_node,C=0;u[1]>u[0]&&(C=1);u[2]>u[C]&&(C=2);I.setBox0(n,
y);var G=0;y=0;if(k.polygonCounts)for(var H=q;H<=F&&!(G+=k.polygonCounts[k.primitives[H]],y++,G>v);H++);H=F-q+1;if(H<=D&&G<v||1===H||K>MAX_DEPTH||u[C]<k.scene_epsilon)I.setLeftChild(n,-1),I.setPrimStart(n,q),I.setPrimCount(n,F-q+1),I.setFlags(n,0,0,J?1:0);else{if(E){E=q;C=k.primitives;D=k.centroids;v=F-E+1;v>k.frags_per_inner_node&&(v=k.frags_per_inner_node);v>y&&(v=y);I.setPrimStart(n,E);I.setPrimCount(n,v);E+=v;f(B);for(y=E;y<=F;y++)a(B,D,3*C[y]);d(u,0,B,0);C=0;u[1]>u[0]&&(C=1);u[2]>u[C]&&(C=2);
q+=I.getPrimCount(n)}y=new h;var x=q,E=C;if(u[E]<k.scene_epsilon)y.best_cost=Infinity;else{D=MAX_BINS;D>F-x+1&&(D=F-x+1);for(v=0;v<D;v++)r[v].reset();for(v=0;v<D-1;v++)p[v].reset();var v=y.num_bins=D,G=k.centroids,H=k.primitives,z=k.boxes,M=v*(1-BOX_SCALE_EPSILON)/u[E];B=B[E];for(var N=k.sort_prims;x<=F;x++){var O=H[x]|0,L=M*(G[3*O+E]-B)|0;0>L?L=0:L>=v&&(L=v-1);N[x]=L;r[L].num_prims++;b(r[L].box_bbox,z,6*O);a(r[L].box_centroid,G,3*O)}e(p[0].BL,r[0].box_bbox);e(p[0].CL,r[0].box_centroid);p[0].AL=g(p[0].BL);
p[0].NL=r[0].num_prims;for(v=1;v<D-1;v++)B=r[v],E=p[v],e(E.BL,p[v-1].BL),c(E.BL,B.box_bbox),E.AL=g(E.BL),e(E.CL,p[v-1].CL),c(E.CL,B.box_centroid),E.NL=p[v-1].NL+B.num_prims;v=D-1;e(l,r[v].box_bbox);e(t,r[v].box_centroid);H=g(l);D=r[v].num_prims;E=v;G=H*D+p[v-1].AL*p[v-1].NL;e(y.vb_right,l);e(y.cb_right,r[v].box_centroid);e(y.vb_left,p[v-1].BL);e(y.cb_left,p[v-1].CL);y.num_left=p[v-1].NL;for(--v;1<=v;v--)B=r[v],c(l,B.box_bbox),c(t,B.box_centroid),H=g(l),D+=B.num_prims,B=H*D+p[v-1].AL*p[v-1].NL,B<=
G&&(G=B,E=v,e(y.vb_right,l),e(y.cb_right,t),e(y.vb_left,p[v-1].BL),e(y.cb_left,p[v-1].CL),y.num_left=p[v-1].NL);y.best_split=E;y.best_cost=G}if(0>y.num_bins)I.setPrimCount(n,I.getPrimCount(n)+F-q+1);else{B=k.primitives;D=k.sort_prims;E=0;v=q|0;H=y.best_split|0;for(G=q;G<=F;G++)z=B[G]|0,D[G]<H?B[v++]=z:D[E++]=z;for(G=0;G<E;G++)B[v+G]=D[G];B=I.nextNodes(2);I.setFlags(n,C,.5*(y.vb_left[3+C]+y.vb_left[C])<.5*(y.vb_right[3+C]+y.vb_right[C])?0:1,J?1:0);I.setLeftChild(n,B);k.recursion_stack.push([k,B+1,
q+y.num_left,F,y.vb_right,y.cb_right,J,K+1]);k.recursion_stack.push([k,B,q,q+y.num_left-1,y.vb_left,y.cb_left,J,K+1])}}},compute_boxes:function(c){var e=c.boxv_o,h=c.boxc_o,g=c.boxv_t,k=c.boxc_t;f(e);f(h);f(g);f(k);for(var l=c.centroids,p=c.boxes,n=0,q=c.prim_count;n<q;n++){var r=l,t=3*n,v=p,C=6*n;r[t]=.5*(v[C]+v[C+3]);r[t+1]=.5*(v[C+1]+v[C+4]);r[t+2]=.5*(v[C+2]+v[C+5]);n>=c.first_transparent?(a(k,l,3*n),b(g,p,6*n)):(a(h,l,3*n),b(e,p,6*n))}d(u,0,c.boxv_o,0);e=Math.max(u[0],u[1],u[2]);c.scene_epsilon=
BOX_EPSILON*e},box_area:function(a,b){var c=a[b+3]-a[b],d=a[b+4]-a[b+1],e=a[b+5]-a[b+2];return 0>c||0>d||0>e?0:2*(c*d+d*e+e*c)}}}();
function BVHBuilder(a,b){this.boxes=a.boxes;this.polygonCounts=a.polygonCounts;this.materials=a.materials;this.materialDefs=b;this.prim_count=a.length;this.frags_per_inner_node=this.frags_per_leaf_node=-1;this.nodes=null;this.work_buf=new ArrayBuffer(4*this.prim_count);this.sort_prims=new Int32Array(this.work_buf);this.primitives=new Int32Array(this.prim_count);this.centroids=new Float32Array(POINT_STRIDE*this.prim_count);this.boxv_o=new Float32Array(6);this.boxc_o=new Float32Array(6);this.boxv_t=
new Float32Array(6);this.boxc_t=new Float32Array(6);this.recursion_stack=[]}
BVHBuilder.prototype.sortPrimitives=function(){for(var a=new Float32Array(this.work_buf),b=this.materialDefs,c=this.materials,d=this.primitives,e=0,f=0,g=this.prim_count;f<g;f++){d[f]=f;var h=b&&b[c[f]]?b[c[f]].transparent:!1;h&&e++;k?(a[f]=BVHModule.box_area(this.boxes,BOX_STRIDE*f),h&&(a[f]=-a[f])):a[f]=h?-1:1}var k=!1;if(e&&e<this.prim_count){b=new Int32Array(e);f=h=c=0;for(g=this.prim_count;f<g;f++)0<=a[f]?d[c++]=d[f]:b[h++]=d[f];d.set(b,this.prim_count-e)}this.first_transparent=this.prim_count-
e};
BVHBuilder.prototype.build=function(a){var b=a&&!!a.useSlimNodes;if(b)this.frags_per_leaf_node=1,this.frags_per_inner_node=0,this.frags_per_leaf_node_transparent=1,this.frags_per_inner_node_transparent=0,this.max_polys_per_node=Infinity;else{var c=a.isWeakDevice?.5:1;this.frags_per_leaf_node=0|32*c;this.frags_per_inner_node=0|this.frags_per_leaf_node;this.frags_per_leaf_node_transparent=this.frags_per_leaf_node;this.frags_per_inner_node_transparent=0;this.max_polys_per_node=0|1E4*c}if(this.nodes&&this.nodes.is_lean_node==
b)this.nodes.nodeCount=0;else{b=this.prim_count/this.frags_per_leaf_node;for(c=1;c<b;)c*=2;this.nodes=new NodeArray(c,a?a.useSlimNodes:!1)}this.sortPrimitives();BVHModule.compute_boxes(this);a=this.nodes.nextNodes(2);for(BVHModule.bvh_subdivide(this,a,0,this.first_transparent-1,this.boxv_o,this.boxc_o,!1,0);this.recursion_stack.length;)b=this.recursion_stack.pop(),BVHModule.bvh_subdivide(b[0],b[1],b[2],b[3],b[4],b[5],b[6],b[7]);for(BVHModule.bvh_subdivide(this,a+1,this.first_transparent,this.prim_count-
1,this.boxv_t,this.boxc_t,!0,0);this.recursion_stack.length;)b=this.recursion_stack.pop(),BVHModule.bvh_subdivide(b[0],b[1],b[2],b[3],b[4],b[5],b[6],b[7])};TeratekNamespace("Teratek.Viewing.Private");
(function(){var a=Teratek.Viewing.Private;a.inWorkerThread="undefined"!==typeof self&&"undefined"===typeof window;a.ViewingService={};a.ViewingService.generateUrl=function(b,c,d,e){if(0!==d.indexOf("urn:"))return d;b+="/";"items"!==c&&(d=d.substr(4));return b="bubbles"===c&&0==a.env.indexOf("Autodesk")?b+d:b+(c+"/"+d)};a.ViewingService.get=function(b,c,d,e,f,g){g=g?g:{};d=a.ViewingService.generateUrl(b,c,d,g);g.queryParams&&(d=d+"?"+g.queryParams);var h=new XMLHttpRequest;try{b=function(a){200===
h.status?e(h.response?h.response:h.responseText):k(a)};var k=function(a){f(h.status,h.statusText,{url:d})},n=g.hasOwnProperty("asynchronous")?g.asynchronous:!0;h.open("GET",d,n);g.hasOwnProperty("responseType")&&(h.responseType=g.responseType);h.withCredentials=!0;g.hasOwnProperty("withCredentials")&&(h.withCredentials=g.withCredentials);if(g.headers)for(var r in g.headers)h.setRequestHeader(r,g.headers[r]);n&&(h.onload=b,h.onerror=k,h.ontimeout=k);h.send();a.inWorkerThread?self.postMessage({assetRequest:[d,
g.headers,null]}):a.assets.push([d,g.headers,null]);n||b(null)}catch(q){f(h.status,h.statusText,{url:d,exception:q})}}})();
var Xhr=function(){var a=function(a,c,d){this.xhr=new XMLHttpRequest;this.errorHandler=a;this.success=!1;this.viewing_url=d;this.auth=c};a.prototype.generateUrl=function(a,c,d){var e=a.indexOf("urn:");0===e&&this.viewing_url&&((d=d&&d.feature?d.feature:null)?"render"==d?(a=a.substr(4),a=this.viewing_url+"/"+d+"/"+encodeURIComponent(a)):"bubbles"==d?(a=a.substr(4),a=this.viewing_url+"/"+d+"/"+encodeURIComponent(a)):"comments"==d?(a=a.substr(4),a=this.viewing_url+"/"+d+"/file/"+encodeURIComponent(a)):
a=this.viewing_url+"/"+d+"/"+encodeURIComponent(a.substr(e)):a=this.viewing_url+"/items/"+encodeURIComponent(a.substr(e)));c&&(a=a+"?"+c);return a};a.prototype.addHeaders=function(a){for(var c in a)this.xhr.setRequestHeader(c,a[c])};a.prototype.get=function(a,c,d,e,f,g,h){a=this.generateUrl(a,g,{feature:f,oss_url:h});try{this.xhr.open("GET",a,!!e),this.xhr.responseType=d,this.success=!1,this.auth&&(this.xhr.withCredentials=!0),e&&(this.xhr.onload=e),this.addHeaders(c),this.xhr.send()}catch(k){return this.errorHandler&&
this.errorHandler.networkFailure(a,k),null}this.errorCheck(a,200);return this.xhr.response};a.prototype.post=function(a,c,d,e,f,g){a=this.generateUrl(a,null,{feature:g});c["Content-Type"]||(c["Content-Type"]="application/json");try{this.xhr.open("POST",a,!!f),this.xhr.responseType=e,this.success=!1,this.auth&&(this.xhr.withCredentials=!0),f&&(this.xhr.onload=f),this.addHeaders(c),this.xhr.send(d)}catch(h){return this.errorHandler&&this.errorHandler.networkFailure(a,h),null}this.errorCheck(a,200,201);
return this.xhr.response};a.prototype.getRange=function(a,c,d,e,f,g){a=this.generateUrl(path);c.Range="bytes="+e+"-"+f;try{this.xhr.open("GET",a,!!g),this.xhr.responseType=d,this.success=!1,this.auth&&(this.xhr.withCredentials=!0),g&&(this.xhr.onload=g),this.addHeaders(c),this.xhr.send()}catch(h){return this.errorHandler&&this.errorHandler.networkFailure(a,h),null}this.errorCheck(a,206);return this.xhr.response};a.prototype.head=function(a){a=this.generateUrl(path);try{this.xhr.open("GET",a,!1),this.success=
!1,this.auth&&(this.xhr.withCredentials=!0),this.addHeaders([]),this.xhr.send()}catch(c){return this.errorHandler&&this.errorHandler.networkFailure(a,c),null}this.errorCheck(a,200);a=[];a["Accept-Ranges"]=this.xhr.getResponseHeader("Accept-Ranges");a["Content-Length"]=this.xhr.getResponseHeader("Content-Length");return a};a.prototype.errorCheck=function(a,c){if(4===this.xhr.readyState&&this.xhr.status){var d;for(d=1;d<arguments.length&&this.xhr.status!==arguments[d];d++);d===arguments.length&&this.errorHandler?
this.errorHandler.unsuccessfulResponse(a,this.xhr.status,this.xhr.statusText):this.success=!0}else this.success=!0};return a}(),XhrErrorHandler=function(){var a=function(a){this.host=a;this.ignoreFileNotFound=!1};a.prototype.networkFailure=function(a,c){this.host.raiseError(Teratek.Viewing.ErrorCodes.NETWORK_FAILURE,"Network failure",{url:a,exception:c.toString(),stack:c.stack})};a.prototype.unsuccessfulResponse=function(a,c,d){403==c?this.host.raiseError(Teratek.Viewing.ErrorCodes.NETWORK_ACCESS_DENIED,
"Access denied to remote resource",{url:a,httpStatus:c,httpStatusText:d}):404==c?this.ignoreFileNotFound||this.host.raiseError(Teratek.Viewing.ErrorCodes.NETWORK_FILE_NOT_FOUND,"Remote resource not found",{url:a,httpStatus:c,httpStatusText:d}):500<=c&&600>c?this.host.raiseError(Teratek.Viewing.ErrorCodes.NETWORK_SERVER_ERROR,"Server error when accessing resource",{url:a,httpStatus:c,httpStatusText:d}):this.host.raiseError(Teratek.Viewing.ErrorCodes.NETWORK_UNHANDLED_RESPONSE_CODE,"Unhandled response code from server",
{url:a,httpStatus:c,httpStatusText:d})};return a}();
function doGeomLoad(a,b){Teratek.Viewing.Private.ViewingService.get(b.viewing_url,"items",b.url,function(c){a.postMessage({url:b.url,workerId:b.workerId,progress:.5});try{var d=new PackFileReader(new Uint8Array(c))}catch(e){a.raiseError(Teratek.Viewing.ErrorCodes.BAD_DATA,"Unhandled exception while reading pack file",{url:b.url,exception:e.toString(),stack:e.stack});a.postMessage(null);return}for(var f=c=!1,g={packId:b.packId,meshIndex:0,mesh:null,workerId:b.workerId,progress:0},h=0,k=d.getEntryCounts();h<
k;h++){try{var n=readGeometry(d,h,null)}catch(r){f||(a.raiseError(Teratek.Viewing.ErrorCodes.BAD_DATA,"Unhandled exception while reading geometry",{url:b.url,exception:r.toString(),stack:r.stack}),c=f=!0,debug(r.stack)),n=null}g.meshIndex=h;g.mesh=n;g.progress=.5+(h+1)/k*.5;if(n){var q=[];q.push(n.vb.buffer);a.postMessage(g,q)}else c||(a.raiseError(Teratek.Viewing.ErrorCodes.BAD_DATA,"Unable to load geometry",{url:b.url}),c=!0),a.postMessage(g)}},b.onFailureCallback,{withCredentials:!!b.auth,responseType:"arraybuffer",
asynchronous:!1,headers:b.headers,queryParams:b.queryParams,oss_url:b.oss_url})}function guardFunction(a,b,c){try{c()}catch(d){a.raiseError(Teratek.Viewing.ErrorCodes.BAD_DATA,"Unhandled exception while loading SVF",{url:b.url,exception:d.toString(),stack:d.stack}),a.postMessage(null)}}
function doLoadSvfContinued(a,b){guardFunction(a,b,function(){var c=a.svf;b.loadDoneCB=function(d){if("svf"==d){var e=c.fragments;d=[e.transforms.buffer,e.packIds.buffer,e.entityIndexes.buffer,e.fragId2dbId.buffer];if(c.bvh){var f={nodes:c.bvh.nodes.getRawData(),primitives:c.bvh.primitives,useLeanNodes:32==c.bvh.nodes.bytes_per_node};d.push(f.nodes);d.push(f.primitives.buffer);d.push(e.boxes.buffer);d.push(e.polygonCounts.buffer);d.push(e.materials.buffer);e={svf:c,bvh:f,progress:1}}else e={svf:c,
progress:.8};a.postMessage(e,d)}else"bvh"==d?(f={nodes:c.bvh.nodes.getRawData(),primitives:c.bvh.primitives,useLeanNodes:32==c.bvh.nodes.bytes_per_node},a.postMessage({bvh:f,basePath:c.basePath,progress:1},[f.nodes,f.primitives.buffer])):"done"==d?a.postMessage({progress:1}):(a.raiseError(Teratek.Viewing.ErrorCodes.BAD_DATA,"Failure while loading SVF",{url:b.url}),a.postMessage(null))};a.svf.loadRemainingSvf(b)})}
function doLoadSvf(a,b){Teratek.Viewing.Private.ViewingService.get(b.viewing_url,"items",b.url,function(c){a.postMessage({progress:.5});guardFunction(a,b,function(){a.svf=new Package(new Uint8Array(c));a.svf.loadManifest(b);b.interceptManifest?a.postMessage({manifest:svf.manifest}):(b.manifest=a.svf.manifest,doLoadSvfContinued(a,b))})},b.onFailureCallback,{withCredentials:!!b.auth,responseType:"arraybuffer",asynchronous:!1,headers:b.headers,queryParams:b.queryParams,oss_url:b.oss_url})}
var propdb=null,propdbFailed=!1,propdbURL="";
function loadPropertyPacks(a,b,c){function d(b){if(!b){if(g){propdbFailed=!0;c(null);return}g=!0;b=[];b.push({filename:"objects_attrs.json",storage:e.attrs});b.push({filename:"objects_vals.json",storage:e.values});b.push({filename:"objects_avs.json",storage:e.avs});b.push({filename:"objects_offs.json",storage:e.offsets});b.push({filename:"objects_ids.json",storage:e.ids});f=b}0===f.length?(propdb=new PropertyDatabase(e),c(propdb),propdbFailed=!1,propdbURL=a.url):(b=f.shift(),requestFile(b.filename,
a,d,b.storage))}if(propdb)c(propdb);else if(propdbFailed)c(null);else if(b=a.propertydb){var e={ids:{},attrs:{},offsets:{},values:{},avs:{}},f=[];f.push({filename:b.attrs.length?b.attrs[0]:"objects_attrs.json.gz",storage:e.attrs});f.push({filename:b.values.length?b.values[0]:"objects_vals.json.gz",storage:e.values});f.push({filename:b.avs.length?b.avs[0]:"objects_avs.json.gz",storage:e.avs});f.push({filename:b.offsets.length?b.offsets[0]:"objects_offs.json.gz",storage:e.offsets});f.push({filename:b.ids.length?
b.ids[0]:"objects_ids.json.gz",storage:e.ids});for(b=0;b<f.length;b++)f[b].filename=f[b].filename.replace(/\\/g,"/");var g=!1;b=f.shift();requestFile(b.filename,a,d,b.storage)}else propdbFailed=!0,c(null)}function doPropertyGet(a,b){var c=b.dbId;loadPropertyPacks(b,c,function(d){d&&(d=d.getObjectProperties(c),a.postMessage({cbId:b.cbId,result:d,dbId:c}))})}
function computeTreeBBoxes(a,b,c){var d=6*a.dbId;b[d]=b[d+1]=b[d+2]=Infinity;b[d+3]=b[d+4]=b[d+5]=-Infinity;var e=a.children;if(e)for(var f=0,g=e.length;f<g;f++){computeTreeBBoxes(e[f],b,c);for(var h=6*(e[f].dbId|0),k=0;3>k;k++)b[d+k]>b[h+k]&&(b[d+k]=b[h+k]),b[d+k+3]<b[h+k+3]&&(b[d+k+3]=b[h+k+3])}if(void 0!==a.fragIds)if(!Array.isArray(a.fragIds))for(e=6*(a.fragIds|0),k=0;3>k;k++)b[d+k]>c[e+k]&&(b[d+k]=c[e+k]),b[d+k+3]<c[e+k+3]&&(b[d+k+3]=c[e+k+3]);else if(a.fragIds.length)for(f=0;f<a.fragIds.length;f++)for(e=
6*(a.fragIds[f]|0),k=0;3>k;k++)b[d+k]>c[e+k]&&(b[d+k]=c[e+k]),b[d+k+3]<c[e+k+3]&&(b[d+k+3]=c[e+k+3])}function buildDbIdToFragMap(a){for(var b={},c=0,d=a.length;c<d;c++){var e=a[c];Array.isArray(e)||(e=[e]);for(var f=0;f<e.length;f++){var g=e[f],h=b[g];void 0===h?b[g]=c:Array.isArray(h)?h.push(c):b[g]=[h,c]}}return b}
function doObjectTreeParse(a,b){loadPropertyPacks(b,null,function(c){if(c){var d;b.fragToDbId&&(d=buildDbIdToFragMap(b.fragToDbId));var e=c.findRootNodes(),f,g=[0],h=c.getObjectCount();if(e&&e.length)if(1==e.length)f={dbId:e[0]},c.buildObjectTree(f,d,0,g);else{f={dbId:0,children:[]};for(var k=0;k<e.length;k++){var n={dbId:e[k]};f.children.push(n);c.buildObjectTree(n,d,0,g)}}var r;b.fragBoxes&&(r=new Float32Array(6*c.getObjectCount()),computeTreeBBoxes(f,r,b.fragBoxes));a.postMessage({cbId:b.cbId,
result:{instanceTree:f,instanceBoxes:r,maxTreeDepth:g[0],objectCount:h}})}else a.postMessage({cbId:b.cbId,error:{instanceTree:null,maxTreeDepth:0}})})}
function requestFile(a,b,c,d){var e=b.url+a,f=null,f=-1!==e.indexOf(".gz",e.length-3)?function(b){try{var f=new Uint8Array(b);31==f[0]&&139==f[1]&&(f=(new Zlib.Gunzip(f)).decompress());d[a]=f;c(f)}catch(k){self.raiseError(Teratek.Viewing.ErrorCodes.BAD_DATA,"Malformed data received when requesting file",{url:e,exception:k.toString(),stack:k.stack}),c(null)}}:function(b){d[a]=rawbuf;c(new Uint8Array(b))};Teratek.Viewing.Private.ViewingService.get(b.viewing_url,"items",e,f,function(a,d,e){if(404!==
a)b.onFailureCallback(a,d,e);c(null)},{withCredentials:!!b.auth,responseType:"arraybuffer",asynchronous:!1,headers:b.headers,queryParams:b.queryParams,oss_url:b.oss_url})}function doPropertySearch(a,b){loadPropertyPacks(b,null,function(c){c&&(c=c.bruteForceSearch(b.searchText,b.attributeNames),a.postMessage({cbId:b.cbId,result:c}))})}function doBuildExternalIdMapping(a,b){loadPropertyPacks(b,null,function(c){c&&(c=c.getExternalIdMapping(),a.postMessage({cbId:b.cbId,result:c}))})}
function doAttributeToIdMap(a,b){loadPropertyPacks(b,null,function(c){c&&(c=c.getAttributeToIdMap(),a.postMessage({cbId:b.cbId,result:c}))})}function doDecompressDelta(a,b){for(var c=base64.decode(b.delta),c=c.split("").map(function(a){return a.charCodeAt(0)}),c=(new Zlib.Inflate(c)).decompress(),d="",e=0;e<c.length;e++)d+=String.fromCharCode(c[e]);d=JSON.parse(d);a.postMessage({cbId:b.cbId,index:b.index,res:d})}
function doParseF2D(a,b){if(b.data){a.postMessage({progress:.5});var c=new F2D(b.metadata,b.manifest,b.basePath,b.f2dLoadOptions);b.loadDoneCB=function(b){b?a.postMessage({f2d:c}):(a.raiseError(Teratek.Viewing.ErrorCodes.BAD_DATA,"",{}),a.postMessage(null))};try{c.load(b,new Uint8Array(b.data))}catch(d){a.raiseError(Teratek.Viewing.ErrorCodes.BAD_DATA,"",{exception:d.toString(),stack:d.stack}),a.postMessage(null)}}else a.postMessage(null)}
function doParseF2DFrame(a,b){f2d||(a.postMessage({progress:.5}),f2d=new F2D(b.metadata,b.manifest,b.basePath,b.f2dLoadOptions),f2d.F2D_MESH_COUNT_OLD=0,a.postMessage({f2dframe:f2d}));b.loadDoneCB=function(c){if(c){if(f2d.meshes.length){c={f2dframe:!0,meshes:f2d.meshes,baseIndex:f2d.F2D_MESH_COUNT_OLD,maxObjectNumber:f2d.maxObjectNumber,bbox:f2d.bbox,viewports:f2d.viewports,currentVpId:f2d.currentVpId,clips:f2d.clips};b.finalFrame&&(c.finalFrame=!0);for(var e=[],f=0,g=f2d.meshes.length;f<g;++f)e.push(f2d.meshes[f].vb.buffer),
e.push(f2d.meshes[f].indices.buffer);a.postMessage(c,e);f2d.F2D_MESH_COUNT_OLD+=f2d.meshes.length;f2d.meshes=[]}}else a.raiseError(Teratek.Viewing.ErrorCodes.BAD_DATA,"",{}),a.postMessage(null)};try{f2d.loadFrames(b)}catch(c){a.raiseError(Teratek.Viewing.ErrorCodes.BAD_DATA,"",{exception:c.toString(),stack:c.stack}),a.postMessage(null)}}var ENABLE_F2D_STREAMING_MODE=!0;
function requestFileF2D(a,b){b.errorHandler.ignoreFileNotFound=!0;var c=new Xhr(b.errorHandler,b.auth,b.viewing_url);if(-1!==a.indexOf(".gz",a.length-3)){var d=c.get(a,b.headers,"arraybuffer",null,null,b.queryParams,b.oss_url);if(c.success)try{var e=new Uint8Array(d);31==e[0]&&139==e[1]&&(e=(new Zlib.Gunzip(e)).decompress());return e}catch(f){return self.raiseError(Teratek.Viewing.ErrorCodes.BAD_DATA,"Malformed data received when requesting file",{url:a,exception:f.toString(),stack:f.stack}),null}else return null}else return d=
c.get(a,b.headers,"arraybuffer"),c.success?new Uint8Array(d):null}function generateOSSURL(a,b){var c=decodeURIComponent(a),d=c.indexOf("urn:adsk.objects:os.object:");if(-1!==d){var d=c.substr(d+27),c=d.substr(0,d.indexOf("/")),d=d.substr(d.indexOf("/")+1),e=d.indexOf("?");-1!==e&&(d=encodeURIComponent(d.substr(0,e))+d.substr(e));a=b+"/buckets/"+c+"/objects/"+d}return a}
function doStreamF2D(a,b){function c(a){for(var b="",c=0;c<a.length;c++)b+=String.fromCharCode(a[c]);a=decodeURIComponent(escape(b));return JSON.parse(a)}function d(a,b){for(var c=a.length-b,d=new ArrayBuffer(c),e=new Uint8Array(d,0),f=0,g=b;f<c;f++,g++)e[f]=a.charCodeAt(g)&255;return d}var e=b.url;b.queryParams&&(e+="?"+b.queryParams);var f=b.basePath+"metadata.json.gz",g=b.basePath+"manifest.json.gz",h=requestFileF2D(f,b),k=requestFileF2D(g,b),n=[];n.push([g,b.headers,null]);n.push([f,b.headers,
null]);try{h&&(h=c(h)),k&&(k=c(k))}catch(r){k=h=null}if(h){var q;if(k&&k.assets)for(f=k.assets,g=0;g<f.length;g++)if(-1!=e.indexOf(f[g].URI)){q=f[g].usize||0;break}var p=new XMLHttpRequest;p.withCredentials=!!b.auth;var l=new F2DProbe,t=0,u=0,m=!1;p.onreadystatechange=function(){try{if(4==p.readyState){a.postMessage({type:"F2DAssetURL",urls:n});n=null;if(ENABLE_F2D_STREAMING_MODE&&0<u){var c=p.responseText,e={type:"F2DSTREAM",finalFrame:!0,finished:!0,progress:1},f=[];m||(e.manifest=k,e.metadata=
h,e.basePath=b.basePath,m=!0);if(c.length>u){var g=d(c,u),r=new Uint8Array(g),w=l.load(r),A=g.slice(w.frameStart,w.frameEnd);w.frameEnd>w.frameStart&&(f.push(A),e.frames=A)}debug("Total text bytes count : "+p.responseText.length);a.postMessage(e,f);return}c=p.responseText;g=d(c,0);e={type:"F2DBLOB",metadata:h,manifest:k,basePath:b.basePath,progress:1,buffer:g};f=[];f.push(g);a.postMessage(e,f)}if(2<p.readyState&&ENABLE_F2D_STREAMING_MODE&&(c=p.responseText,!(u+65536>c.length))){g=d(c,u);if(!t){++t;
var E=new Uint8Array(g);if(31==E[0]&&139==E[1]){ENABLE_F2D_STREAMING_MODE=!1;return}}r=new Uint8Array(g);w=l.load(r);w.frameEnd>w.frameStart&&(A=g.slice(w.frameStart,w.frameEnd),u+=w.frameEnd,f=[],f.push(A),e={type:"F2DSTREAM",frames:A,finalFrame:!1},q&&(e.progress=u/q),m||(e.manifest=k,e.metadata=h,e.basePath=b.basePath,m=!0),a.postMessage(e,f))}}catch(v){debug(v.message)}};try{p.open("GET",e,!0);if(b.headers)for(var w in b.headers)p.setRequestHeader(w,b.headers[w]);p.overrideMimeType("text/plain; charset=x-user-defined");
p.send();n.push([e,b.headers,null])}catch(A){debug(A.message)}}else self.raiseError(Teratek.Viewing.ErrorCodes.BAD_DATA,"")}Teratek.Viewing.ErrorCodes={UNKNOWN_FAILURE:1,BAD_DATA:2,NETWORK_FAILURE:3,NETWORK_ACCESS_DENIED:4,NETWORK_FILE_NOT_FOUND:5,NETWORK_SERVER_ERROR:6,NETWORK_UNHANDLED_RESPONSE_CODE:7,BROWSER_WEBGL_NOT_SUPPORTED:8,BAD_DATA_NO_VIEWABLE_CONTENT:9,BROWSER_WEBGL_DISABLED:10,RTC_ERROR:11};var ENABLE_OCTM_MG2=!1,IS_WORKER="undefined"!==typeof self&&"undefined"===typeof window;
if(IS_WORKER){var debug=function(a){self.postMessage({debug:1,message:a})},f2d=null;IS_CONCAT_BUILD||(importScripts("../AutodeskNamespace.js"),importScripts("../compatibility.js"),importScripts("../../thirdparty/three.js/LmvMatrix4.js"),importScripts("../lmvtk/gunzip.min.js"),importScripts("../lmvtk/unzip.min.js"),ENABLE_OCTM_MG2&&(importScripts("../lmvtk/inflate.min.js"),importScripts("../lmvtk/octm_mg2.js")),importScripts("../scene/BVHBuilder.js"),importScripts("../lmvtk/InputStream.js"),importScripts("../lmvtk/VbUtils.js"),
importScripts("../lmvtk/VertexBufferBuilder.js"),importScripts("../lmvtk/PackReader.js"),importScripts("../lmvtk/Geoms.js"),importScripts("../lmvtk/Lights.js"),importScripts("../lmvtk/Cameras.js"),importScripts("../lmvtk/Fragments.js"),importScripts("../lmvtk/Instances.js"),importScripts("../lmvtk/Package.js"),importScripts("../lmvtk/PackReader.js"),importScripts("../lmvtk/Propdb.js"),importScripts("../lmvtk/F2d.js"),importScripts("../lmvtk/F2dProbe.js"),importScripts("../lmvtk/CheckedInputStream.js"),
importScripts("../lmvtk/base64.js"),importScripts("../lmvtk/inflate.min.js"),importScripts("../net/Xhr.js"),importScripts("GeomWorker.js"),importScripts("SvfWorker.js"),importScripts("PropWorker.js"),importScripts("DecompressWorker.js"),importScripts("F2dParseWorker.js"),importScripts("F2dStreamWorker.js"),importScripts("../ErrorCodes.js"));self.addEventListener("message",function(a){var b=a.data;if(b.hasOwnProperty("operation")){b.basePath="";if(b.url){var c=b.url.lastIndexOf("/");-1!=c&&(b.basePath=
b.url.substr(0,c+1))}b.onFailureCallback=function(a,b,c){403==a?self.raiseError(Teratek.Viewing.ErrorCodes.NETWORK_ACCESS_DENIED,"Access denied to remote resource",{url:c.url,httpStatus:a,httpStatusText:b}):404==a?self.raiseError(Teratek.Viewing.ErrorCodes.NETWORK_FILE_NOT_FOUND,"Remote resource not found",{url:c.url,httpStatus:a,httpStatusText:b}):500<=a&&600>a?self.raiseError(Teratek.Viewing.ErrorCodes.NETWORK_SERVER_ERROR,"Server error when accessing resource",{url:c.url,httpStatus:a,httpStatusText:b}):
c.exception?self.raiseError(Teratek.Viewing.ErrorCodes.NETWORK_FAILURE,"Network failure",{url:c.url,exception:c.exception.toString(),stack:c.exception.stack}):self.raiseError(Teratek.Viewing.ErrorCodes.NETWORK_UNHANDLED_RESPONSE_CODE,"Unhandled response code from server",{url:c.url,httpStatus:a,httpStatusText:b})};b.errorHandler=new XhrErrorHandler(self);a=a.data.operation;"LOAD_GEOMETRY"==a?doGeomLoad(self,b):"LOAD_SVF"==a?doLoadSvf(self,b):"LOAD_SVF_CONTD"==a?doLoadSvfContinued(self,b):"GET_PROPERTIES"==
a?doPropertyGet(self,b):"SEARCH_PROPERTIES"==a?doPropertySearch(self,b):"BUILD_EXTERNAL_ID_MAPPING"==a?doBuildExternalIdMapping(self,b):"GET_OBJECT_TREE"==a?doObjectTreeParse(self,b):"PARSE_F2D"==a?doParseF2D(self,b):"PARSE_F2D_FRAME"==a?doParseF2DFrame(self,b):"STREAM_F2D"==a?doStreamF2D(self,b):"DECOMPRESS_DELTA"==a?doDecompressDelta(self,b):"ATTRIBUTES_MAP"==a&&doAttributeToIdMap(self,b)}},!1);self.raiseError=function(a,b,c){self.postMessage({error:{code:a,msg:b,args:c}})}};
